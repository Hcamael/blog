<!DOCTYPE html>
<html lang="default">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>GGCTF的对称密码学 | Hc1m1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="研究了GGCTF中的两题密码学，用到了SHA1 Length Extension Attack &amp;amp;&amp;amp; CBC Padding Oracle Attack">
<meta name="keywords" content="Crypto,CBC Padding Oracle Attack,SHA1 Length Extension Attack">
<meta property="og:type" content="article">
<meta property="og:title" content="GGCTF的对称密码学">
<meta property="og:url" content="http://0x48.pw/2016/05/03/0x1A/index.html">
<meta property="og:site_name" content="Hc1m1">
<meta property="og:description" content="研究了GGCTF中的两题密码学，用到了SHA1 Length Extension Attack &amp;amp;&amp;amp; CBC Padding Oracle Attack">
<meta property="og:updated_time" content="2016-05-04T03:12:56.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="GGCTF的对称密码学">
<meta name="twitter:description" content="研究了GGCTF中的两题密码学，用到了SHA1 Length Extension Attack &amp;amp;&amp;amp; CBC Padding Oracle Attack">
  
    <link rel="alternative" href="/rss.xml" title="Hc1m1" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.png">
  
  
      <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">
  
  
      <link href="//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css" rel="stylesheet">
  
  
      <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
      <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">
  
  <link rel="stylesheet" href="/css/style.css">
  
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
  
    <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <script src="//cdn.bootcss.com/jquery/1.9.1/jquery.min.js"></script>
  <script>
      var yiliaConfig = {
          fancybox: true,
          animate: true,
          isHome: false,
          isPost: true,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false,
      }
  </script>

  
      <script>
          yiliaConfig.rootUrl = "/";
      </script>
  

  
      <script>
          var _hmt = _hmt || [];
          (function() {
              var hm = document.createElement("script");
              hm.src = "//hm.baidu.com/hm.js?4b6b8b9a09d24f4d4e26c50bd1707fd7";
              var s = document.getElementsByTagName("script")[0]; 
              s.parentNode.insertBefore(hm, s);
          })();
      </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="http://qn.lazysheep.cc/img/author.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Hcamael</a></h1>
        </hgroup>

        
        <p class="header-subtitle">Blog</p>
        
                


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <li id="Email"><a class="Email" target="_blank" href="mailto: baiyjrh@gmail.com" title="Email"></a></li>
                            
                                <li id="GitHub"><a class="GitHub" target="_blank" href="https://github.com/Hcamael" title="GitHub"></a></li>
                            
                                <li id="RSS"><a class="RSS" target="_blank" href="/rss.xml" title="RSS"></a></li>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <a href="/tags/Binary/" style="font-size: 16px;">Binary</a> <a href="/tags/CBC-Padding-Oracle-Attack/" style="font-size: 10px;">CBC Padding Oracle Attack</a> <a href="/tags/CTF/" style="font-size: 20px;">CTF</a> <a href="/tags/Crypto/" style="font-size: 18px;">Crypto</a> <a href="/tags/GIT/" style="font-size: 10px;">GIT</a> <a href="/tags/Old博文/" style="font-size: 10px;">Old博文</a> <a href="/tags/PWN/" style="font-size: 14px;">PWN</a> <a href="/tags/Pentest/" style="font-size: 10px;">Pentest</a> <a href="/tags/Pwn/" style="font-size: 12px;">Pwn</a> <a href="/tags/Python/" style="font-size: 14px;">Python</a> <a href="/tags/RE/" style="font-size: 10px;">RE</a> <a href="/tags/Re/" style="font-size: 10px;">Re</a> <a href="/tags/SHA1-Length-Extension-Attack/" style="font-size: 10px;">SHA1 Length Extension Attack</a> <a href="/tags/SQLi/" style="font-size: 12px;">SQLi</a> <a href="/tags/Web/" style="font-size: 10px;">Web</a> <a href="/tags/Wechall/" style="font-size: 10px;">Wechall</a> <a href="/tags/php/" style="font-size: 14px;">php</a> <a href="/tags/安全研究/" style="font-size: 12px;">安全研究</a> <a href="/tags/密码学/" style="font-size: 10px;">密码学</a> <a href="/tags/检讨/" style="font-size: 10px;">检讨</a> <a href="/tags/环境搭建/" style="font-size: 10px;">环境搭建</a> <a href="/tags/网络/" style="font-size: 10px;">网络</a> <a href="/tags/随笔/" style="font-size: 10px;">随笔</a>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://hduisa.cn">HDUISA</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://wiki.hduisa.org">wiki</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://drops.hduisa.org">Drops</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://lightless.me">lightless</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://homeway.me">夏日小草</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.edwardl.xyz">Edward_L</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://aklis.info">Aklis</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://libc.pw">Explorer</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://lorexxar.cn">Lorexxar</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">HDUISA, web狗, 菜鸡H, 正在向bin爷爷努力前进</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Hcamael</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="http://qn.lazysheep.cc/img/author.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Hcamael</a></h1>
            </hgroup>
            
            <p class="header-subtitle">Blog</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <li id="Email"><a class="Email" target="_blank" href="mailto: baiyjrh@gmail.com" title="Email"></a></li>
                            
                                <li id="GitHub"><a class="GitHub" target="_blank" href="https://github.com/Hcamael" title="GitHub"></a></li>
                            
                                <li id="RSS"><a class="RSS" target="_blank" href="/rss.xml" title="RSS"></a></li>
                            
                        </ul>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap"><article id="post-0x1A" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/05/03/0x1A/" class="article-date">
      <time datetime="2016-05-03T14:00:51.000Z" itemprop="datePublished">2016-05-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      GGCTF的对称密码学
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/H-blog/">H-blog</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CBC-Padding-Oracle-Attack/">CBC Padding Oracle Attack</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Crypto/">Crypto</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SHA1-Length-Extension-Attack/">SHA1 Length Extension Attack</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>研究了GGCTF中的两题密码学，用到了SHA1 Length Extension Attack &amp;&amp; CBC Padding Oracle Attack<br><a id="more"></a><br>最近中了密码学的毒，研究完非对称，又来看对称密码学了(数学虐我千百遍，我待数学如初恋)，这两种对称密码的攻击方法在《白帽子讲web安全》中也都有详写</p>
<p>这两题也算了一个系列的了</p>
<h1 id="Eucalypt-Forest"><a href="#Eucalypt-Forest" class="headerlink" title="Eucalypt Forest"></a>Eucalypt Forest</h1><blockquote>
<p>Can you find any weaknesses in the use of the encryption keys?<br>Head over to eucalypt-forest.ctfcompetition.com</p>
</blockquote>
<p>这题需要你构造出<code>{&quot;username&quot;: &quot;admin&quot;}</code>, 只需要利用比特反转就行了，比如，我注册一个<code>aamin</code>, 最后进行加密的字符串是<code>{&quot;username&quot;: &quot;aamin&quot;}+\x0b * 11</code>, 返回的cookie中包含了16位的IV，和32位的加密密文，因为使用的是CBC模式，所以我们可以通过修改IV来修改解密后前16位明文，通过修改最后一位IV， 我们能把<code>a</code> -&gt; <code>d</code>, 导致最后解密cookie得到的明文是<code>{&quot;username&quot;: &quot;admin&quot;}</code>，GETFLAG</p>
<p>仅仅利用比特反转有局限性，只能任意修改前16位明文，不过再加上Padding Oracle Attack, 那么就可以伪造任意明文了，Talk is cheap, show you the code.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"></div><div class="line">from optparse import OptionParser</div><div class="line">import requests</div><div class="line">import struct</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">POAttack</span>():</span></div><div class="line">    <span class="string">""</span><span class="string">"</span></div><div class="line">    以GGCTF的一题为例写的Padding Oracle Attack</div><div class="line">    By Hcamael</div><div class="line">    "<span class="string">""</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>, options)</span></span>:</div><div class="line">        <span class="keyword">self</span>.url = options.url</div><div class="line">        <span class="keyword">self</span>.length = options.length</div><div class="line">        cookie = options.cookie.split(<span class="string">"="</span>)</div><div class="line">        assert len(cookie) == <span class="number">2</span></div><div class="line">        <span class="keyword">self</span>.c_name = cookie[<span class="number">0</span>]</div><div class="line">        c = cookie[<span class="number">1</span>].decode(<span class="string">'hex'</span>)</div><div class="line">        <span class="keyword">if</span> len(c) % <span class="keyword">self</span>.length != <span class="number">0</span> <span class="keyword">or</span> len(c) == <span class="keyword">self</span>.<span class="symbol">length:</span></div><div class="line">            raise <span class="string">"cookie error!"</span></div><div class="line">        <span class="keyword">self</span>.sign = c[-<span class="keyword">self</span>.<span class="symbol">length:</span>].encode(<span class="string">'hex'</span>)</div><div class="line">        <span class="keyword">self</span>.result = <span class="keyword">self</span>.sign</div><div class="line">        <span class="keyword">self</span>.unenc = <span class="string">""</span></div><div class="line">        <span class="keyword">if</span> options.<span class="symbol">plain:</span></div><div class="line">            <span class="keyword">self</span>.plain = options.plain</div><div class="line">            <span class="keyword">self</span>.pad_plain = (<span class="keyword">self</span>.length - len(<span class="keyword">self</span>.plain) % <span class="keyword">self</span>.length)</div><div class="line">            <span class="keyword">self</span>.pad_iv = c[-<span class="keyword">self</span>.length*<span class="number">2</span>: -<span class="keyword">self</span>.length]</div><div class="line">        <span class="symbol">else:</span></div><div class="line">            <span class="keyword">self</span>.pad_plain = <span class="number">0</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">attack</span><span class="params">(<span class="keyword">self</span>, msg)</span></span>:</div><div class="line">        <span class="keyword">self</span>.a_str = msg</div><div class="line">        pad = (<span class="keyword">self</span>.length - len(<span class="keyword">self</span>.a_str) % <span class="keyword">self</span>.length)</div><div class="line">        <span class="keyword">self</span>.a_str += chr(pad) * pad</div><div class="line">        assert len(<span class="keyword">self</span>.a_str) % <span class="keyword">self</span>.length == <span class="number">0</span></div><div class="line">        <span class="keyword">self</span>.l_str = list(struct.unpack(<span class="string">"16s"</span>*(len(<span class="keyword">self</span>.a_str)/<span class="keyword">self</span>.length), <span class="keyword">self</span>.a_str))</div><div class="line"></div><div class="line">        <span class="keyword">self</span>.iv = <span class="string">"\x00"</span> * <span class="keyword">self</span>.length</div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(len(<span class="keyword">self</span>.l_str)):</div><div class="line">            result = <span class="keyword">self</span>.padding()</div><div class="line">            <span class="keyword">self</span>.unenc = result + <span class="keyword">self</span>.unenc</div><div class="line">            assert len(result) == len(<span class="keyword">self</span>.l_str[-x-<span class="number">1</span>]) == <span class="keyword">self</span>.length</div><div class="line">            tmp = <span class="string">""</span></div><div class="line">            <span class="keyword">for</span> y <span class="keyword">in</span> xrange(len(result)):</div><div class="line">                tmp += chr(ord(result[y])^ord(<span class="keyword">self</span>.l_str[-x-<span class="number">1</span>][y]))</div><div class="line">            <span class="keyword">self</span>.sign = tmp.encode(<span class="string">'hex'</span>)</div><div class="line">            <span class="keyword">self</span>.result = <span class="keyword">self</span>.sign + <span class="keyword">self</span>.result</div><div class="line">        <span class="keyword">return</span> (<span class="keyword">self</span>.result, <span class="keyword">self</span>.unenc.encode(<span class="string">"hex"</span>))</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">padding</span><span class="params">(<span class="keyword">self</span>)</span></span>:</div><div class="line">        tmp_iv = list(<span class="keyword">self</span>.iv)</div><div class="line">        result = list(<span class="string">"\x00"</span> * <span class="keyword">self</span>.length)</div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">self</span>.<span class="symbol">pad_plain:</span></div><div class="line">            n = <span class="number">0</span></div><div class="line">        <span class="symbol">else:</span></div><div class="line">            n = <span class="keyword">self</span>.pad_plain</div><div class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> xrange(n):</div><div class="line">                result[-i-<span class="number">1</span>] = chr(n ^ ord(<span class="keyword">self</span>.pad_iv[-i-<span class="number">1</span>]))</div><div class="line">            <span class="keyword">self</span>.pad_plain = <span class="number">0</span></div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(n, <span class="keyword">self</span>.length):</div><div class="line">            <span class="keyword">if</span> n != <span class="symbol">x:</span></div><div class="line">                raise <span class="string">"Padding Error!"</span></div><div class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> xrange(x):</div><div class="line">                tmp_iv[-i-<span class="number">1</span>] = chr((x+<span class="number">1</span>) ^ ord(result[-i-<span class="number">1</span>]))</div><div class="line">            <span class="keyword">for</span> y <span class="keyword">in</span> xrange(<span class="number">256</span>):</div><div class="line">                tmp_iv[-x-<span class="number">1</span>] = chr(y)</div><div class="line">                tmp = <span class="string">""</span>.join(tmp_iv).encode(<span class="string">'hex'</span>)</div><div class="line">                cookie = &#123;<span class="keyword">self</span>.<span class="symbol">c_name:</span> tmp + <span class="keyword">self</span>.sign&#125;</div><div class="line">                <span class="symbol">try:</span></div><div class="line">                    req = requests.get(<span class="keyword">self</span>.url, cookies=cookie, verify=False, allow_redirects=False)</div><div class="line">                <span class="symbol">except:</span></div><div class="line">                    print result</div><div class="line">                    print <span class="keyword">self</span>.result</div><div class="line">                    exit()</div><div class="line">                <span class="keyword">if</span> req.status_code != <span class="number">500</span>:</div><div class="line">                    result[-x-<span class="number">1</span>] = chr(y^(x+<span class="number">1</span>))</div><div class="line">                    n += <span class="number">1</span></div><div class="line">                    <span class="keyword">break</span></div><div class="line">        <span class="keyword">return</span> <span class="string">""</span>.join(result)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_parse</span><span class="params">()</span></span>:</div><div class="line">    parser = OptionParser()</div><div class="line">    parser.add_option(</div><div class="line">        <span class="string">"--url"</span>,</div><div class="line">        dest=<span class="string">"url"</span>,</div><div class="line">        help=<span class="string">"Please input the url"</span>)</div><div class="line">    parser.add_option(</div><div class="line">        <span class="string">"--l"</span>,</div><div class="line">        dest=<span class="string">"length"</span>,</div><div class="line">        type=<span class="string">"int"</span>,</div><div class="line">        help=<span class="string">"Please input the iv's bytes length"</span>)</div><div class="line">    parser.add_option(</div><div class="line">        <span class="string">"--cookie"</span>,</div><div class="line">        dest=<span class="string">"cookie"</span>,</div><div class="line">        help=<span class="string">"Please input the url's cookie"</span>)</div><div class="line">    parser.add_option(</div><div class="line">        <span class="string">"--s"</span>,</div><div class="line">        dest=<span class="string">"a_str"</span>,</div><div class="line">        help=<span class="string">"Please input you want to construct a string"</span>)</div><div class="line">    parser.add_option(</div><div class="line">        <span class="string">"--p"</span>,</div><div class="line">        dest=<span class="string">"plain"</span>,</div><div class="line">        help=<span class="string">"Please input if you know cookie's pliantext"</span>)</div><div class="line">    <span class="keyword">return</span> parser</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span></span>:</div><div class="line">    parser = add_parse()</div><div class="line">    (options, args) = parser.parse_args()</div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (options.url <span class="keyword">and</span> options.length <span class="keyword">and</span> options.cookie <span class="keyword">and</span> options.a_str):</div><div class="line">        parser.parse_args([<span class="string">'cbc-padding-oracle-attack.py'</span>, <span class="string">'-h'</span>])</div><div class="line">        exit(-<span class="number">1</span>)</div><div class="line"></div><div class="line">    cbca = POAttack(options)</div><div class="line">    r, s = cbca.attack(options.a_str)</div><div class="line">    print <span class="string">"+-------------------+"</span></div><div class="line">    print <span class="string">"|       Result     |"</span></div><div class="line">    print <span class="string">"+--------------------+"</span></div><div class="line">    print <span class="string">"Your want string's cookie: "</span> + r</div><div class="line">    print <span class="string">"AES decrypt result: "</span> + s</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name_<span class="number">_</span> == <span class="string">'__main__'</span>:</div><div class="line">    main()</div></pre></td></tr></table></figure>
<p>要完成Padding Oracle Attack, 首先需要知道IV的长度(–l int型长度)，还需要能对此进行攻击的服务(–url)，还有就是对服务传递的参数(–cookie)，由于该脚本是我对照了GGCTF的这题写的，所以是<code>--url</code>和<code>--cookie</code>参数，然后还有你想构造的字符串(–s)，最后一个<code>--p</code>参数为可选参数，可以加快Attack的速度.</p>
<h2 id="Padding-Oracle-Attack-原理"><a href="#Padding-Oracle-Attack-原理" class="headerlink" title="Padding Oracle Attack 原理"></a>Padding Oracle Attack 原理</h2><p>看GGCTF中这题对解密后的密文第一个判断<br><figure class="highlight fortran"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> <span class="keyword">pad</span> &gt; CookieCutter.KEY_SIZE:</div><div class="line">    raise ValueError, <span class="string">"pad error - pad is %d"</span> % (<span class="keyword">pad</span>)</div><div class="line"></div><div class="line">expected = chr(<span class="keyword">pad</span>) * <span class="keyword">pad</span></div><div class="line">piece = plaintext[-<span class="keyword">pad</span>:]</div><div class="line"></div><div class="line"><span class="keyword">if</span> piece <span class="comment">!= expected:</span></div><div class="line">    raise ValueError, <span class="string">"padding is corrupted"</span></div></pre></td></tr></table></figure></p>
<p>然后再看看加密时，对明文Padding的代码<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pad = (<span class="number">16</span> - (<span class="name">len</span>(<span class="name">s</span>) % <span class="number">16</span>))</div><div class="line">s += chr(<span class="name">pad</span>) * pad</div></pre></td></tr></table></figure></p>
<p>我们可以得到<code>0 &lt; pad &lt;= 16</code></p>
<p>pad用来把明文s补全到16的倍数，补全pad个chr(pad)字符</p>
<p>我们利用的就是解密时，对padding的判断，服务器是否返回500来对解密后的信息来进行判断</p>
<p>比如我们随便找一串密文<code>4da82e7d080d689d6fed5942671dde6f</code></p>
<p>初始化IV为<code>00000000000000000000000000000000</code></p>
<p>CBC模式流程为：c=<code>4da82e7d080d689d6fed5942671dde6f</code> -&gt; 解密 -&gt; de=<code>xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</code> -&gt; xor IV -&gt; M[16]</p>
<p>先遍历IV的最后一位，从00遍历道ff，如果<code>M[15] != 0x01</code>时，服务器则会返回500，(不过也会有例外，比如<code>M[14]==M[15]==0x02</code>，类推有15种这样的特殊情况，不过出现的概率太小，所以默认排除这类情况)</p>
<p>假如当<code>IV[15] = \xae</code>时，服务器返回200或302(视具体情况而定)时，我们可以得到<code>de[15] xor IV[15] = \x01</code> -&gt; <code>de[15] = \x01 xor \xae</code><br>这样解密后的de的最后一位我们就算出来了</p>
<p>接下来就是de的倒数第二位，也就是<code>M[14]==M[15]==\x02</code>，因为我们知道里<code>de[15]</code>所以我们可以求得<code>IV[15] = de[15] xor \x02</code>，这时IV[15]是确定的值，所以我们只要遍历IV[14]，假如当<code>IV[14] = \x63</code>时，服务器返回非500，我们可以求得<code>de[14] = \x63 xor \x02</code></p>
<p>以此类推我们最后可以求出de的全16位，按这题，我们需要构造的字符串是<code>{&quot;username&quot;: &quot;admin&quot;}+\x0b * 11</code>，不过我们需要从最后算起，所以就是用<code>min&quot;}+\x0b * 11 xor de</code>，这样可以求出IV，然后把这IV当做<code>{&quot;username&quot;: &quot;ad</code>的c，然后再跑出最终的IV</p>
<p>如果上面的代码能看懂，也就能理解Padding Oracle Attack了</p>
<h1 id="Wolf-Spider"><a href="#Wolf-Spider" class="headerlink" title="Wolf Spider"></a>Wolf Spider</h1><blockquote>
<p><a href="https://wolf-spider.ctfcompetition.com/" target="_blank" rel="external">https://wolf-spider.ctfcompetition.com/</a></p>
</blockquote>
<p>和上面那题是一个系列的，也就是在上一题的基础上加上了消息认证，从而多了一步Length Extension Attack</p>
<p>在《白帽子讲WEB安全》上是以md5为例进行的讲解，本题用的是sha1，所以我还去研究了下sha1的流程，自己写了个python实现的脚本</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"></div><div class="line">import ctypes</div><div class="line">import struct</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">ROTL32</span><span class="params">(x, r)</span></span>:</div><div class="line">    <span class="symbol">try:</span></div><div class="line">        a = (x &lt;&lt; r) ^ (x <span class="meta">&gt;&gt; </span>(<span class="number">32</span> - r))</div><div class="line">    <span class="symbol">except:</span></div><div class="line">        print type(x)</div><div class="line">        print type(r)</div><div class="line">        exit(-<span class="number">1</span>)</div><div class="line">    <span class="keyword">return</span> a</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SHA1</span>():</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>)</span></span>:</div><div class="line">        <span class="keyword">self</span>.length<span class="number">_</span> = <span class="number">0</span></div><div class="line">        <span class="keyword">self</span>.unprocessed<span class="number">_</span> = <span class="number">0</span></div><div class="line">        <span class="keyword">self</span>.hash<span class="number">_</span> = [</div><div class="line">            <span class="number">0x67452301</span>,</div><div class="line">            <span class="number">0xefcdab89</span>,</div><div class="line">            <span class="number">0x98badcfe</span>,</div><div class="line">            <span class="number">0x10325476</span>,</div><div class="line">            <span class="number">0xc3d2e1f0</span></div><div class="line">        ]</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sha1_process</span><span class="params">(<span class="keyword">self</span>)</span></span>:</div><div class="line">        wblock = []</div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">80</span>):</div><div class="line">            wblock.append(<span class="number">0</span>)</div><div class="line"></div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">16</span>):</div><div class="line">            wblock[x] = <span class="keyword">self</span>.block[x]</div><div class="line"></div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">16</span>, <span class="number">80</span>):</div><div class="line">            wblock[x] = ROTL32(wblock[x - <span class="number">3</span>] ^ wblock[x - <span class="number">8</span>] ^ wblock[x - <span class="number">14</span>] ^ wblock[x - <span class="number">16</span>], <span class="number">1</span>) &amp; <span class="number">0xFFFFFFFF</span></div><div class="line"></div><div class="line">        a = <span class="keyword">self</span>.hash<span class="number">_</span>[<span class="number">0</span>]</div><div class="line">        b = <span class="keyword">self</span>.hash<span class="number">_</span>[<span class="number">1</span>]</div><div class="line">        c = <span class="keyword">self</span>.hash<span class="number">_</span>[<span class="number">2</span>]</div><div class="line">        d = <span class="keyword">self</span>.hash<span class="number">_</span>[<span class="number">3</span>]</div><div class="line">        e = <span class="keyword">self</span>.hash<span class="number">_</span>[<span class="number">4</span>]</div><div class="line"></div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">20</span>):</div><div class="line"></div><div class="line">            temp = ROTL32(a, <span class="number">5</span>) + (((c ^ d) &amp; b) ^ d) + e + wblock[x] + <span class="number">0x5A827999</span></div><div class="line">            temp &amp;= <span class="number">0xFFFFFFFF</span></div><div class="line">            e = d</div><div class="line">            d = c</div><div class="line">            c = ROTL32(b, <span class="number">30</span>) &amp; <span class="number">0xFFFFFFFF</span></div><div class="line">            b = a</div><div class="line">            a = temp</div><div class="line"></div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">20</span>, <span class="number">40</span>):</div><div class="line">            temp = ROTL32(a, <span class="number">5</span>) + (b ^ c ^ d) + e + wblock[x] + <span class="number">0x6ED9EBA1</span></div><div class="line">            temp &amp;= <span class="number">0xFFFFFFFF</span></div><div class="line">            e = d</div><div class="line">            d = c</div><div class="line">            c = ROTL32(b, <span class="number">30</span>) &amp; <span class="number">0xFFFFFFFF</span></div><div class="line">            b = a</div><div class="line">            a = temp</div><div class="line"></div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">40</span>, <span class="number">60</span>):</div><div class="line">            temp = ROTL32(a, <span class="number">5</span>) + ((b &amp; c) <span class="params">| (b &amp; d) |</span> (c &amp; d)) + e + wblock[x] + <span class="number">0x8F1BBCDC</span></div><div class="line">            temp &amp;= <span class="number">0xFFFFFFFF</span></div><div class="line">            e = d</div><div class="line">            d = c</div><div class="line">            c = ROTL32(b, <span class="number">30</span>) &amp; <span class="number">0xFFFFFFFF</span></div><div class="line">            b = a</div><div class="line">            a = temp</div><div class="line"></div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">60</span>, <span class="number">80</span>):</div><div class="line">            temp = ROTL32(a, <span class="number">5</span>) + (b ^ c ^ d) + e + wblock[x] + <span class="number">0xCA62C1D6</span></div><div class="line">            temp &amp;= <span class="number">0xFFFFFFFF</span></div><div class="line">            e = d</div><div class="line">            d = c</div><div class="line">            c = ROTL32(b, <span class="number">30</span>) &amp; <span class="number">0xFFFFFFFF</span></div><div class="line">            b = a</div><div class="line">            a = temp</div><div class="line"></div><div class="line">        <span class="keyword">self</span>.hash<span class="number">_</span>[<span class="number">0</span>] += a</div><div class="line">        <span class="keyword">self</span>.hash<span class="number">_</span>[<span class="number">1</span>] += b</div><div class="line">        <span class="keyword">self</span>.hash<span class="number">_</span>[<span class="number">2</span>] += c</div><div class="line">        <span class="keyword">self</span>.hash<span class="number">_</span>[<span class="number">3</span>] += d</div><div class="line">        <span class="keyword">self</span>.hash<span class="number">_</span>[<span class="number">4</span>] += e</div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">5</span>):</div><div class="line">            <span class="keyword">self</span>.hash<span class="number">_</span>[x] &amp;= <span class="number">0xFFFFFFFF</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">str_to_block</span><span class="params">(<span class="keyword">self</span>, x)</span></span>:</div><div class="line">        <span class="keyword">self</span>.block = []</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(x, x + <span class="number">64</span>, <span class="number">4</span>):</div><div class="line">            tmp = <span class="keyword">self</span>.msg[<span class="symbol">i:</span> i + <span class="number">4</span>]</div><div class="line">            tmp = int(tmp.encode(<span class="string">'hex'</span>) <span class="keyword">or</span> <span class="string">'0'</span>, <span class="number">16</span>)</div><div class="line">            <span class="keyword">self</span>.block.append(tmp)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sha1</span><span class="params">(<span class="keyword">self</span>, msg, length)</span></span>:</div><div class="line">        <span class="keyword">self</span>.msg = msg</div><div class="line">        <span class="keyword">self</span>.length<span class="number">_</span> = length</div><div class="line">        <span class="keyword">self</span>.msg += (<span class="number">64</span> - length % <span class="number">64</span>) * <span class="string">'\x00'</span></div><div class="line">        x = <span class="number">0</span></div><div class="line">        <span class="keyword">while</span> length &gt;= <span class="number">64</span>:</div><div class="line">            <span class="keyword">self</span>.str_to_block(x)</div><div class="line">            <span class="keyword">self</span>.sha1_process()</div><div class="line">            x += <span class="number">64</span></div><div class="line">            length -= <span class="number">64</span></div><div class="line">        <span class="keyword">self</span>.str_to_block(x)</div><div class="line">        <span class="keyword">self</span>.unprocessed<span class="number">_</span> = length</div><div class="line">        <span class="keyword">self</span>.block = <span class="keyword">self</span>.padding()</div><div class="line">        <span class="keyword">self</span>.sha1_process()</div><div class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.final()</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">padding</span><span class="params">(<span class="keyword">self</span>)</span></span>:</div><div class="line">        message = []</div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">16</span>):</div><div class="line">            message.append(<span class="number">0</span>)</div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">16</span>):</div><div class="line">            tmp = struct.pack(<span class="string">"I"</span>, <span class="keyword">self</span>.block[x])</div><div class="line">            message[x] = int(tmp.encode(<span class="string">'hex'</span>), <span class="number">16</span>)</div><div class="line"></div><div class="line">        index = (<span class="keyword">self</span>.length<span class="number">_</span> &amp; <span class="number">63</span>) <span class="meta">&gt;&gt; </span><span class="number">2</span></div><div class="line">        shift = (<span class="keyword">self</span>.length<span class="number">_</span> &amp; <span class="number">3</span>) * <span class="number">8</span></div><div class="line">        message[index] &amp;= ~(<span class="number">0xFFFFFFFF</span> &lt;&lt; shift)</div><div class="line">        message[index] ^= <span class="number">0x80</span> &lt;&lt; shift</div><div class="line">        index += <span class="number">1</span></div><div class="line"></div><div class="line">        <span class="keyword">if</span> index &gt; <span class="number">14</span>:</div><div class="line">            <span class="keyword">while</span> index &lt; <span class="number">16</span>:</div><div class="line">                message[index] = <span class="number">0</span></div><div class="line">                index += <span class="number">1</span></div><div class="line">            <span class="comment"># 进行大小端转换</span></div><div class="line">            <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">16</span>):</div><div class="line">                tmp = struct.pack(<span class="string">"I"</span>, message[x])</div><div class="line">                message[x] = int(tmp.encode(<span class="string">'hex'</span>), <span class="number">16</span>)</div><div class="line">            <span class="keyword">self</span>.block = message</div><div class="line">            <span class="keyword">self</span>.sha1_process()</div><div class="line">            index = <span class="number">0</span></div><div class="line"></div><div class="line">        <span class="keyword">while</span> index &lt; <span class="number">14</span>:</div><div class="line">            message[index] = <span class="number">0</span></div><div class="line">            index += <span class="number">1</span></div><div class="line"></div><div class="line">        data_len = <span class="keyword">self</span>.length<span class="number">_</span> &lt;&lt; <span class="number">3</span></div><div class="line">        data_len = int(struct.pack(<span class="string">"L"</span>, data_len).encode(<span class="string">"hex"</span>), <span class="number">16</span>)</div><div class="line">        message[<span class="number">14</span>] = data_len &amp; <span class="number">0x00000000FFFFFFFF</span></div><div class="line">        message[<span class="number">15</span>] = (data_len &amp; <span class="number">0xFFFFFFFF00000000</span>) <span class="meta">&gt;&gt; </span><span class="number">32</span></div><div class="line">        <span class="comment"># 进行大小端转换</span></div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">16</span>):</div><div class="line">            tmp = struct.pack(<span class="string">"I"</span>, message[x])</div><div class="line">            message[x] = int(tmp.encode(<span class="string">'hex'</span>), <span class="number">16</span>)</div><div class="line">        <span class="keyword">return</span> message</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">final</span><span class="params">(<span class="keyword">self</span>)</span></span>:</div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">5</span>):</div><div class="line">            <span class="keyword">self</span>.hash<span class="number">_</span>[x] = ctypes.c_uint32(<span class="keyword">self</span>.hash<span class="number">_</span>[x])</div><div class="line">        result = <span class="string">""</span></div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> <span class="keyword">self</span>.<span class="symbol">hash_:</span></div><div class="line">            result += <span class="string">"&#123;:0&gt;8&#125;"</span>.format(hex(x.value)[<span class="number">2</span><span class="symbol">:-</span><span class="number">1</span>])</div><div class="line">        <span class="keyword">return</span> result</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name_<span class="number">_</span> == <span class="string">'__main__'</span>:</div><div class="line">    import hashlib</div><div class="line">    test_str = [</div><div class="line">        <span class="string">""</span>,</div><div class="line">        <span class="string">"a"</span>,</div><div class="line">        <span class="string">"abc"</span>,</div><div class="line">        <span class="string">"message digest"</span>,</div><div class="line">        <span class="string">"abcdefghijklmnopqrstuvwxyz"</span>,</div><div class="line">        <span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"</span>,</div><div class="line">        <span class="string">"12345678901234567890123456789012345678901234567890123456789012345678901234567890"</span></div><div class="line">    ]</div><div class="line">    <span class="comment"># for x in test_str:</span></div><div class="line">    <span class="comment">#   s = SHA1()</span></div><div class="line">    <span class="comment">#   print s.sha1(x, len(x))</span></div><div class="line">    <span class="comment">#   print hashlib.sha1(x).hexdigest()</span></div><div class="line">    <span class="string">''</span><span class="string">'</span></div><div class="line">    已知 sha1("abcdefghijklmnopqrstuvwxyz")</div><div class="line">    可求 sha1("abcdefghijklmnopqrstuvwxyz\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x1a" + "test")</div><div class="line">    '<span class="string">''</span></div><div class="line">    s1 = hashlib.sha1(<span class="string">"abcdefghijklmnopqrstuvwxyz"</span>).hexdigest()</div><div class="line">    <span class="comment">#s = SHA1()</span></div><div class="line">    x1 = <span class="string">"abcdefghijklmnopqrstuvwxyz\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xd0"</span> + <span class="string">"test"</span></div><div class="line">    x2 = <span class="string">"abcdefghijklmnopqrstuvwxyz"</span></div><div class="line">    <span class="comment">#print s.sha1(x1, len(x1))</span></div><div class="line">    <span class="comment"># s = SHA1()</span></div><div class="line">    <span class="comment">#s.sha1(x2, len(x2))</span></div><div class="line">    check_s2 = hashlib.sha1(x1).hexdigest()</div><div class="line">    <span class="comment">#print s1</span></div><div class="line">    print check_s2</div><div class="line">    s = SHA1()</div><div class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">0</span>, <span class="number">40</span>, <span class="number">8</span>):</div><div class="line">        s.hash<span class="number">_</span>[x/<span class="number">8</span>] = int(s1[<span class="symbol">x:</span> x+<span class="number">8</span>], <span class="number">16</span>)</div><div class="line">    hash_str = <span class="string">"test"</span></div><div class="line">    block = hash_str + <span class="string">"\x80"</span> + <span class="string">"\x00"</span> * (<span class="number">64</span> - len(hash_str) - <span class="number">1</span>)</div><div class="line">    s.msg = block</div><div class="line">    s.str_to_block(<span class="number">0</span>)</div><div class="line">    s.block[<span class="number">15</span>] = (len(hash_str) + <span class="number">64</span>) * <span class="number">8</span></div><div class="line">    s.sha1_process()</div><div class="line">    print s.final()</div></pre></td></tr></table></figure>
<p>该代码写的太糟，仅是为了了解sha1的流程，没有任何实用价值，下面是C源码(还有md5的部分)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div><div class="line">518</div><div class="line">519</div><div class="line">520</div><div class="line">521</div><div class="line">522</div><div class="line">523</div><div class="line">524</div><div class="line">525</div><div class="line">526</div><div class="line">527</div><div class="line">528</div><div class="line">529</div><div class="line">530</div><div class="line">531</div><div class="line">532</div><div class="line">533</div><div class="line">534</div><div class="line">535</div><div class="line">536</div><div class="line">537</div><div class="line">538</div><div class="line">539</div><div class="line">540</div><div class="line">541</div><div class="line">542</div><div class="line">543</div><div class="line">544</div><div class="line">545</div><div class="line">546</div><div class="line">547</div><div class="line">548</div><div class="line">549</div><div class="line">550</div><div class="line">551</div><div class="line">552</div><div class="line">553</div><div class="line">554</div><div class="line">555</div><div class="line">556</div><div class="line">557</div><div class="line">558</div><div class="line">559</div><div class="line">560</div><div class="line">561</div><div class="line">562</div><div class="line">563</div><div class="line">564</div><div class="line">565</div><div class="line">566</div><div class="line">567</div><div class="line">568</div><div class="line">569</div><div class="line">570</div><div class="line">571</div><div class="line">572</div><div class="line">573</div><div class="line">574</div><div class="line">575</div><div class="line">576</div><div class="line">577</div><div class="line">578</div><div class="line">579</div><div class="line">580</div><div class="line">581</div><div class="line">582</div><div class="line">583</div><div class="line">584</div><div class="line">585</div><div class="line">586</div><div class="line">587</div><div class="line">588</div><div class="line">589</div><div class="line">590</div><div class="line">591</div><div class="line">592</div><div class="line">593</div><div class="line">594</div><div class="line">595</div><div class="line">596</div><div class="line">597</div><div class="line">598</div><div class="line">599</div><div class="line">600</div><div class="line">601</div><div class="line">602</div><div class="line">603</div><div class="line">604</div><div class="line">605</div><div class="line">606</div><div class="line">607</div><div class="line">608</div><div class="line">609</div><div class="line">610</div><div class="line">611</div><div class="line">612</div><div class="line">613</div><div class="line">614</div><div class="line">615</div><div class="line">616</div><div class="line">617</div><div class="line">618</div><div class="line">619</div><div class="line">620</div><div class="line">621</div><div class="line">622</div><div class="line">623</div><div class="line">624</div><div class="line">625</div><div class="line">626</div><div class="line">627</div><div class="line">628</div><div class="line">629</div><div class="line">630</div><div class="line">631</div><div class="line">632</div><div class="line">633</div><div class="line">634</div><div class="line">635</div><div class="line">636</div><div class="line">637</div><div class="line">638</div><div class="line">639</div><div class="line">640</div><div class="line">641</div><div class="line">642</div><div class="line">643</div><div class="line">644</div><div class="line">645</div><div class="line">646</div><div class="line">647</div><div class="line">648</div><div class="line">649</div><div class="line">650</div><div class="line">651</div><div class="line">652</div><div class="line">653</div><div class="line">654</div><div class="line">655</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="comment">//字节序的小头和大头的问题</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ZEN_LITTLE_ENDIAN  0x0123</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ZEN_BIG_ENDIAN     0x3210</span></div><div class="line"></div><div class="line"><span class="comment">//目前所有的代码都是为了小头党服务的，不知道有生之年这套代码是否还会为大头党服务一次？</span></div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ZEN_BYTES_ORDER</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ZEN_BYTES_ORDER    ZEN_LITTLE_ENDIAN</span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ZEN_SWAP_UINT16</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ZEN_SWAP_UINT16(x)  ((((x) &amp; 0xff00) &gt;&gt;  8) | (((x) &amp; 0x00ff) &lt;&lt;  8))</span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ZEN_SWAP_UINT32</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ZEN_SWAP_UINT32(x)  ((((x) &amp; 0xff000000) &gt;&gt; 24) | (((x) &amp; 0x00ff0000) &gt;&gt;  8) | \</span></div><div class="line">    (((x) &amp; 0x0000ff00) &lt;&lt;  8) | (((x) &amp; 0x000000ff) &lt;&lt; 24))</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ZEN_SWAP_UINT64</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ZEN_SWAP_UINT64(x)  ((((x) &amp; 0xff00000000000000) &gt;&gt; 56) | (((x) &amp; 0x00ff000000000000) &gt;&gt;  40) | \</span></div><div class="line">    (((x) &amp; 0x0000ff0000000000) &gt;&gt; 24) | (((x) &amp; 0x000000ff00000000) &gt;&gt;  8) | \</div><div class="line">    (((x) &amp; 0x00000000ff000000) &lt;&lt; 8 ) | (((x) &amp; 0x0000000000ff0000) &lt;&lt;  24) | \</div><div class="line">    (((x) &amp; 0x000000000000ff00) &lt;&lt; 40 ) | (((x) &amp; 0x00000000000000ff) &lt;&lt;  56))</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="comment">//将一个（字符串）数组，拷贝到另外一个uint32_t数组，同时每个uint32_t反字节序</span></div><div class="line"><span class="function"><span class="keyword">void</span> *<span class="title">swap_uint32_memcpy</span><span class="params">(<span class="keyword">void</span> *to, <span class="keyword">const</span> <span class="keyword">void</span> *from, <span class="keyword">size_t</span> length)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="built_in">memcpy</span>(to, from, length);</div><div class="line">    <span class="keyword">size_t</span> remain_len =  (<span class="number">4</span> - (length &amp; <span class="number">3</span>)) &amp; <span class="number">3</span>;</div><div class="line"></div><div class="line">    <span class="comment">//数据不是4字节的倍数,补充0</span></div><div class="line">    <span class="keyword">if</span> (remain_len)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; remain_len; ++i)</div><div class="line">        &#123;</div><div class="line">            *((<span class="keyword">char</span> *)(to) + length + i) = <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//调整成4的倍数</span></div><div class="line">        length += remain_len;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//所有的数据反转</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; length / <span class="number">4</span>; ++i)</div><div class="line">    &#123;</div><div class="line">        ((<span class="keyword">uint32_t</span> *)to)[i] = ZEN_SWAP_UINT32(((<span class="keyword">uint32_t</span> *)to)[i]);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> to;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">///MD5的结果数据长度</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">size_t</span> ZEN_MD5_HASH_SIZE   = <span class="number">16</span>;</div><div class="line"><span class="comment">///SHA1的结果数据长度</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">size_t</span> ZEN_SHA1_HASH_SIZE  = <span class="number">20</span>;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">namespace</span> ZEN_LIB</div><div class="line">&#123;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/*!</span></div><div class="line">@brief      求某个内存块的MD5，</div><div class="line">@return     unsigned char* 返回的的结果，</div><div class="line">@param[in]  buf    求MD5的内存BUFFER指针</div><div class="line">@param[in]  size   BUFFER长度</div><div class="line">@param[out] result 结果</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">char</span> *<span class="title">md5</span><span class="params">(<span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> *buf,</span></span></div><div class="line">                   <span class="keyword">size_t</span> size,</div><div class="line">                   <span class="keyword">unsigned</span> <span class="keyword">char</span> result[ZEN_MD5_HASH_SIZE]);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/*!</span></div><div class="line">@brief      求内存块BUFFER的SHA1值</div><div class="line">@return     unsigned char* 返回的的结果</div><div class="line">@param[in]  buf    求SHA1的内存BUFFER指针</div><div class="line">@param[in]  size   BUFFER长度</div><div class="line">@param[out] result 结果</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">char</span> *<span class="title">sha1</span><span class="params">(<span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> *buf,</span></span></div><div class="line">                    <span class="keyword">size_t</span> size,</div><div class="line">                    <span class="keyword">unsigned</span> <span class="keyword">char</span> result[ZEN_SHA1_HASH_SIZE]);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//================================================================================================</span></div><div class="line"><span class="comment">//MD5的算法</span></div><div class="line"></div><div class="line"><span class="comment">//每次处理的BLOCK的大小</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">size_t</span> ZEN_MD5_BLOCK_SIZE = <span class="number">64</span>;</div><div class="line"></div><div class="line"><span class="comment">//md5算法的上下文，保存一些状态，中间数据，结果</span></div><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">md5_ctx</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">//处理的数据的长度</span></div><div class="line">    <span class="keyword">uint64_t</span> length_;</div><div class="line">    <span class="comment">//还没有处理的数据长度</span></div><div class="line">    <span class="keyword">uint64_t</span> unprocessed_;</div><div class="line">    <span class="comment">//取得的HASH结果（中间数据）</span></div><div class="line">    <span class="keyword">uint32_t</span>  hash_[<span class="number">4</span>];</div><div class="line">&#125; md5_ctx;</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ROTL32(dword, n) ((dword) <span class="meta-string">&lt;&lt; (n) ^ ((dword) &gt;&gt; (32 - (n))))</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ROTR32(dword, n) ((dword) &gt;&gt; (n) ^ ((dword) &lt;&lt; (32 - (n))))</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ROTL64(qword, n) ((qword) <span class="meta-string">&lt;&lt; (n) ^ ((qword) &gt;&gt; (64 - (n))))</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ROTR64(qword, n) ((qword) &gt;&gt; (n) ^ ((qword) &lt;&lt; (64 - (n))))</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/*!</span></div><div class="line">@brief      内部函数，初始化MD5的context，内容</div><div class="line">@param      ctx</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">zen_md5_init</span><span class="params">(md5_ctx *ctx)</span></span></div><div class="line">&#123;</div><div class="line">    ctx-&gt;length_ = <span class="number">0</span>;</div><div class="line">    ctx-&gt;unprocessed_ = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="comment">/* initialize state */</span></div><div class="line">    ctx-&gt;hash_[<span class="number">0</span>] = <span class="number">0x67452301</span>;</div><div class="line">    ctx-&gt;hash_[<span class="number">1</span>] = <span class="number">0xefcdab89</span>;</div><div class="line">    ctx-&gt;hash_[<span class="number">2</span>] = <span class="number">0x98badcfe</span>;</div><div class="line">    ctx-&gt;hash_[<span class="number">3</span>] = <span class="number">0x10325476</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/* First, define four auxiliary functions that each take as input</span></div><div class="line"> * three 32-bit words and returns a 32-bit word.*/</div><div class="line"></div><div class="line"><span class="comment">/* F(x,y,z) = ((y XOR z) AND x) XOR z - is faster then original version */</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MD5_F(x, y, z) ((((y) ^ (z)) &amp; (x)) ^ (z))</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MD5_G(x, y, z) (((x) &amp; (z)) | ((y) &amp; (~z)))</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MD5_H(x, y, z) ((x) ^ (y) ^ (z))</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MD5_I(x, y, z) ((y) ^ ((x) | (~z)))</span></div><div class="line"></div><div class="line"><span class="comment">/* transformations for rounds 1, 2, 3, and 4. */</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MD5_ROUND1(a, b, c, d, x, s, ac) &#123; \</span></div><div class="line">        (a) += MD5_F((b), (c), (d)) + (x) + (ac); \</div><div class="line">        (a) = ROTL32((a), (s)); \</div><div class="line">        (a) += (b); \</div><div class="line">    &#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MD5_ROUND2(a, b, c, d, x, s, ac) &#123; \</span></div><div class="line">        (a) += MD5_G((b), (c), (d)) + (x) + (ac); \</div><div class="line">        (a) = ROTL32((a), (s)); \</div><div class="line">        (a) += (b); \</div><div class="line">    &#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MD5_ROUND3(a, b, c, d, x, s, ac) &#123; \</span></div><div class="line">        (a) += MD5_H((b), (c), (d)) + (x) + (ac); \</div><div class="line">        (a) = ROTL32((a), (s)); \</div><div class="line">        (a) += (b); \</div><div class="line">    &#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MD5_ROUND4(a, b, c, d, x, s, ac) &#123; \</span></div><div class="line">        (a) += MD5_I((b), (c), (d)) + (x) + (ac); \</div><div class="line">        (a) = ROTL32((a), (s)); \</div><div class="line">        (a) += (b); \</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/*!</span></div><div class="line">@brief      内部函数，将64个字节，16个uint32_t的数组进行摘要（杂凑）处理，处理的数据自己序是小头数据</div><div class="line">@param      state 存放处理的hash数据结果</div><div class="line">@param      block 要处理的block，64个字节，16个uint32_t的数组</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">zen_md5_process_block</span><span class="params">(<span class="keyword">uint32_t</span> state[<span class="number">4</span>], <span class="keyword">const</span> <span class="keyword">uint32_t</span> block[ZEN_MD5_BLOCK_SIZE / <span class="number">4</span>])</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">register</span> <span class="keyword">unsigned</span> a, b, c, d;</div><div class="line">    a = state[<span class="number">0</span>];</div><div class="line">    b = state[<span class="number">1</span>];</div><div class="line">    c = state[<span class="number">2</span>];</div><div class="line">    d = state[<span class="number">3</span>];</div><div class="line"></div><div class="line">    <span class="keyword">const</span> <span class="keyword">uint32_t</span> *x = <span class="literal">NULL</span>;</div><div class="line"></div><div class="line">    <span class="comment">//MD5里面计算的数据都是小头数据.大头党的数据要处理</span></div><div class="line"><span class="meta">#<span class="meta-keyword">if</span> ZEN_BYTES_ORDER == ZEN_LITTLE_ENDIAN</span></div><div class="line">    x = block;</div><div class="line"><span class="meta">#<span class="meta-keyword">else</span></span></div><div class="line">    <span class="keyword">uint32_t</span> swap_block[ZEN_MD5_BLOCK_SIZE / <span class="number">4</span>];</div><div class="line">    swap_uint32_memcpy(swap_block, block, <span class="number">64</span>);</div><div class="line">    x = swap_block;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"></div><div class="line"></div><div class="line">    MD5_ROUND1(a, b, c, d, x[ <span class="number">0</span>],  <span class="number">7</span>, <span class="number">0xd76aa478</span>);</div><div class="line">    MD5_ROUND1(d, a, b, c, x[ <span class="number">1</span>], <span class="number">12</span>, <span class="number">0xe8c7b756</span>);</div><div class="line">    MD5_ROUND1(c, d, a, b, x[ <span class="number">2</span>], <span class="number">17</span>, <span class="number">0x242070db</span>);</div><div class="line">    MD5_ROUND1(b, c, d, a, x[ <span class="number">3</span>], <span class="number">22</span>, <span class="number">0xc1bdceee</span>);</div><div class="line">    MD5_ROUND1(a, b, c, d, x[ <span class="number">4</span>],  <span class="number">7</span>, <span class="number">0xf57c0faf</span>);</div><div class="line">    MD5_ROUND1(d, a, b, c, x[ <span class="number">5</span>], <span class="number">12</span>, <span class="number">0x4787c62a</span>);</div><div class="line">    MD5_ROUND1(c, d, a, b, x[ <span class="number">6</span>], <span class="number">17</span>, <span class="number">0xa8304613</span>);</div><div class="line">    MD5_ROUND1(b, c, d, a, x[ <span class="number">7</span>], <span class="number">22</span>, <span class="number">0xfd469501</span>);</div><div class="line">    MD5_ROUND1(a, b, c, d, x[ <span class="number">8</span>],  <span class="number">7</span>, <span class="number">0x698098d8</span>);</div><div class="line">    MD5_ROUND1(d, a, b, c, x[ <span class="number">9</span>], <span class="number">12</span>, <span class="number">0x8b44f7af</span>);</div><div class="line">    MD5_ROUND1(c, d, a, b, x[<span class="number">10</span>], <span class="number">17</span>, <span class="number">0xffff5bb1</span>);</div><div class="line">    MD5_ROUND1(b, c, d, a, x[<span class="number">11</span>], <span class="number">22</span>, <span class="number">0x895cd7be</span>);</div><div class="line">    MD5_ROUND1(a, b, c, d, x[<span class="number">12</span>],  <span class="number">7</span>, <span class="number">0x6b901122</span>);</div><div class="line">    MD5_ROUND1(d, a, b, c, x[<span class="number">13</span>], <span class="number">12</span>, <span class="number">0xfd987193</span>);</div><div class="line">    MD5_ROUND1(c, d, a, b, x[<span class="number">14</span>], <span class="number">17</span>, <span class="number">0xa679438e</span>);</div><div class="line">    MD5_ROUND1(b, c, d, a, x[<span class="number">15</span>], <span class="number">22</span>, <span class="number">0x49b40821</span>);</div><div class="line"></div><div class="line">    MD5_ROUND2(a, b, c, d, x[ <span class="number">1</span>],  <span class="number">5</span>, <span class="number">0xf61e2562</span>);</div><div class="line">    MD5_ROUND2(d, a, b, c, x[ <span class="number">6</span>],  <span class="number">9</span>, <span class="number">0xc040b340</span>);</div><div class="line">    MD5_ROUND2(c, d, a, b, x[<span class="number">11</span>], <span class="number">14</span>, <span class="number">0x265e5a51</span>);</div><div class="line">    MD5_ROUND2(b, c, d, a, x[ <span class="number">0</span>], <span class="number">20</span>, <span class="number">0xe9b6c7aa</span>);</div><div class="line">    MD5_ROUND2(a, b, c, d, x[ <span class="number">5</span>],  <span class="number">5</span>, <span class="number">0xd62f105d</span>);</div><div class="line">    MD5_ROUND2(d, a, b, c, x[<span class="number">10</span>],  <span class="number">9</span>,  <span class="number">0x2441453</span>);</div><div class="line">    MD5_ROUND2(c, d, a, b, x[<span class="number">15</span>], <span class="number">14</span>, <span class="number">0xd8a1e681</span>);</div><div class="line">    MD5_ROUND2(b, c, d, a, x[ <span class="number">4</span>], <span class="number">20</span>, <span class="number">0xe7d3fbc8</span>);</div><div class="line">    MD5_ROUND2(a, b, c, d, x[ <span class="number">9</span>],  <span class="number">5</span>, <span class="number">0x21e1cde6</span>);</div><div class="line">    MD5_ROUND2(d, a, b, c, x[<span class="number">14</span>],  <span class="number">9</span>, <span class="number">0xc33707d6</span>);</div><div class="line">    MD5_ROUND2(c, d, a, b, x[ <span class="number">3</span>], <span class="number">14</span>, <span class="number">0xf4d50d87</span>);</div><div class="line">    MD5_ROUND2(b, c, d, a, x[ <span class="number">8</span>], <span class="number">20</span>, <span class="number">0x455a14ed</span>);</div><div class="line">    MD5_ROUND2(a, b, c, d, x[<span class="number">13</span>],  <span class="number">5</span>, <span class="number">0xa9e3e905</span>);</div><div class="line">    MD5_ROUND2(d, a, b, c, x[ <span class="number">2</span>],  <span class="number">9</span>, <span class="number">0xfcefa3f8</span>);</div><div class="line">    MD5_ROUND2(c, d, a, b, x[ <span class="number">7</span>], <span class="number">14</span>, <span class="number">0x676f02d9</span>);</div><div class="line">    MD5_ROUND2(b, c, d, a, x[<span class="number">12</span>], <span class="number">20</span>, <span class="number">0x8d2a4c8a</span>);</div><div class="line"></div><div class="line">    MD5_ROUND3(a, b, c, d, x[ <span class="number">5</span>],  <span class="number">4</span>, <span class="number">0xfffa3942</span>);</div><div class="line">    MD5_ROUND3(d, a, b, c, x[ <span class="number">8</span>], <span class="number">11</span>, <span class="number">0x8771f681</span>);</div><div class="line">    MD5_ROUND3(c, d, a, b, x[<span class="number">11</span>], <span class="number">16</span>, <span class="number">0x6d9d6122</span>);</div><div class="line">    MD5_ROUND3(b, c, d, a, x[<span class="number">14</span>], <span class="number">23</span>, <span class="number">0xfde5380c</span>);</div><div class="line">    MD5_ROUND3(a, b, c, d, x[ <span class="number">1</span>],  <span class="number">4</span>, <span class="number">0xa4beea44</span>);</div><div class="line">    MD5_ROUND3(d, a, b, c, x[ <span class="number">4</span>], <span class="number">11</span>, <span class="number">0x4bdecfa9</span>);</div><div class="line">    MD5_ROUND3(c, d, a, b, x[ <span class="number">7</span>], <span class="number">16</span>, <span class="number">0xf6bb4b60</span>);</div><div class="line">    MD5_ROUND3(b, c, d, a, x[<span class="number">10</span>], <span class="number">23</span>, <span class="number">0xbebfbc70</span>);</div><div class="line">    MD5_ROUND3(a, b, c, d, x[<span class="number">13</span>],  <span class="number">4</span>, <span class="number">0x289b7ec6</span>);</div><div class="line">    MD5_ROUND3(d, a, b, c, x[ <span class="number">0</span>], <span class="number">11</span>, <span class="number">0xeaa127fa</span>);</div><div class="line">    MD5_ROUND3(c, d, a, b, x[ <span class="number">3</span>], <span class="number">16</span>, <span class="number">0xd4ef3085</span>);</div><div class="line">    MD5_ROUND3(b, c, d, a, x[ <span class="number">6</span>], <span class="number">23</span>,  <span class="number">0x4881d05</span>);</div><div class="line">    MD5_ROUND3(a, b, c, d, x[ <span class="number">9</span>],  <span class="number">4</span>, <span class="number">0xd9d4d039</span>);</div><div class="line">    MD5_ROUND3(d, a, b, c, x[<span class="number">12</span>], <span class="number">11</span>, <span class="number">0xe6db99e5</span>);</div><div class="line">    MD5_ROUND3(c, d, a, b, x[<span class="number">15</span>], <span class="number">16</span>, <span class="number">0x1fa27cf8</span>);</div><div class="line">    MD5_ROUND3(b, c, d, a, x[ <span class="number">2</span>], <span class="number">23</span>, <span class="number">0xc4ac5665</span>);</div><div class="line"></div><div class="line">    MD5_ROUND4(a, b, c, d, x[ <span class="number">0</span>],  <span class="number">6</span>, <span class="number">0xf4292244</span>);</div><div class="line">    MD5_ROUND4(d, a, b, c, x[ <span class="number">7</span>], <span class="number">10</span>, <span class="number">0x432aff97</span>);</div><div class="line">    MD5_ROUND4(c, d, a, b, x[<span class="number">14</span>], <span class="number">15</span>, <span class="number">0xab9423a7</span>);</div><div class="line">    MD5_ROUND4(b, c, d, a, x[ <span class="number">5</span>], <span class="number">21</span>, <span class="number">0xfc93a039</span>);</div><div class="line">    MD5_ROUND4(a, b, c, d, x[<span class="number">12</span>],  <span class="number">6</span>, <span class="number">0x655b59c3</span>);</div><div class="line">    MD5_ROUND4(d, a, b, c, x[ <span class="number">3</span>], <span class="number">10</span>, <span class="number">0x8f0ccc92</span>);</div><div class="line">    MD5_ROUND4(c, d, a, b, x[<span class="number">10</span>], <span class="number">15</span>, <span class="number">0xffeff47d</span>);</div><div class="line">    MD5_ROUND4(b, c, d, a, x[ <span class="number">1</span>], <span class="number">21</span>, <span class="number">0x85845dd1</span>);</div><div class="line">    MD5_ROUND4(a, b, c, d, x[ <span class="number">8</span>],  <span class="number">6</span>, <span class="number">0x6fa87e4f</span>);</div><div class="line">    MD5_ROUND4(d, a, b, c, x[<span class="number">15</span>], <span class="number">10</span>, <span class="number">0xfe2ce6e0</span>);</div><div class="line">    MD5_ROUND4(c, d, a, b, x[ <span class="number">6</span>], <span class="number">15</span>, <span class="number">0xa3014314</span>);</div><div class="line">    MD5_ROUND4(b, c, d, a, x[<span class="number">13</span>], <span class="number">21</span>, <span class="number">0x4e0811a1</span>);</div><div class="line">    MD5_ROUND4(a, b, c, d, x[ <span class="number">4</span>],  <span class="number">6</span>, <span class="number">0xf7537e82</span>);</div><div class="line">    MD5_ROUND4(d, a, b, c, x[<span class="number">11</span>], <span class="number">10</span>, <span class="number">0xbd3af235</span>);</div><div class="line">    MD5_ROUND4(c, d, a, b, x[ <span class="number">2</span>], <span class="number">15</span>, <span class="number">0x2ad7d2bb</span>);</div><div class="line">    MD5_ROUND4(b, c, d, a, x[ <span class="number">9</span>], <span class="number">21</span>, <span class="number">0xeb86d391</span>);</div><div class="line"></div><div class="line">    state[<span class="number">0</span>] += a;</div><div class="line">    state[<span class="number">1</span>] += b;</div><div class="line">    state[<span class="number">2</span>] += c;</div><div class="line">    state[<span class="number">3</span>] += d;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/*!</span></div><div class="line">@brief      内部函数，处理数据的前面部分(&gt;64字节的部分)，每次组成一个64字节的block就进行杂凑处理</div><div class="line">@param[out] ctx  算法的context，用于记录一些处理的上下文和结果</div><div class="line">@param[in]  buf  处理的数据，</div><div class="line">@param[in]  size 处理的数据长度</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">zen_md5_update</span><span class="params">(md5_ctx *ctx, <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> *buf, <span class="keyword">size_t</span> size)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">//为什么不是=，因为在某些环境下，可以多次调用zen_md5_update，但这种情况，必须保证前面的调用，每次都没有unprocessed_</span></div><div class="line">    ctx-&gt;length_ += size;</div><div class="line"></div><div class="line">    <span class="comment">//每个处理的块都是64字节</span></div><div class="line">    <span class="keyword">while</span> (size &gt;= ZEN_MD5_BLOCK_SIZE)</div><div class="line">    &#123;</div><div class="line">        zen_md5_process_block(ctx-&gt;hash_, <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">const</span> <span class="keyword">uint32_t</span> *&gt;(buf));</div><div class="line">        buf  += ZEN_MD5_BLOCK_SIZE;</div><div class="line">        size -= ZEN_MD5_BLOCK_SIZE;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    ctx-&gt;unprocessed_ = size;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/*!</span></div><div class="line">@brief      内部函数，处理数据的末尾部分，我们要拼出最后1个（或者两个）要处理的BLOCK，加上0x80，加上长度进行处理</div><div class="line">@param[in]  ctx    算法的context，用于记录一些处理的上下文和结果</div><div class="line">@param[in]  buf    处理的数据</div><div class="line">@param[in]  size   处理buffer的长度</div><div class="line">@param[out] result 返回的结果，</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">zen_md5_final</span><span class="params">(md5_ctx *ctx, <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> *buf, <span class="keyword">size_t</span> size, <span class="keyword">unsigned</span> <span class="keyword">char</span> *result)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">uint32_t</span> message[ZEN_MD5_BLOCK_SIZE / <span class="number">4</span>];</div><div class="line"></div><div class="line">    <span class="comment">//保存剩余的数据，我们要拼出最后1个（或者两个）要处理的块，前面的算法保证了，最后一个块肯定小于64个字节</span></div><div class="line">    <span class="keyword">if</span> (ctx-&gt;unprocessed_)</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">memcpy</span>(message, buf + size - ctx-&gt;unprocessed_, <span class="keyword">static_cast</span>&lt;<span class="keyword">size_t</span>&gt;( ctx-&gt;unprocessed_));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//得到0x80要添加在的位置（在uint32_t 数组中），</span></div><div class="line">    <span class="keyword">uint32_t</span> index = ((<span class="keyword">uint32_t</span>)ctx-&gt;length_ &amp; <span class="number">63</span>) &gt;&gt; <span class="number">2</span>;</div><div class="line">    <span class="keyword">uint32_t</span> shift = ((<span class="keyword">uint32_t</span>)ctx-&gt;length_ &amp; <span class="number">3</span>) * <span class="number">8</span>;</div><div class="line"></div><div class="line">    <span class="comment">//添加0x80进去，并且把余下的空间补充0</span></div><div class="line">    message[index]   &amp;= ~(<span class="number">0xFFFFFFFF</span> &lt;&lt; shift);</div><div class="line">    message[index++] ^= <span class="number">0x80</span> &lt;&lt; shift;</div><div class="line"></div><div class="line">    <span class="comment">//如果这个block还无法处理，其后面的长度无法容纳长度64bit，那么先处理这个block</span></div><div class="line">    <span class="keyword">if</span> (index &gt; <span class="number">14</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">while</span> (index &lt; <span class="number">16</span>)</div><div class="line">        &#123;</div><div class="line">            message[index++] = <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        zen_md5_process_block(ctx-&gt;hash_, message);</div><div class="line">        index = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//补0</span></div><div class="line">    <span class="keyword">while</span> (index &lt; <span class="number">14</span>)</div><div class="line">    &#123;</div><div class="line">        message[index++] = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//保存长度，注意是bit位的长度,这个问题让我看着郁闷了半天，</span></div><div class="line">    <span class="keyword">uint64_t</span> data_len = (ctx-&gt;length_) &lt;&lt; <span class="number">3</span>;</div><div class="line"></div><div class="line">    <span class="comment">//注意MD5算法要求的64bit的长度是小头LITTLE-ENDIAN编码，注意下面的比较是!=</span></div><div class="line"><span class="meta">#<span class="meta-keyword">if</span> ZEN_BYTES_ORDER != ZEN_LITTLE_ENDIAN</span></div><div class="line">    data_len = ZEN_SWAP_UINT64(data_len);</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"></div><div class="line">    message[<span class="number">14</span>] = (<span class="keyword">uint32_t</span>) (data_len &amp; <span class="number">0x00000000FFFFFFFF</span>);</div><div class="line">    message[<span class="number">15</span>] = (<span class="keyword">uint32_t</span>) ((data_len &amp; <span class="number">0xFFFFFFFF00000000</span>ULL) &gt;&gt; <span class="number">32</span>);</div><div class="line"></div><div class="line">    zen_md5_process_block(ctx-&gt;hash_, message);</div><div class="line"></div><div class="line">    <span class="comment">//注意结果是小头党的，在大头的世界要进行转换</span></div><div class="line"><span class="meta">#<span class="meta-keyword">if</span> ZEN_BYTES_ORDER == ZEN_LITTLE_ENDIAN</span></div><div class="line">    <span class="built_in">memcpy</span>(result, &amp;ctx-&gt;hash_, ZEN_MD5_HASH_SIZE);</div><div class="line"><span class="meta">#<span class="meta-keyword">else</span></span></div><div class="line">    swap_uint32_memcpy(result, &amp;ctx-&gt;hash_, ZEN_MD5_HASH_SIZE);</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//计算一个内存数据的MD5值</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> *ZEN_LIB::md5(<span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> *buf,</div><div class="line">                            <span class="keyword">size_t</span> size,</div><div class="line">                            <span class="keyword">unsigned</span> <span class="keyword">char</span> result[ZEN_MD5_HASH_SIZE])</div><div class="line">&#123;</div><div class="line">    assert(result != <span class="literal">NULL</span>);</div><div class="line"></div><div class="line">    md5_ctx ctx;</div><div class="line">    zen_md5_init(&amp;ctx);</div><div class="line">    zen_md5_update(&amp;ctx, buf, size);</div><div class="line">    zen_md5_final(&amp;ctx, buf, size, result);</div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//================================================================================================</span></div><div class="line"><span class="comment">//SHA1的算法</span></div><div class="line"></div><div class="line"><span class="comment">//每次处理的BLOCK的大小</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">size_t</span> ZEN_SHA1_BLOCK_SIZE = <span class="number">64</span>;</div><div class="line"></div><div class="line"><span class="comment">//SHA1算法的上下文，保存一些状态，中间数据，结果</span></div><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">sha1_ctx</span></span></div><div class="line">&#123;</div><div class="line"></div><div class="line">    <span class="comment">//处理的数据的长度</span></div><div class="line">    <span class="keyword">uint64_t</span> length_;</div><div class="line">    <span class="comment">//还没有处理的数据长度</span></div><div class="line">    <span class="keyword">uint64_t</span> unprocessed_;</div><div class="line">    <span class="comment">/* 160-bit algorithm internal hashing state */</span></div><div class="line">    <span class="keyword">uint32_t</span> hash_[<span class="number">5</span>];</div><div class="line">&#125; sha1_ctx;</div><div class="line"></div><div class="line"><span class="comment">//内部函数，SHA1算法的上下文的初始化</span></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">zen_sha1_init</span><span class="params">(sha1_ctx *ctx)</span></span></div><div class="line">&#123;</div><div class="line">    ctx-&gt;length_ = <span class="number">0</span>;</div><div class="line">    ctx-&gt;unprocessed_ = <span class="number">0</span>;</div><div class="line">    <span class="comment">// 初始化算法的几个常量，魔术数</span></div><div class="line">    ctx-&gt;hash_[<span class="number">0</span>] = <span class="number">0x67452301</span>;</div><div class="line">    ctx-&gt;hash_[<span class="number">1</span>] = <span class="number">0xefcdab89</span>;</div><div class="line">    ctx-&gt;hash_[<span class="number">2</span>] = <span class="number">0x98badcfe</span>;</div><div class="line">    ctx-&gt;hash_[<span class="number">3</span>] = <span class="number">0x10325476</span>;</div><div class="line">    ctx-&gt;hash_[<span class="number">4</span>] = <span class="number">0xc3d2e1f0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/*!</span></div><div class="line">@brief      内部函数，对一个64bit内存块进行摘要(杂凑)处理，</div><div class="line">@param      hash  存放计算hash结果的的数组</div><div class="line">@param      block 要计算的处理得内存块</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">zen_sha1_process_block</span><span class="params">(<span class="keyword">uint32_t</span> hash[<span class="number">5</span>],</span></span></div><div class="line">                                   <span class="keyword">const</span> <span class="keyword">uint32_t</span> block[ZEN_SHA1_BLOCK_SIZE / <span class="number">4</span>])</div><div class="line">&#123;</div><div class="line">    <span class="keyword">size_t</span>        t;</div><div class="line">    <span class="keyword">uint32_t</span>      wblock[<span class="number">80</span>];</div><div class="line">    <span class="keyword">register</span> <span class="keyword">uint32_t</span>      a, b, c, d, e, temp;</div><div class="line"></div><div class="line">    <span class="comment">//SHA1算法处理的内部数据要求是大头党的，在小头的环境转换</span></div><div class="line"><span class="meta">#<span class="meta-keyword">if</span> ZEN_BYTES_ORDER == ZEN_LITTLE_ENDIAN</span></div><div class="line">    swap_uint32_memcpy(wblock, block, ZEN_SHA1_BLOCK_SIZE);</div><div class="line"><span class="meta">#<span class="meta-keyword">else</span></span></div><div class="line">    ::<span class="built_in">memcpy</span>(wblock, block, ZEN_SHA1_BLOCK_SIZE);</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line">    <span class="keyword">for</span> (t = <span class="number">0</span>; t &lt; <span class="number">80</span>; t++) &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%u\n"</span>, wblock[t]);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//处理</span></div><div class="line">    <span class="keyword">for</span> (t = <span class="number">16</span>; t &lt; <span class="number">80</span>; t++)</div><div class="line">    &#123;</div><div class="line">        wblock[t] = ROTL32(wblock[t - <span class="number">3</span>] ^ wblock[t - <span class="number">8</span>] ^ wblock[t - <span class="number">14</span>] ^ wblock[t - <span class="number">16</span>], <span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    a = hash[<span class="number">0</span>];</div><div class="line">    b = hash[<span class="number">1</span>];</div><div class="line">    c = hash[<span class="number">2</span>];</div><div class="line">    d = hash[<span class="number">3</span>];</div><div class="line">    e = hash[<span class="number">4</span>];</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (t = <span class="number">0</span>; t &lt; <span class="number">20</span>; t++)</div><div class="line">    &#123;</div><div class="line">        <span class="comment">/* the following is faster than ((B &amp; C) | ((~B) &amp; D)) */</span></div><div class="line">        temp =  ROTL32(a, <span class="number">5</span>) + (((c ^ d) &amp; b) ^ d)</div><div class="line">                + e + wblock[t] + <span class="number">0x5A827999</span>;</div><div class="line">        e = d;</div><div class="line">        d = c;</div><div class="line">        c = ROTL32(b, <span class="number">30</span>);</div><div class="line">        b = a;</div><div class="line">        a = temp;</div><div class="line">    &#125;</div><div class="line"><span class="comment">// printf("%u\n", a);</span></div><div class="line"><span class="comment">// printf("%u\n", b);</span></div><div class="line"><span class="comment">// printf("%u\n", c);</span></div><div class="line"><span class="comment">// printf("%u\n", d);</span></div><div class="line"><span class="comment">// printf("%u\n", e);</span></div><div class="line">    <span class="keyword">for</span> (t = <span class="number">20</span>; t &lt; <span class="number">40</span>; t++)</div><div class="line">    &#123;</div><div class="line">        temp = ROTL32(a, <span class="number">5</span>) + (b ^ c ^ d) + e + wblock[t] + <span class="number">0x6ED9EBA1</span>;</div><div class="line">        e = d;</div><div class="line">        d = c;</div><div class="line">        c = ROTL32(b, <span class="number">30</span>);</div><div class="line">        b = a;</div><div class="line">        a = temp;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (t = <span class="number">40</span>; t &lt; <span class="number">60</span>; t++)</div><div class="line">    &#123;</div><div class="line">        temp = ROTL32(a, <span class="number">5</span>) + ((b &amp; c) | (b &amp; d) | (c &amp; d))</div><div class="line">               + e + wblock[t] + <span class="number">0x8F1BBCDC</span>;</div><div class="line">        e = d;</div><div class="line">        d = c;</div><div class="line">        c = ROTL32(b, <span class="number">30</span>);</div><div class="line">        b = a;</div><div class="line">        a = temp;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (t = <span class="number">60</span>; t &lt; <span class="number">80</span>; t++)</div><div class="line">    &#123;</div><div class="line">        temp = ROTL32(a, <span class="number">5</span>) + (b ^ c ^ d) + e + wblock[t] + <span class="number">0xCA62C1D6</span>;</div><div class="line">        e = d;</div><div class="line">        d = c;</div><div class="line">        c = ROTL32(b, <span class="number">30</span>);</div><div class="line">        b = a;</div><div class="line">        a = temp;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    hash[<span class="number">0</span>] += a;</div><div class="line">    hash[<span class="number">1</span>] += b;</div><div class="line">    hash[<span class="number">2</span>] += c;</div><div class="line">    hash[<span class="number">3</span>] += d;</div><div class="line">    hash[<span class="number">4</span>] += e;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/*!</span></div><div class="line">@brief      内部函数，处理数据的前面部分(&gt;64字节的部分)，每次组成一个64字节的block就进行杂凑处理</div><div class="line">@param      ctx  算法的上下文，记录中间数据，结果等</div><div class="line">@param      msg  要进行计算的数据buffer</div><div class="line">@param      size 长度</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">zen_sha1_update</span><span class="params">(sha1_ctx *ctx,</span></span></div><div class="line">                            <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> *buf, </div><div class="line">                            <span class="keyword">size_t</span> size)</div><div class="line">&#123;</div><div class="line">    <span class="comment">//为了让zen_sha1_update可以多次进入，长度可以累计</span></div><div class="line">    ctx-&gt;length_ += size;</div><div class="line"></div><div class="line">    <span class="comment">//每个处理的块都是64字节</span></div><div class="line">    <span class="keyword">while</span> (size &gt;= ZEN_SHA1_BLOCK_SIZE)</div><div class="line">    &#123;</div><div class="line">        zen_sha1_process_block(ctx-&gt;hash_, <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">const</span> <span class="keyword">uint32_t</span> *&gt;(buf));</div><div class="line">        buf  += ZEN_SHA1_BLOCK_SIZE;</div><div class="line">        size -= ZEN_SHA1_BLOCK_SIZE;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    ctx-&gt;unprocessed_ = size;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/*!</span></div><div class="line">@brief      内部函数，处理数据的最后部分，添加0x80,补0，增加长度信息</div><div class="line">@param      ctx    算法的上下文，记录中间数据，结果等</div><div class="line">@param      msg    要进行计算的数据buffer</div><div class="line">@param      result 返回的结果</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">zen_sha1_final</span><span class="params">(sha1_ctx *ctx, </span></span></div><div class="line">                           <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> *msg,</div><div class="line">                           <span class="keyword">size_t</span> size, </div><div class="line">                           <span class="keyword">unsigned</span> <span class="keyword">char</span> *result)</div><div class="line">&#123;</div><div class="line"></div><div class="line">    <span class="keyword">uint32_t</span> message[ZEN_SHA1_BLOCK_SIZE / <span class="number">4</span>];</div><div class="line"></div><div class="line">    <span class="comment">//保存剩余的数据，我们要拼出最后1个（或者两个）要处理的块，前面的算法保证了，最后一个块肯定小于64个字节</span></div><div class="line">    <span class="keyword">if</span> (ctx-&gt;unprocessed_)</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">memcpy</span>(message, msg + size - ctx-&gt;unprocessed_, <span class="keyword">static_cast</span>&lt;<span class="keyword">size_t</span>&gt;( ctx-&gt;unprocessed_));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//得到0x80要添加在的位置（在uint32_t 数组中），</span></div><div class="line">    <span class="keyword">uint32_t</span> index = ((<span class="keyword">uint32_t</span>)ctx-&gt;length_ &amp; <span class="number">63</span>) &gt;&gt; <span class="number">2</span>;</div><div class="line">    <span class="keyword">uint32_t</span> shift = ((<span class="keyword">uint32_t</span>)ctx-&gt;length_ &amp; <span class="number">3</span>) * <span class="number">8</span>;</div><div class="line"></div><div class="line">    <span class="comment">//添加0x80进去，并且把余下的空间补充0</span></div><div class="line">    message[index]   &amp;= ~(<span class="number">0xFFFFFFFF</span> &lt;&lt; shift);</div><div class="line">    message[index++] ^= <span class="number">0x80</span> &lt;&lt; shift;</div><div class="line"></div><div class="line">    <span class="comment">//如果这个block还无法处理，其后面的长度无法容纳长度64bit，那么先处理这个block</span></div><div class="line">    <span class="keyword">if</span> (index &gt; <span class="number">14</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">while</span> (index &lt; <span class="number">16</span>)</div><div class="line">        &#123;</div><div class="line">            message[index++] = <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        zen_sha1_process_block(ctx-&gt;hash_, message);</div><div class="line">        index = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//补0</span></div><div class="line">    <span class="keyword">while</span> (index &lt; <span class="number">14</span>)</div><div class="line">    &#123;</div><div class="line">        message[index++] = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//保存长度，注意是bit位的长度,这个问题让我看着郁闷了半天，</span></div><div class="line">    <span class="keyword">uint64_t</span> data_len = (ctx-&gt;length_) &lt;&lt; <span class="number">3</span>;</div><div class="line"></div><div class="line">    <span class="comment">//注意SHA1算法要求的64bit的长度是大头BIG-ENDIAN，在小头的世界要进行转换</span></div><div class="line"><span class="meta">#<span class="meta-keyword">if</span> ZEN_BYTES_ORDER == ZEN_LITTLE_ENDIAN</span></div><div class="line">    data_len = ZEN_SWAP_UINT64(data_len);</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"></div><div class="line">    message[<span class="number">14</span>] = (<span class="keyword">uint32_t</span>) (data_len &amp; <span class="number">0x00000000FFFFFFFF</span>);</div><div class="line">    message[<span class="number">15</span>] = (<span class="keyword">uint32_t</span>) ((data_len &amp; <span class="number">0xFFFFFFFF00000000</span>ULL) &gt;&gt; <span class="number">32</span>);</div><div class="line"></div><div class="line">    zen_sha1_process_block(ctx-&gt;hash_, message);</div><div class="line"></div><div class="line">    <span class="comment">//注意结果是大头党的，在小头的世界要进行转换</span></div><div class="line"><span class="meta">#<span class="meta-keyword">if</span> ZEN_BYTES_ORDER == ZEN_LITTLE_ENDIAN</span></div><div class="line">    swap_uint32_memcpy(result, &amp;ctx-&gt;hash_, ZEN_SHA1_HASH_SIZE);</div><div class="line"><span class="meta">#<span class="meta-keyword">else</span></span></div><div class="line">    <span class="built_in">memcpy</span>(result, &amp;ctx-&gt;hash_, ZEN_SHA1_HASH_SIZE);</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//计算一个内存数据的SHA1值</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> *ZEN_LIB::sha1(<span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> *msg,</div><div class="line">                             <span class="keyword">size_t</span> size,</div><div class="line">                             <span class="keyword">unsigned</span> <span class="keyword">char</span> result[ZEN_SHA1_HASH_SIZE])</div><div class="line">&#123;</div><div class="line">    assert(result != <span class="literal">NULL</span>);</div><div class="line"></div><div class="line">    sha1_ctx ctx;</div><div class="line">    zen_sha1_init(&amp;ctx);</div><div class="line">    zen_sha1_update(&amp;ctx, msg, size);</div><div class="line">    zen_sha1_final(&amp;ctx, msg, size, result);</div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> <span class="comment">/*argc*/</span>, <span class="keyword">char</span> * <span class="comment">/*argv*/</span>[])</span></span></div><div class="line">&#123;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> test_buf[<span class="number">7</span>][<span class="number">81</span>] =</div><div class="line">    &#123;</div><div class="line">        &#123; <span class="string">""</span> &#125;,</div><div class="line">        &#123; <span class="string">"a"</span> &#125;,</div><div class="line">        &#123; <span class="string">"abc"</span> &#125;,</div><div class="line">        &#123; <span class="string">"message digest"</span> &#125;,</div><div class="line">        &#123; <span class="string">"abcdefghijklmnopqrstuvwxyz"</span> &#125;,</div><div class="line">        &#123; <span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"</span> &#125;,</div><div class="line">        &#123; <span class="string">"12345678901234567890123456789012345678901234567890123456789012345678901234567890"</span> &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">size_t</span> test_buflen[<span class="number">7</span>] =</div><div class="line">    &#123;</div><div class="line">        <span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">26</span>, <span class="number">62</span>, <span class="number">80</span></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="comment">// static const unsigned char md5_test_sum[7][16] =</span></div><div class="line">    <span class="comment">// &#123;</span></div><div class="line">    <span class="comment">//     &#123; 0xD4, 0x1D, 0x8C, 0xD9, 0x8F, 0x00, 0xB2, 0x04,  0xE9, 0x80, 0x09, 0x98, 0xEC, 0xF8, 0x42, 0x7E &#125;,</span></div><div class="line">    <span class="comment">//     &#123; 0x0C, 0xC1, 0x75, 0xB9, 0xC0, 0xF1, 0xB6, 0xA8,  0x31, 0xC3, 0x99, 0xE2, 0x69, 0x77, 0x26, 0x61 &#125;,</span></div><div class="line">    <span class="comment">//     &#123; 0x90, 0x01, 0x50, 0x98, 0x3C, 0xD2, 0x4F, 0xB0,  0xD6, 0x96, 0x3F, 0x7D, 0x28, 0xE1, 0x7F, 0x72 &#125;,</span></div><div class="line">    <span class="comment">//     &#123; 0xF9, 0x6B, 0x69, 0x7D, 0x7C, 0xB7, 0x93, 0x8D,  0x52, 0x5A, 0x2F, 0x31, 0xAA, 0xF1, 0x61, 0xD0 &#125;,</span></div><div class="line">    <span class="comment">//     &#123; 0xC3, 0xFC, 0xD3, 0xD7, 0x61, 0x92, 0xE4, 0x00,  0x7D, 0xFB, 0x49, 0x6C, 0xCA, 0x67, 0xE1, 0x3B &#125;,</span></div><div class="line">    <span class="comment">//     &#123; 0xD1, 0x74, 0xAB, 0x98, 0xD2, 0x77, 0xD9, 0xF5,  0xA5, 0x61, 0x1C, 0x2C, 0x9F, 0x41, 0x9D, 0x9F &#125;,</span></div><div class="line">    <span class="comment">//     &#123; 0x57, 0xED, 0xF4, 0xA2, 0x2B, 0xE3, 0xC9, 0x55,  0xAC, 0x49, 0xDA, 0x2E, 0x21, 0x07, 0xB6, 0x7A &#125;</span></div><div class="line">    <span class="comment">// &#125;;</span></div><div class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> result[<span class="number">32</span>] =&#123;<span class="number">0</span>&#125;;</div><div class="line"></div><div class="line">    <span class="comment">// for(size_t i=0;i&lt;7;++i)</span></div><div class="line">    <span class="comment">// &#123;</span></div><div class="line">    <span class="comment">//     ZEN_LIB::md5(test_buf[i],test_buflen[i],result);</span></div><div class="line">    <span class="comment">//     ret = memcmp(result,md5_test_sum[i],16);</span></div><div class="line">    <span class="comment">//     if (ret != 0)</span></div><div class="line">    <span class="comment">//     &#123;</span></div><div class="line">    <span class="comment">//         assert(false);</span></div><div class="line">    <span class="comment">//     &#125;</span></div><div class="line">    <span class="comment">// &#125;</span></div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> sha1_test_sum[<span class="number">7</span>][<span class="number">20</span>] =</div><div class="line">    &#123;</div><div class="line">        &#123; <span class="number">0xda</span>,<span class="number">0x39</span>,<span class="number">0xa3</span>,<span class="number">0xee</span>,<span class="number">0x5e</span>,<span class="number">0x6b</span>,<span class="number">0x4b</span>,<span class="number">0x0d</span>,<span class="number">0x32</span>,<span class="number">0x55</span>,<span class="number">0xbf</span>,<span class="number">0xef</span>,<span class="number">0x95</span>,<span class="number">0x60</span>,<span class="number">0x18</span>,<span class="number">0x90</span>,<span class="number">0xaf</span>,<span class="number">0xd8</span>,<span class="number">0x07</span>,<span class="number">0x09</span> &#125;,</div><div class="line">        &#123; <span class="number">0x86</span>,<span class="number">0xf7</span>,<span class="number">0xe4</span>,<span class="number">0x37</span>,<span class="number">0xfa</span>,<span class="number">0xa5</span>,<span class="number">0xa7</span>,<span class="number">0xfc</span>,<span class="number">0xe1</span>,<span class="number">0x5d</span>,<span class="number">0x1d</span>,<span class="number">0xdc</span>,<span class="number">0xb9</span>,<span class="number">0xea</span>,<span class="number">0xea</span>,<span class="number">0xea</span>,<span class="number">0x37</span>,<span class="number">0x76</span>,<span class="number">0x67</span>,<span class="number">0xb8</span> &#125;,</div><div class="line">        &#123; <span class="number">0xa9</span>,<span class="number">0x99</span>,<span class="number">0x3e</span>,<span class="number">0x36</span>,<span class="number">0x47</span>,<span class="number">0x06</span>,<span class="number">0x81</span>,<span class="number">0x6a</span>,<span class="number">0xba</span>,<span class="number">0x3e</span>,<span class="number">0x25</span>,<span class="number">0x71</span>,<span class="number">0x78</span>,<span class="number">0x50</span>,<span class="number">0xc2</span>,<span class="number">0x6c</span>,<span class="number">0x9c</span>,<span class="number">0xd0</span>,<span class="number">0xd8</span>,<span class="number">0x9d</span> &#125;,</div><div class="line">        &#123; <span class="number">0xc1</span>,<span class="number">0x22</span>,<span class="number">0x52</span>,<span class="number">0xce</span>,<span class="number">0xda</span>,<span class="number">0x8b</span>,<span class="number">0xe8</span>,<span class="number">0x99</span>,<span class="number">0x4d</span>,<span class="number">0x5f</span>,<span class="number">0xa0</span>,<span class="number">0x29</span>,<span class="number">0x0a</span>,<span class="number">0x47</span>,<span class="number">0x23</span>,<span class="number">0x1c</span>,<span class="number">0x1d</span>,<span class="number">0x16</span>,<span class="number">0xaa</span>,<span class="number">0xe3</span> &#125;,</div><div class="line">        &#123; <span class="number">0x32</span>,<span class="number">0xd1</span>,<span class="number">0x0c</span>,<span class="number">0x7b</span>,<span class="number">0x8c</span>,<span class="number">0xf9</span>,<span class="number">0x65</span>,<span class="number">0x70</span>,<span class="number">0xca</span>,<span class="number">0x04</span>,<span class="number">0xce</span>,<span class="number">0x37</span>,<span class="number">0xf2</span>,<span class="number">0xa1</span>,<span class="number">0x9d</span>,<span class="number">0x84</span>,<span class="number">0x24</span>,<span class="number">0x0d</span>,<span class="number">0x3a</span>,<span class="number">0x89</span> &#125;,</div><div class="line">        &#123; <span class="number">0x76</span>,<span class="number">0x1c</span>,<span class="number">0x45</span>,<span class="number">0x7b</span>,<span class="number">0xf7</span>,<span class="number">0x3b</span>,<span class="number">0x14</span>,<span class="number">0xd2</span>,<span class="number">0x7e</span>,<span class="number">0x9e</span>,<span class="number">0x92</span>,<span class="number">0x65</span>,<span class="number">0xc4</span>,<span class="number">0x6f</span>,<span class="number">0x4b</span>,<span class="number">0x4d</span>,<span class="number">0xda</span>,<span class="number">0x11</span>,<span class="number">0xf9</span>,<span class="number">0x40</span> &#125;,</div><div class="line">        &#123; <span class="number">0x50</span>,<span class="number">0xab</span>,<span class="number">0xf5</span>,<span class="number">0x70</span>,<span class="number">0x6a</span>,<span class="number">0x15</span>,<span class="number">0x09</span>,<span class="number">0x90</span>,<span class="number">0xa0</span>,<span class="number">0x8b</span>,<span class="number">0x2c</span>,<span class="number">0x5e</span>,<span class="number">0xa4</span>,<span class="number">0x0f</span>,<span class="number">0xa0</span>,<span class="number">0xe5</span>,<span class="number">0x85</span>,<span class="number">0x55</span>,<span class="number">0x47</span>,<span class="number">0x32</span> &#125;,</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    ZEN_LIB::sha1(test_buf[<span class="number">0</span>],test_buflen[<span class="number">0</span>],result);</div><div class="line">    <span class="comment">// for (int i=0; i &lt; 20; i++)</span></div><div class="line">    <span class="comment">//  printf("0x%02x\n", result[i]);</span></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对于Length Extension Attack，由于我太菜了，难以叙说，还是直接上我写的一个利用脚本</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"></div><div class="line">from optparse import OptionParser</div><div class="line">import struct</div><div class="line">import ctypes</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">ROTL32</span><span class="params">(x, r)</span></span>:</div><div class="line">    x, r = int(x), int(r)</div><div class="line">    <span class="keyword">return</span> (x &lt;&lt; r) ^ (x <span class="meta">&gt;&gt; </span>(<span class="number">32</span> - r))</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SHA1Attack</span>():</span></div><div class="line">    <span class="string">""</span><span class="string">"</span></div><div class="line">    SHA1 Length extend attack by Hcamael</div><div class="line">    s = sha1(mac+m)</div><div class="line">    if we know s, we can calculate sha1(mac+m+padding+msg)</div><div class="line">    "<span class="string">""</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>, options)</span></span>:</div><div class="line">        <span class="keyword">self</span>.hash<span class="number">_</span> = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">0</span>, <span class="number">40</span>, <span class="number">8</span>):</div><div class="line">            <span class="keyword">self</span>.hash<span class="number">_</span>[x/<span class="number">8</span>] = int(options.signal[<span class="symbol">x:</span>x+<span class="number">8</span>], <span class="number">16</span>)</div><div class="line">        <span class="keyword">self</span>.length<span class="number">_</span> = len(options.extend) + ((options.macl + len(options.origin)) / <span class="number">64</span> + <span class="number">1</span>) * <span class="number">64</span></div><div class="line">        print <span class="keyword">self</span>.length<span class="number">_</span></div><div class="line">        <span class="keyword">self</span>.str_to_block(options.extend)</div><div class="line">        <span class="keyword">self</span>.block = <span class="keyword">self</span>.padding()</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">padding</span><span class="params">(<span class="keyword">self</span>)</span></span>:</div><div class="line">        message = []</div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">16</span>):</div><div class="line">            message.append(<span class="number">0</span>)</div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">16</span>):</div><div class="line">            tmp = struct.pack(<span class="string">"I"</span>, <span class="keyword">self</span>.block[x])</div><div class="line">            message[x] = int(tmp.encode(<span class="string">'hex'</span>), <span class="number">16</span>)</div><div class="line"></div><div class="line">        index = (<span class="keyword">self</span>.length<span class="number">_</span> &amp; <span class="number">63</span>) <span class="meta">&gt;&gt; </span><span class="number">2</span></div><div class="line">        shift = (<span class="keyword">self</span>.length<span class="number">_</span> &amp; <span class="number">3</span>) * <span class="number">8</span></div><div class="line">        message[index] &amp;= ~(<span class="number">0xFFFFFFFF</span> &lt;&lt; shift)</div><div class="line">        message[index] ^= <span class="number">0x80</span> &lt;&lt; shift</div><div class="line">        index += <span class="number">1</span></div><div class="line"></div><div class="line">        <span class="keyword">if</span> index &gt; <span class="number">14</span>:</div><div class="line">            <span class="keyword">while</span> index &lt; <span class="number">16</span>:</div><div class="line">                message[index] = <span class="number">0</span></div><div class="line">                index += <span class="number">1</span></div><div class="line">            <span class="comment"># 进行大小端转换</span></div><div class="line">            <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">16</span>):</div><div class="line">                tmp = struct.pack(<span class="string">"I"</span>, message[x])</div><div class="line">                message[x] = int(tmp.encode(<span class="string">'hex'</span>), <span class="number">16</span>)</div><div class="line">            <span class="keyword">self</span>.block = message</div><div class="line">            <span class="keyword">self</span>.sha1_process()</div><div class="line">            index = <span class="number">0</span></div><div class="line"></div><div class="line">        <span class="keyword">while</span> index &lt; <span class="number">14</span>:</div><div class="line">            message[index] = <span class="number">0</span></div><div class="line">            index += <span class="number">1</span></div><div class="line"></div><div class="line">        data_len = <span class="keyword">self</span>.length<span class="number">_</span> &lt;&lt; <span class="number">3</span></div><div class="line">        data_len = int(struct.pack(<span class="string">"L"</span>, data_len).encode(<span class="string">"hex"</span>), <span class="number">16</span>)</div><div class="line">        message[<span class="number">14</span>] = data_len &amp; <span class="number">0x00000000FFFFFFFF</span></div><div class="line">        message[<span class="number">15</span>] = (data_len &amp; <span class="number">0xFFFFFFFF00000000</span>) <span class="meta">&gt;&gt; </span><span class="number">32</span></div><div class="line">        <span class="comment"># 进行大小端转换</span></div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">16</span>):</div><div class="line">            tmp = struct.pack(<span class="string">"I"</span>, message[x])</div><div class="line">            message[x] = int(tmp.encode(<span class="string">'hex'</span>), <span class="number">16</span>)</div><div class="line">        <span class="keyword">return</span> message</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">str_to_block</span><span class="params">(<span class="keyword">self</span>, msg)</span></span>:</div><div class="line">        <span class="keyword">self</span>.block = []</div><div class="line">        msg += (<span class="number">64</span> - <span class="keyword">self</span>.length<span class="number">_</span>%<span class="number">64</span>) * <span class="string">'\x00'</span></div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">0</span>,  <span class="number">64</span>, <span class="number">4</span>):</div><div class="line">            tmp = msg[<span class="symbol">i:</span> i + <span class="number">4</span>]</div><div class="line">            tmp = int(tmp.encode(<span class="string">'hex'</span>) <span class="keyword">or</span> <span class="string">'0'</span>, <span class="number">16</span>)</div><div class="line">            <span class="keyword">self</span>.block.append(tmp)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calculate</span><span class="params">(<span class="keyword">self</span>)</span></span>:</div><div class="line">        <span class="keyword">self</span>.sha1_process()</div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">5</span>):</div><div class="line">            <span class="keyword">self</span>.hash<span class="number">_</span>[x] = ctypes.c_uint32(<span class="keyword">self</span>.hash<span class="number">_</span>[x])</div><div class="line">        result = <span class="string">""</span></div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> <span class="keyword">self</span>.<span class="symbol">hash_:</span></div><div class="line">            result += <span class="string">"&#123;:0&gt;8&#125;"</span>.format(hex(x.value)[<span class="number">2</span><span class="symbol">:-</span><span class="number">1</span>])</div><div class="line">        <span class="keyword">return</span> result</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sha1_process</span><span class="params">(<span class="keyword">self</span>)</span></span>:</div><div class="line">        wblock = []</div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">80</span>):</div><div class="line">            wblock.append(<span class="number">0</span>)</div><div class="line"></div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">16</span>):</div><div class="line">            wblock[x] = <span class="keyword">self</span>.block[x]</div><div class="line"></div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">16</span>, <span class="number">80</span>):</div><div class="line">            wblock[x] = ROTL32(wblock[x - <span class="number">3</span>] ^ wblock[x - <span class="number">8</span>] ^ wblock[x - <span class="number">14</span>] ^ wblock[x - <span class="number">16</span>], <span class="number">1</span>) &amp; <span class="number">0xFFFFFFFF</span></div><div class="line"></div><div class="line">        a = <span class="keyword">self</span>.hash<span class="number">_</span>[<span class="number">0</span>]</div><div class="line">        b = <span class="keyword">self</span>.hash<span class="number">_</span>[<span class="number">1</span>]</div><div class="line">        c = <span class="keyword">self</span>.hash<span class="number">_</span>[<span class="number">2</span>]</div><div class="line">        d = <span class="keyword">self</span>.hash<span class="number">_</span>[<span class="number">3</span>]</div><div class="line">        e = <span class="keyword">self</span>.hash<span class="number">_</span>[<span class="number">4</span>]</div><div class="line"></div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">20</span>):</div><div class="line"></div><div class="line">            temp = ROTL32(a, <span class="number">5</span>) + (((c ^ d) &amp; b) ^ d) + e + wblock[x] + <span class="number">0x5A827999</span></div><div class="line">            temp &amp;= <span class="number">0xFFFFFFFF</span></div><div class="line">            e = d</div><div class="line">            d = c</div><div class="line">            c = ROTL32(b, <span class="number">30</span>) &amp; <span class="number">0xFFFFFFFF</span></div><div class="line">            b = a</div><div class="line">            a = temp</div><div class="line"></div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">20</span>, <span class="number">40</span>):</div><div class="line">            temp = ROTL32(a, <span class="number">5</span>) + (b ^ c ^ d) + e + wblock[x] + <span class="number">0x6ED9EBA1</span></div><div class="line">            temp &amp;= <span class="number">0xFFFFFFFF</span></div><div class="line">            e = d</div><div class="line">            d = c</div><div class="line">            c = ROTL32(b, <span class="number">30</span>) &amp; <span class="number">0xFFFFFFFF</span></div><div class="line">            b = a</div><div class="line">            a = temp</div><div class="line"></div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">40</span>, <span class="number">60</span>):</div><div class="line">            temp = ROTL32(a, <span class="number">5</span>) + ((b &amp; c) <span class="params">| (b &amp; d) |</span> (c &amp; d)) + e + wblock[x] + <span class="number">0x8F1BBCDC</span></div><div class="line">            temp &amp;= <span class="number">0xFFFFFFFF</span></div><div class="line">            e = d</div><div class="line">            d = c</div><div class="line">            c = ROTL32(b, <span class="number">30</span>) &amp; <span class="number">0xFFFFFFFF</span></div><div class="line">            b = a</div><div class="line">            a = temp</div><div class="line"></div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">60</span>, <span class="number">80</span>):</div><div class="line">            temp = ROTL32(a, <span class="number">5</span>) + (b ^ c ^ d) + e + wblock[x] + <span class="number">0xCA62C1D6</span></div><div class="line">            temp &amp;= <span class="number">0xFFFFFFFF</span></div><div class="line">            e = d</div><div class="line">            d = c</div><div class="line">            c = ROTL32(b, <span class="number">30</span>) &amp; <span class="number">0xFFFFFFFF</span></div><div class="line">            b = a</div><div class="line">            a = temp</div><div class="line"></div><div class="line">        <span class="keyword">self</span>.hash<span class="number">_</span>[<span class="number">0</span>] += a</div><div class="line">        <span class="keyword">self</span>.hash<span class="number">_</span>[<span class="number">1</span>] += b</div><div class="line">        <span class="keyword">self</span>.hash<span class="number">_</span>[<span class="number">2</span>] += c</div><div class="line">        <span class="keyword">self</span>.hash<span class="number">_</span>[<span class="number">3</span>] += d</div><div class="line">        <span class="keyword">self</span>.hash<span class="number">_</span>[<span class="number">4</span>] += e</div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">5</span>):</div><div class="line">            <span class="keyword">self</span>.hash<span class="number">_</span>[x] &amp;= <span class="number">0xFFFFFFFF</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_parse</span><span class="params">()</span></span>:</div><div class="line">    parser = OptionParser()</div><div class="line">    parser.add_option(</div><div class="line">        <span class="string">"--macl"</span>,</div><div class="line">        dest=<span class="string">"macl"</span>,</div><div class="line">        type=<span class="string">"int"</span>,</div><div class="line">        help=<span class="string">"Please enter the length of mac"</span>)</div><div class="line">    parser.add_option(</div><div class="line">        <span class="string">"--o"</span>,</div><div class="line">        dest=<span class="string">"origin"</span>,</div><div class="line">        help=<span class="string">"sha1(mac+origin), Please enter the origin"</span>)</div><div class="line">    parser.add_option(</div><div class="line">        <span class="string">"--sign"</span>,</div><div class="line">        dest=<span class="string">"signal"</span>,</div><div class="line">        help=<span class="string">"signal=sha1(mac+origin), Please enter the signal"</span>)</div><div class="line">    parser.add_option(</div><div class="line">        <span class="string">"--e"</span>,</div><div class="line">        dest=<span class="string">"extend"</span>,</div><div class="line">        help=<span class="string">"Please enter the extend value"</span>)</div><div class="line">    <span class="keyword">return</span> parser</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span></span>:</div><div class="line">    parser = add_parse()</div><div class="line">    (options, args) = parser.parse_args()</div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (options.macl <span class="keyword">and</span> options.origin <span class="keyword">and</span> options.signal <span class="keyword">and</span> options.extend):</div><div class="line">        parser.parse_args([<span class="string">'sha1-length-extend-attack.py'</span>, <span class="string">'-h'</span>])</div><div class="line">        exit(-<span class="number">1</span>)</div><div class="line">    o_data_length = options.macl + len(options.origin)</div><div class="line">    p = <span class="number">64</span> - <span class="number">8</span> - <span class="number">1</span> - o_data_length</div><div class="line">    n = <span class="number">2</span></div><div class="line">    <span class="keyword">while</span> p &lt; <span class="number">0</span>:</div><div class="line">        p = <span class="number">64</span> * n - <span class="number">8</span> - <span class="number">1</span> - o_data_length</div><div class="line">        n += <span class="number">1</span></div><div class="line">    o_data_length *= <span class="number">8</span></div><div class="line">    o_data_length = <span class="string">"&#123;:0&gt;16&#125;"</span>.format(hex(o_data_length)[<span class="number">2</span><span class="symbol">:</span>])</div><div class="line">    data_l = <span class="string">""</span></div><div class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">0</span>, <span class="number">16</span>, <span class="number">2</span>):</div><div class="line">        data_l += <span class="string">"\\x"</span> + o_data_length[<span class="symbol">x:</span>x+<span class="number">2</span>]</div><div class="line">    cal = SHA1Attack(options)</div><div class="line">    result = cal.calculate()</div><div class="line">    print <span class="string">"+---------------------------+"</span></div><div class="line">    print <span class="string">"|         Result             |"</span></div><div class="line">    print <span class="string">"+---------------------------+"</span></div><div class="line">    print <span class="string">"Origin signal: "</span> + options.signal</div><div class="line">    print <span class="string">"New signal: "</span> + result</div><div class="line">    print <span class="string">"New msg: "</span> + <span class="string">"("</span> + str(options.macl) + <span class="string">" bytes unknow MAC) + "</span> + options.origin + <span class="string">"\\x80"</span> + <span class="string">"\\x00"</span> * p + data_l + options.extend</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name_<span class="number">_</span> == <span class="string">'__main__'</span>:</div><div class="line">    main()</div></pre></td></tr></table></figure>
<p>本题的漏洞在于，源码中<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">kv = urlparse.parse_qsl(s)</div><div class="line">        <span class="keyword">ret</span> = &#123;&#125;</div><div class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> kv:</div><div class="line">            <span class="keyword">ret</span>[k] = v</div><div class="line">        <span class="keyword">return</span> <span class="keyword">ret</span></div></pre></td></tr></table></figure></p>
<p>如果解密出来的s为<code>username=xxx&amp;username=admin</code><br>那么最终得到<code>ret = {&#39;username&#39;: &#39;admin&#39;}</code></p>
<p>我们可以注册<code>username=a</code>用户，得到<code>SHA1(MAC + username=a)</code>的hash值，利用Length Extension Attack我们可以算出<code>SHA1(MAC + username=a + pad + &amp;username=admin)</code> 的hash值，然后我们再利用Padding Oracle Attack，再构造出<code>username=a+pad+&amp;username=admin</code>密文，根据本题的具体需求，稍微改了下Padding Oracle Attack的脚本</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"></div><div class="line">from optparse import OptionParser</div><div class="line">import requests</div><div class="line">import struct</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">POAttack</span>():</span></div><div class="line">    <span class="string">""</span><span class="string">"</span></div><div class="line">    以GGCTF的一题为例写的Padding Oracle Attack</div><div class="line">    By Hcamael</div><div class="line">    "<span class="string">""</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>, options)</span></span>:</div><div class="line">        <span class="keyword">self</span>.url = options.url</div><div class="line">        <span class="keyword">self</span>.length = options.length</div><div class="line">        cookie = options.cookie.split(<span class="string">"="</span>)</div><div class="line">        assert len(cookie) == <span class="number">2</span></div><div class="line">        <span class="keyword">self</span>.c_name = cookie[<span class="number">0</span>]</div><div class="line">        c = cookie[<span class="number">1</span>].decode(<span class="string">'hex'</span>)</div><div class="line">        <span class="keyword">if</span> len(c) % <span class="keyword">self</span>.length != <span class="number">0</span> <span class="keyword">or</span> len(c) == <span class="keyword">self</span>.<span class="symbol">length:</span></div><div class="line">            raise <span class="string">"cookie error!"</span></div><div class="line">        <span class="keyword">self</span>.sign = c[-<span class="keyword">self</span>.<span class="symbol">length:</span>].encode(<span class="string">'hex'</span>)</div><div class="line">        <span class="keyword">self</span>.result = <span class="keyword">self</span>.sign</div><div class="line">        <span class="keyword">self</span>.unenc = <span class="string">""</span></div><div class="line">        <span class="keyword">if</span> options.<span class="symbol">plain:</span></div><div class="line">            <span class="keyword">self</span>.plain = options.plain</div><div class="line">            <span class="keyword">self</span>.pad_plain = (<span class="keyword">self</span>.length - len(<span class="keyword">self</span>.plain) % <span class="keyword">self</span>.length)</div><div class="line">            <span class="keyword">self</span>.pad_iv = c[-<span class="keyword">self</span>.length*<span class="number">2</span>: -<span class="keyword">self</span>.length]</div><div class="line">        <span class="symbol">else:</span></div><div class="line">            <span class="keyword">self</span>.pad_plain = <span class="number">0</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">attack</span><span class="params">(<span class="keyword">self</span>, msg)</span></span>:</div><div class="line">        <span class="keyword">self</span>.a_str = msg</div><div class="line">        pad = (<span class="keyword">self</span>.length - len(<span class="keyword">self</span>.a_str) % <span class="keyword">self</span>.length)</div><div class="line">        <span class="keyword">self</span>.a_str += chr(pad) * pad</div><div class="line">        assert len(<span class="keyword">self</span>.a_str) % <span class="keyword">self</span>.length == <span class="number">0</span></div><div class="line">        <span class="keyword">self</span>.l_str = list(struct.unpack(<span class="string">"16s"</span>*(len(<span class="keyword">self</span>.a_str)/<span class="keyword">self</span>.length), <span class="keyword">self</span>.a_str))</div><div class="line"></div><div class="line">        <span class="keyword">self</span>.iv = <span class="string">"\x00"</span> * <span class="keyword">self</span>.length</div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(len(<span class="keyword">self</span>.l_str)):</div><div class="line">            print <span class="string">"+===================================================+"</span></div><div class="line">            print <span class="string">"plaintext: %s"</span> % <span class="keyword">self</span>.l_str[-x-<span class="number">1</span>].encode(<span class="string">'hex'</span>)</div><div class="line">            result = <span class="keyword">self</span>.padding()</div><div class="line">            <span class="keyword">self</span>.unenc = result + <span class="keyword">self</span>.unenc</div><div class="line">            assert len(result) == len(<span class="keyword">self</span>.l_str[-x-<span class="number">1</span>]) == <span class="keyword">self</span>.length</div><div class="line">            tmp = <span class="string">""</span></div><div class="line">            <span class="keyword">for</span> y <span class="keyword">in</span> xrange(len(result)):</div><div class="line">                tmp += chr(ord(result[y])^ord(<span class="keyword">self</span>.l_str[-x-<span class="number">1</span>][y]))</div><div class="line">            <span class="keyword">self</span>.sign = tmp.encode(<span class="string">'hex'</span>)</div><div class="line">            <span class="keyword">self</span>.result = <span class="keyword">self</span>.sign + <span class="keyword">self</span>.result</div><div class="line">        <span class="keyword">return</span> (<span class="keyword">self</span>.result, <span class="keyword">self</span>.unenc.encode(<span class="string">"hex"</span>))</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">padding</span><span class="params">(<span class="keyword">self</span>)</span></span>:</div><div class="line">        tmp_iv = list(<span class="keyword">self</span>.iv)</div><div class="line">        result = list(<span class="string">"\x00"</span> * <span class="keyword">self</span>.length)</div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">self</span>.<span class="symbol">pad_plain:</span></div><div class="line">            n = <span class="number">0</span></div><div class="line">        <span class="symbol">else:</span></div><div class="line">            n = <span class="keyword">self</span>.pad_plain</div><div class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> xrange(n):</div><div class="line">                result[-i-<span class="number">1</span>] = chr(n ^ ord(<span class="keyword">self</span>.pad_iv[-i-<span class="number">1</span>]))</div><div class="line">            <span class="keyword">self</span>.pad_plain = <span class="number">0</span></div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(n, <span class="keyword">self</span>.length):</div><div class="line">            <span class="keyword">if</span> n != <span class="symbol">x:</span></div><div class="line">                raise <span class="string">"Padding Error!"</span></div><div class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> xrange(x):</div><div class="line">                tmp_iv[-i-<span class="number">1</span>] = chr((x+<span class="number">1</span>) ^ ord(result[-i-<span class="number">1</span>]))</div><div class="line">            <span class="keyword">for</span> y <span class="keyword">in</span> xrange(<span class="number">256</span>):</div><div class="line">                tmp_iv[-x-<span class="number">1</span>] = chr(y)</div><div class="line">                tmp = <span class="string">""</span>.join(tmp_iv).encode(<span class="string">'hex'</span>)</div><div class="line">                cookie = &#123;<span class="keyword">self</span>.<span class="symbol">c_name:</span> <span class="string">"d379b40e4da82e7d080d689d6fed5942671dde6f."</span> + tmp + <span class="keyword">self</span>.sign&#125;</div><div class="line">                <span class="symbol">try:</span></div><div class="line">                    req = requests.get(<span class="keyword">self</span>.url, cookies=cookie, verify=False, allow_redirects=False)</div><div class="line">                <span class="symbol">except:</span></div><div class="line">                    print result</div><div class="line">                    print <span class="keyword">self</span>.result</div><div class="line">                    exit()</div><div class="line">                <span class="keyword">if</span> req.status_code != <span class="number">500</span>:</div><div class="line">                    result[-x-<span class="number">1</span>] = chr(y^(x+<span class="number">1</span>))</div><div class="line">                    print <span class="string">"iv xor plaintext = %s"</span> % <span class="string">""</span>.join(result[-x-<span class="number">1</span><span class="symbol">:</span>]).encode(<span class="string">'hex'</span>)</div><div class="line">                    n += <span class="number">1</span></div><div class="line">                    <span class="keyword">break</span></div><div class="line">        <span class="keyword">return</span> <span class="string">""</span>.join(result)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_parse</span><span class="params">()</span></span>:</div><div class="line">    parser = OptionParser()</div><div class="line">    parser.add_option(</div><div class="line">        <span class="string">"--url"</span>,</div><div class="line">        dest=<span class="string">"url"</span>,</div><div class="line">        help=<span class="string">"Please input the url"</span>)</div><div class="line">    parser.add_option(</div><div class="line">        <span class="string">"--l"</span>,</div><div class="line">        dest=<span class="string">"length"</span>,</div><div class="line">        type=<span class="string">"int"</span>,</div><div class="line">        help=<span class="string">"Please input the iv's bytes length"</span>)</div><div class="line">    parser.add_option(</div><div class="line">        <span class="string">"--cookie"</span>,</div><div class="line">        dest=<span class="string">"cookie"</span>,</div><div class="line">        help=<span class="string">"Please input the url's cookie"</span>)</div><div class="line">    <span class="comment"># parser.add_option(</span></div><div class="line">    <span class="comment">#   "--s",</span></div><div class="line">    <span class="comment">#   dest="a_str",</span></div><div class="line">    <span class="comment">#   help="Please input you want to construct a string")</span></div><div class="line">    parser.add_option(</div><div class="line">        <span class="string">"--p"</span>,</div><div class="line">        dest=<span class="string">"plain"</span>,</div><div class="line">        help=<span class="string">"Please input if you know cookie's pliantext"</span>)</div><div class="line">    <span class="keyword">return</span> parser</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span></span>:</div><div class="line">    parser = add_parse()</div><div class="line">    (options, args) = parser.parse_args()</div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (options.url <span class="keyword">and</span> options.length <span class="keyword">and</span> options.cookie):</div><div class="line">        parser.parse_args([<span class="string">'cbc-padding-oracle-attack.py'</span>, <span class="string">'-h'</span>])</div><div class="line">        exit(-<span class="number">1</span>)</div><div class="line">    options.a_str = <span class="string">"username=a\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x50&amp;username=admin"</span></div><div class="line">    cbca = POAttack(options)</div><div class="line">    r, s = cbca.attack(options.a_str)</div><div class="line">    print <span class="string">"+-------------------+"</span></div><div class="line">    print <span class="string">"|       Result     |"</span></div><div class="line">    print <span class="string">"+--------------------+"</span></div><div class="line">    print <span class="string">"Your want string's cookie: "</span> + r</div><div class="line">    print <span class="string">"AES decrypt result: "</span> + s</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name_<span class="number">_</span> == <span class="string">'__main__'</span>:</div><div class="line">    main()</div></pre></td></tr></table></figure>
      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2016/05/03/0x1A/">GGCTF的对称密码学</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">Hcamael</a></p>
        <p><span>发布时间:</span>2016-05-03, 22:00:51</p>
        <p><span>最后更新:</span>2016-05-04, 11:12:56</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2016/05/03/0x1A/" title="GGCTF的对称密码学">http://0x48.pw/2016/05/03/0x1A/</a>
            <span class="copy-path" data-clipboard-text="原文: http://0x48.pw/2016/05/03/0x1A/　　作者: Hcamael" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script src="//qn.lazysheep.cc/js/clipboard.min.js"></script>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2016/05/10/0x1B/">
                    SCTF Code Writeup
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2016/04/17/0x19/">
                    How old are Crypto?
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Eucalypt-Forest"><span class="toc-number">1.</span> <span class="toc-text">Eucalypt Forest</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Padding-Oracle-Attack-原理"><span class="toc-number">1.1.</span> <span class="toc-text">Padding Oracle Attack 原理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Wolf-Spider"><span class="toc-number">2.</span> <span class="toc-text">Wolf Spider</span></a></li></ol>
</div>
<style>
    .left-col .switch-btn {
        display: none;
    }
    .left-col .switch-area {
        display: none;
    }
</style>

<input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">
<script>
    var valueHide = "隐藏目录";
    var valueShow = "显示目录";

    if ($(".left-col").is(":hidden")) {
        $("#tocButton").attr("value", valueShow);
    }

    $("#tocButton").click(function() {
        if ($("#toc").is(":hidden")) {
            $("#tocButton").attr("value", valueHide);
            $("#toc").slideDown(320);
            $(".switch-btn, .switch-area").fadeOut(300);
        }
        else {
            $("#tocButton").attr("value", valueShow);
            $("#toc").slideUp(350);
            $(".switch-btn, .switch-area").fadeIn(500);
        }
    })

    if ($(".toc").length < 1) {
        $("#toc, #tocButton").hide();
        $(".switch-btn, .switch-area").show();
    }
</script>






    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2016/05/10/0x1B/" title="上一篇: SCTF Code Writeup">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2016/04/17/0x19/" title="下一篇: How old are Crypto?">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/05/23/0x33/">ROP小结</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/05/0x32/">Triton学习笔记(三)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/03/0x31/">Triton学习笔记(二)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/02/0x30/">Triton学习笔记(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/20/0x2f/">记一次手撸CPython bytecode</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/17/0x2e/">填坑</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/14/0x2d/">栈溢出之绕过CANARY保护</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/13/0x2c/">Linux系统下格式化字符串利用研究</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/17/0x2b/">Pwnhub之深入敌后writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/06/0x2a/">CVE-2016-6313 随机数预测分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/28/0x29/">phpmailer RCE 分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/28/0x28/">2016 HCTF Crypto 出题总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/21/0x27/">PWN学习总结之基础栈溢出2</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/03/0x26/">PWN学习总结之基础栈溢出</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/14/0x24/">HITCON 2016 web 总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/12/0x23/">2016 HITCON Crypto -- PAKE(++)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/13/0x22/">php bugs 72663分析(CVE-2016-7124)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/31/0x21/">Cisco ASA RCE 环境搭建</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/16/0x20/">LNMP + phpenv 实现不同虚拟主机使用不同版本的PHP</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/10/0x1F/">CVE-2016-6174漏洞分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/14/0x1E/">三个白帽之火币网2W大挑战</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/27/0x1D/">寻找来自星星的你第二期Writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/17/0x1C/">三个白帽之招聘又开始了，你怕了吗？-Writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/10/0x1B/">SCTF Code Writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/03/0x1A/">GGCTF的对称密码学</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/17/0x19/">How old are Crypto?</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/08/0x18/">MySQLi-Error Injection</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/04/0x17/">Python 使用dpkt分析数据包</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/01/0x16/">CRYPTO技能修正</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/21/0x15/">Pentester Lab Writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/17/0x14/">0CTF RSA?总结 || RSA学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/15/0x13/">This is AliCTF?</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/14/0x12/">0CTF总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/07/0x11/">unholy Writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/14/0x0F/">Nebula Writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/19/0x0E/">12.19网络方向培训</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/08/0x0D/">HCTF之Black-Eat-Black总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/01/0x0C/">Python 的 BaseHTTPServer模块分析小结</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/31/0x0B/">10.31新生培训</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/05/0x09/">不使用select情况下的各种盲注</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/03/0x08/">2015XDCTF低分web题writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/07/0x06/">WeChall Writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/07/22/0x04/">git小记</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/07/19/0x02/">对于硬盘事件的随想</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/07/19/0x01/">对于这次硬盘坏掉事件小记</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/07/19/0x00/">跳转到以前的博文</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2017 Hcamael
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题">Yelee</a> by MOxFIVE
            </div>
        </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.1.22/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 4;
                var backgroundimg = "url(http://qn.lazysheep.cc/bg/bg-xxxx.jpg)".replace(/xxxx/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>




<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>

    <script src="//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js"></script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>